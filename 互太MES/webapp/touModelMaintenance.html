<!DOCTYPE html>
<html>

    <head>
        <meta charset="UTF-8">
        <title>Table</title>
        <link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
         <link rel="stylesheet" href="build/css/style.css"> 
        <!--<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
       
    </head>
	<script>
		window.onload=function(){	
        		 refresh();
        			
        	};
	</script>
    <body>
        <div style="margin:0 15px;">
            <div class="top">
                <span>$t('盤頭列表')</span>
            </div>
            <!-- 表格 -->
            <table id="demo" lay-filter="test"></table>
            <div>
                 <i class="layui-icon shou" id='shou1'>&#xe654;</i>&nbsp;&nbsp;<i class="layui-icon shou" id="edit">&#xe642;</i>&nbsp;&nbsp;<i class="layui-icon shou" id="del">&#xe640;</i> <i class="layui-icon shou" id="Ref">&#x1002;</i> <i class="layui-icon shou" id="sch">&#xe615;</i> 
            </div>
             
        </div>
        <!--<div style="margin:0 15px;">
            <div class="layui-form-item">
                <label class="layui-form-label">批量儲存:</label>
                <div class="layui-
                	input-block">
                    <input type="text" name="title" lay-verify="title" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>-->
        
        <!--弹出框-->
        <div id="pup">
        	<!--<span>ID<br/><input type="text" value="" id="va0"></span>-->
        	<span style="margin-left: 10%;">$t('盤頭編號')<i>*</i><input type="text" value="" id="va1"></span><br />
        	<span class="sp">$t('盤頭條號')<i>*</i><input type="text" value="" id="va2"></span>
        	<span id="span_va3">$t('空盤頭重量')<i>*</i><input type="text" value="" id="va3"></span><br />
        	<span class="sp">$t('盤週')<i>*</i><input type="text" value="" id="va4"></span>
        	<span>$t('備註')<input type="text" value="" id="va5"></span><br />
        	<span class="sp">$t('編輯人')<i>*</i><input type="text" value="" id="va7"></span>
            <span class="layui-inline">$t('编机时间')<i>*</i><input type="text" value="" id="va6" class="test-n1"></span>
        	
        </div>
        
        <!--弹编辑-->
        <div id="et">
        	<span>$t('盤頭編號')<input type="text" value="" id="bv1"></span>
        	<span class="sp">$t('盤頭條號')<input type="text" value="" id="bv2"></span><br />
        	<span id="bv3_span">$t('空盤頭重量')<input type="text" value="" id="bv3"></span>
        	<span class="sp">$t('盤週')<input type="text" value="" id="bv4"></span><br />
        	<span>$t('備註')<input type="text" value="" id="bv5"></span>
        	<span>$t('編輯時間')<input type="text" value="" id="bv6" disabled="disabled"></span>
        	<span>$t('編輯人')<input type="text" value="" id="bv7" disabled="disabled"></span>
        </div>
        
        <!--搜索框-->
        <div id="search">
        	<select id="sel1">
        		<option value="BEAM_NO">$t('盤頭編號')</option>
        		<option value="BEAM_CODE">$t('盤頭條號')</option>
        		<option value="EM_BEAM_WEIGHT">$t('空盤頭重量')</option>
        		<option value="INNER_CIRCUMFERENCE">$t('盤週')</option>
        		<option value="REMARK">$t('備註')</option>
        		<option value="MODIFY_DATE">$t('編輯時間')</option>
        	</select>
        	<select id="sel2">
        		<option value="cn">$t('包含')</option>
        		<option value="eq">$t('等於')</option>
        		<option value="bw">$t('開始於')</option>
        		<option value="bn">$t('不開始於')</option>
        		<option value="nc">$t('不包含')</option>
        		<option value="ew">$t('結束於')</option>
        		<option value="en">$t('不結束於')</option>
        	</select>
        	<input type="text" value="" id="text"/>
        </div>
    <script type="text/javascript" src="plugins/servies.js" ></script>
    <script type="text/javascript" src="plugins/layui/layuis.all.js"></script>
    <script type="text/javascript" src="plugins/layui/lay/modules/tables.js" ></script>
    <script type="text/javascript" src="build/js/jquery.js" ></script>
    <script src="build/js/di18n.js"></script>
    <script src="build/js/lang.js"></script>
    <script>
        	
    	var a;
    	var ta;
    	var name;
        	
		layui.use(['laydate','table'],function(){
  			var laydate = layui.laydate;
  			var table = layui.table;
  			 //直接嵌套显示
			laydate.render({
				elem: '.test-n1'
			});
		  
  		});
      	var colArr1 = [ //表头
			{radio: true, LAY_RadioCHECKED:false,width:20}
			,{field: 'beamNo', title: '盤頭編號',unresize: true,width:130}
		  	,{field: 'beamCode', title: '盤頭條號',unresize: true,width:130}
		  	,{field: 'emBeamWeight', title: '空盤頭重量',unresize: true,width:130} 
		  	,{field: 'innerCircumference', title: '盤週',unresize: true,width:130}
		 	,{field: 'remark', title: '備註',unresize: true,width:130}
		  	,{field: 'createduser', title: '編輯人',unresize: true,width:130}
		  	,{field: 'modifyDate', title: '編輯時間',unresize: true,width:160,templet: '<div>{{ layui.laytpl.toDateString(d.modifyDate) }}</div>'}
		];
        arrchangeL(colArr1);

       	// layUI请求，table的数据获取 
        layui.use(['table','laytpl'], function(){
          	var laytpl = layui.laytpl;
          	var table = layui.table;

			table.render({
				elem: '#demo'
				,height: 415,
				response: {
				  statusName: 'status' //数据状态的字段名称，默认：code
				  ,statusCode: 200 //成功的状态码，默认：0
				  ,msgName: 'message' //状态信息的字段名称，默认：msg
				  ,countName: 'totals' //数据总数的字段名称，默认：count
				  ,dataName: 'data' //数据列表的字段名称，默认：data
				},
				request: {
				    pageName: 'page' //页码的参数名称，默认：page
				    ,limitName: 'rows' //每页数据量的参数名，默认：limit
				} 
				,url: getAjaxURL('/beammodelmaintenance/listBeamModel') //数据接口
				,page: true //开启分页
				,cols: [colArr1]
				,id:'aaa' 
				,limit:10
				,limits:[10,30,50]
				,done: function (res,curr,count) {
                    $('.layui-table-cell')[0].style.visibility = 'hidden';
                }
			});
			
			//radio
			table.on('radio(test)', function(obj){
				ta = obj.checked;
				//如果触发的是全选，则为：all，如果触发的是单选，则为：one
				data=obj.data;
				a=data
				//console.log(obj.checked); //当前是否选中状态
				//console.log(obj.data); //选中行的相关数据
				name = obj.data.beamNo;
				//console.log(name)				  
			});		

        	//点击编辑
			$('#edit')[0].onclick=function(){
				console.log(ta);
				console.log(a)
				if(ta==true){
					$('#bv1').val(a.beamNo);
					$('#bv2').val(a.beamCode);
					$('#bv3').val(a.emBeamWeight);
					$('#bv4').val(a.innerCircumference);
					$('#bv5').val(a.remark);
					$('#bv6').val(layui.laytpl.toDateString(a.modifyDate));
					$('#bv7').val(a.modifyBy);
					
					layer.open({
					    btn: [strchangeL('提交'), strchangeL('取消')],
	                    type: 1,
	                    title:strchangeL('編輯'),
	                    area: ['400px', '280px'],
	                    content:$('#et'),
	                    btn2: function(){
                     		$("#et").css('display','none')
                     		layer.closeAll();
                    	},

	                    yes:function(){

	                    	if (!Number($('#bv3').val()) && $('#bv3').val() !=0 ) {
	                    		layer.alert(strchangeL("空盤頭重量:请输入有效数字"),{title: "提示"});
								return
	                    	}

	                    	if (!Number($('#bv4').val()) && $('#bv4').val() !=0 ) {
	                    		layer.alert(strchangeL("盤週:请输入有效数字"),{title: "提示"});
								return
	                    	}

							$.ajax({
		                    	type:'GET',    								
		                    	url:getAjaxURL('/beammodelmaintenance/saveOrUpdateBeamModel'),
		                    	data:{
		                    		beam_no:$('#bv1').val()
									,beam_code:$('#bv2').val()
									,em_beam_weight:$('#bv3').val()
									,inner_circumference:$('#bv4').val()
									,remark:$('#bv5').val()
									,modify_by:$('#bv7').val()
									,modify_date:$('#bv6').val()
									,oper:"update"

								},
		                    	success:function(data){
								 	// var bv3_a=document.getElementById('bv3').value
				                    if(data.status == 200){
										$("#et").css('display','none');
			                     		layer.closeAll();
										layer.alert(data.message)
				                    	table.reload('aaa', {
											url:getAjaxURL('/beammodelmaintenance/listBeamModel')
										});
										//同时需要清除ta
										ta = '';
				                    }else{
				                    	layer.alert(data.message,{title: strchangeL("提示")});
				                    }
		                    	}
		                   	});

	                    }
					})
				}else{
					layer.alert(strchangeL("请选中再编辑"),{title: strchangeL("提示")});
				}
			};

			//点击新增
			$('#shou1')[0].onclick = function(){
				layer.open({
				    btn: [strchangeL('提交'), strchangeL('取消')],
	                type: 1,
	                title:strchangeL('新增'),
	                area: ['400px', '280px'],
	                content:$('#pup'),
	            	btn2: function(){
		                $("#pup").css('display','none')
		                layer.closeAll();
		                empty();
	            	},    
					yes:function(){

						
						if ($('#va1').val()=='') 
						{
							//alert("无法获取盤頭編號")
							layer.alert(strchangeL("无法获取盤頭編號"),{title: strchangeL("提示")});
							return 
						} else if($('#va2').val()=='')
						{
							//alert("无法获取盤頭條號")
							layer.alert(strchangeL("无法获取盤頭條號"),{title: strchangeL("提示")});
							return 
						}else if($('#va3').val()=='')
						{
							//alert("无法获取空盤頭重量")
							layer.alert(strchangeL("无法获取空盤頭重量"),{title: strchangeL("提示")});
							return 
						}else if($('#va4').val()=='')
						{
							//alert("无法获取盤週")
							layer.alert(strchangeL("无法获取盤週"),{title: strchangeL("提示")});
							return 
						}else if($('#va7').val()=='')
						{
							//alert("无法获取編輯人")
							layer.alert(strchangeL("无法获取編輯人"),{title: strchangeL("提示")});
							return	
						}else if($('#va6').val()=='')
						{
							//alert("无法获取編輯時間")
							layer.alert(strchangeL("无法获取編輯時間"),{title: strchangeL("提示")});
							return
						}

						if (!Number($('#va3').val()) && Ava3 != 0) {
							layer.alert(strchangeL("空盤頭重量:请输入有效数字"),{title: strchangeL("提示")});
							return
						}

						if (!Number($('#va4').val()) && Ava4 != 0) {
							layer.alert(strchangeL("盤週:请输入有效数字"),{title: strchangeL("提示")});
							return
						}

						$.ajax({
							type:'GET',
							url:getAjaxURL('/beammodelmaintenance/saveOrUpdateBeamModel'),
							data:{
								beam_no:$('#va1').val()
								,beam_code:$('#va2').val()
								,em_beam_weight:$('#va3').val()
								,inner_circumference:$('#va4').val()
								,remark:$('#va5').val()
								,modify_by:$('#va7').val()
								,modify_date:$('#va6').val()
							},
							success:function(data){
								console.log(data)

								if(data.status == 200){

									$("#pup").css('display','none')
			                		layer.closeAll();
									empty();//调用新增清空value方法
									        
								   	layer.alert(data.message)
								    table.reload('aaa', {
										url:getAjaxURL('/beammodelmaintenance/listBeamModel')
									});
								}else{
									layer.alert(data.message,{title: strchangeL("提示")});
								};
								
							}

						})


					},
					
				});

				//清空新增value值	
				function empty(){
					$('#va1').val('');
					$('#va2').val('');
					$('#va3').val('');
					$('#va4').val('');
					$('#va5').val('');
					$('#va6').val('');
					$('#va7').val('');
				}
			}

			//点击 删除
			$('#del')[0].onclick = function(){
		  	  	if(ta==true){
		  	  	// if(name!== ''){
			  	  	layer.open({
						area: ['200px', '150px']
						,title:strchangeL('删除')
						,type:1
						,content: strchangeL('你确定删除吗')
						,btn: [strchangeL('删除'), strchangeL('取消')]
						,btn2: function(){
							layer.closeAll();
						}
					  	,yes: function(){
				  	  	  	$.ajax({
					      	  	url:getAjaxURL('/beammodelmaintenance/delteBeamModel'),
					      	  	data:{
                                  	beam_no:name
					      	  	},
					      	  	success:function(data){
					      	  		if (data.status == 200) {
					      	  			layer.closeAll();
						      	  	  	//alert("删除成功")
						      	  	  	layer.alert(strchangeL("删除成功"),{title: strchangeL("提示")});
	                                  	table.reload('aaa', {
										  	url:getAjaxURL('/beammodelmaintenance/listBeamModel') 
									  	});
									  	name = '';
									  	//同时需要清除ta
										ta = '';
					      	  		} else {
					      	  			layer.alert(data.message)
					      	  		}
					      	  		
					      	  	}
					      	})
					  	}
				  	});
				}else{
				  	layer.alert(strchangeL("请选择删除行"),{title: strchangeL("提示")});
				}
		  	};

			//点击刷新
			$('#Ref').click(function(){
				//调用table
				table.reload('aaa', {
					url:getAjaxURL('/beammodelmaintenance/listBeamModel')
				});
				//同时需要清除ta
				ta = '';
			})
			

        });
		
		//点击搜索
		layui.use(['laydate','table','laytpl'],function(){
  			var laydate = layui.laydate;
  			var table = layui.table;
  			var laytpl = layui.laytpl;
			
			$('#sch').click(function(){
				layer.open({
					type: 1,
                    title:strchangeL('搜尋')+'...',
                    btn: [strchangeL('搜尋'), strchangeL('重設')],
                    area: ['470px', '150px'],
                    content:$('#search'),
                    yes: function(){
                    	$("#search").css('display','none');
						layer.closeAll();
						if($('#text').val()==""){
							//重新加载table数据
							table.reload({										                                
                        		url:getAjaxURL('/beammodelmaintenance/queryBeamModelByCondition')
                         	});
								layer.alert("搜索不能为空",{title: strchangeL("提示")});
						}else{
							table.reload('aaa', {										                                
                        	url:getAjaxURL('/beammodelmaintenance/queryBeamModelByCondition')
                        	//回调参数
                         	,where: {
                             	queryName:$('#sel1').val(),
              				    queryCondition:$('#sel2').val(),
              				    queryValue:$('#text').val(),
                        	}
						});
						};
                      	
						$('#text').val('');
                        ta = '';

                		

                  	},
                  	btn2:function(){
//                		$("#search").css('display','none')
//						layer.closeAll();
						$('#text').val('');
						table.reload('aaa', {
				  			url: getAjaxURL('/beammodelmaintenance/listBeamModel')
						});
//                      ta = '';
                        $("#search").css('display','none')
                  	}
				});
			})

				
			
		})

	</script>
	
	<script>
			
		 //时间戳的处理
	 	function refresh(){
				 	
          	layui.laytpl.toDateString = function(d, format){
				var date = new Date(d || new Date())

				,ymd = [
				this.digit(date.getFullYear(), 4)
				,this.digit(date.getMonth() + 1)
				,this.digit(date.getDate())
				]

				format = format || 'yyyy-MM-dd';

				return format.replace(/yyyy/g, ymd[0])
				.replace(/MM/g, ymd[1])
				.replace(/dd/g, ymd[2])

			};
					 
					//数字前置补零
			layui.laytpl.digit = function(num, length, end){
				var str = '';
				num = String(num);
				length = length || 2;
				for(var i = num.length; i < length; i++){
					str += '0';
				}
				return num < Math.pow(10, length) ? str + (num|0) : num;
			};
        };
		</script>
		<!-- 公共方法---时间戳转时间 -->
		<script>
            function timestampToTime(timestamp) {
                var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
                Y = date.getFullYear() + '-';
                M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
                D = date.getDate() + ' ';
                return Y+M+D;
            }
		</script>
    </body>

</html>

