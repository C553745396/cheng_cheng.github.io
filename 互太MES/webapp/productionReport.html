<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>纬编机台产量报表</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<!--<script type="text/javascript" src="plugins/servies.js" ></script>-->
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<!--<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
	</head>

	<body>
		
			<div class="top">
				<span>$t('機台生產狀態查詢')</span>
			</div>
			<div style='margin:10px 0;'>
				<button class="layui-btn layui-btn-small" id="btnExecute">$t("執 行")</button>
	        	<button class="layui-btn layui-btn-small" id="btnExcel" >$t('Excel')</button>
			</div>
			<div style="display: block; width: 100%;height: 40px;">
			    <span class='f' style="margin-left: 29px;">
			    	<label class="layui-form-label">$t('工廠')</label>
					<div class="layui-inline">
						<input type="text" value="" id="txtPlant" >
				    </div>
			    </span>
				<span class='f' style="margin-left: 20px;">
					<label class="layui-form-label">$t('工單號碼')</label>
					<div class="layui-inline">
						<!--<input type="text" value="800000034" id="txtProdOrder">-->
							<input type="text" value="" id="txtProdOrder">
				    </div>
				</span>
				<span class='f' style="margin-left: 42px;">
					<label class="layui-form-label">$t('布號')</label>
					<div class="layui-inline">
						<input type="text" value="" id="txtFabric">
				    </div>
				</span>
				<span class='f' style="margin-left: 42px;">
					<label class="layui-form-label">$t('顯示已完成工單')</label>
					<div class="layui-inline">
						<input type="checkbox" value="" id="chkbxFinishedOrder">
				  </div>
				</span>
				
			</div>
		
		<div style="display: block;width: 100%;height: 40px;">
		    
			    <span class='f'>
			    	<label class="layui-form-label">$t('物料分組')</label>
					<div class="layui-inline">
						<input type="text" value="" id="txtMaterialGrp">
				    </div>
			    </span>
				<span class='f'>
					<label class="layui-form-label">MRP $t('控制者')</label>
					<div class="layui-inline">
						<input type="text" value="" id="txtMRPController">
				    </div>
				</span>
				<span class='f v_d'>
					<label class="layui-form-label">$t('生產調度員')</label>
					<div class="layui-inline">
						<input type="text" value="" id="txtMRPScheduler">
				    </div>
				</span>
			
		</div>
		
		
		
		<div class="m">
			
			<table class="layui-table" lay-data="{height:315}" lay-filter="test" id="dome">
			  			  
			</table>
			<ul id="ui1">
				
				<li class="li2">$t('生产机号')</li>
				<li class="li2">$t('工單数量')</li>
				<li class="li2">$t('确认数量')</li>
				<li class="li2">$t('报废数量')</li>
				<li class="li2">$t('待生产数')</li>
				
			</ul>
			<ul id="ui2">
				
				<li class="li2">$t('總計'):</li>
				<li class="li2 li0_li2">0.00</li>
				<li class="li2 li1_li2">0.00</li>
				<li class="li2 li2_li2">0.00</li>
				<li class="li2 li3_li2">0.00</li>
				
			</ul>
			<div><i class="layui-icon shou" id='shou4'>&#x1002;</i></div>
			
		</div>
		<script src="plugins/servies.js"></script>
		<script type="text/javascript" src="plugins/layui/layuis.all.js"></script>
		<script type="text/javascript" src="build/js/jquery.js"></script>
		<script src="build/js/di18n.js"></script>
        <script src="build/js/lang.js"></script>
        <script>
        	 //多语言动态生成
            var colArr = [ //表头
              //{checkbox:true, fixed: 'left'},
						//{radio: true, LAY_RadioCHECKED: false,width:20},
				      	{field: 'salesorder', title: '销售单号',unresize: true,width:80,event: 'setSign'}
	                    ,{field: 'prodOrder', title: '工單號碼',unresize: true,width:80,event: 'setSign'}
	                    ,{field: 'fabricNo', title: '布号',unresize: true,width:40,event: 'setSign'}
	                    ,{field: 'needleNo', title: '针数',unresize: true,width:40,event: 'setSign'}
	                    ,{field: 'inches', title: '寸数',unresize: true,width:40,event: 'setSign'}
			   			,{field: 'totNeedle', title: '总针数',unresize: true,width:60,event: 'setSign'}
			      		,{field: 'yarnDesc', title: '用纱描述',unresize: true,width:80,event: 'setSign'}
			   			,{field: 'machineNo', title: '生产机号',unresize: true,width:80,event: 'setSign'}
			     		,{field: 'orderQty', title: '工單数量',unresize: true,width:80,event: 'setSign'}	
			     		,{field: 'confirmQty', title: '确认数量',unresize: true,width:80,event: 'setSign'}
			      		,{field: 'scrapQuantity', title: '报废数量',unresize: true,width:80,event: 'setSign'}
			    		,{field: 'quantityRemain', title: '待生产数',unresize: true,width:80,event: 'setSign'}
			    		,{field: 'operationFinishDate', title: '齐胚日期',unresize: true,width:80,event: 'setSign'}
			    		,{field: 'orderFinishDate', title: '成品交期',unresize: true,width:80,event: 'setSign'}
			    		,{field: 'yarnLength', title: '纱长',unresize: true,width:40,event: 'setSign'}
			    		,{field: 'yarnBatch', title: '紗線批次',unresize: true,width:80,event: 'setSign'}
			    		,{field: 'colorDepth', title: '胚布深中浅',unresize: true,width:90,event: 'setSign'}
			    		,{field: 'orderStatus', title: '工单状态',unresize: true,width:80,event: 'setSign'}
            ];
            arrchangeL(colArr);
        </script>
		<script>
			console.log(window.location.href)
	layui.use('table', function(){
			  var table = layui.table;
			  var clickData = '';
			  
			  
			  
			//table数据的展示  
			  function Pageload(){
			  	table.render({
				    elem: '#dome'
				    ,height: 315
				    ,method:'POST'
				    //,url: getAjaxURL('/mes/warpShiftWorkMaintainReport/listShiftWorkMaintainReport') //数据接口
				    ,url:getAjaxURL('/weftMachineReport/getMachineReportDetailsFirstXQT')
				    
				    ,page: false //开启分页
				    ,response: {
	                      statusName: 'status' //数据状态的字段名称，默认：code
	                      ,statusCode: 200 //成功的状态码，默认：0
	                      ,msgName: 'message' //状态信息的字段名称，默认：msg
	                      ,countName: 'totals' //数据总数的字段名称，默认：count
	                      ,dataName: 'data' //
	                	}
				    ,cols: [colArr]
				    ,done:function(res, curr, count){
//				    	alert(22222)
							console.log(res)
							$('.li0_li2').text(res.total.totalConfirmQty);
							$('.li1_li2').text(res.total.totalOrderQty);
							$('.li2_li2').text(res.total.totalScrapQuantity);
							$('.li3_li2').text(res.total.totalQuantityRemain);
						    //console.log($('.li0_li2')[0].innerText=res.total.totalConfirmQty)
							console.log(res.total.totalConfirmQty)
							
							$('.layui-table').delegate('td','dblclick',function(){
				    			console.log(123)
			                 	console.log(clickData)
				             	 window.location.href="productionReport_page.html?prodOrd="+clickData.prodOrder;   
				            }) 
						}
				    ,id:'idTest11'
				   
				    ,where: {
                         	plant:$('#txtPlant').val(),
                         	prodOrd:$('#txtProdOrder').val(),
          				   	fabric:$('#txtFabric').val(),
          				   	matGrp:$('#txtMaterialGrp').val(),
          				   	mrpController:$('#txtMRPController').val(),
          				   	mrpScheduler:$('#txtMRPScheduler').val(),
          				   	displayFinishedOrderFlag:$('#chkbxFinishedOrder’').val()
          			}
//				    ,done:function(){
//				    	$('.layui-table').delegate('td','dblclick',function(){
//				    		console.log(123)
//			                 console.log(clickData)
//			              window.location.href="productionReport_page.html?prodOrd="+clickData.prodOrder;   
//			            })  
//				    }
				  });
				  
				  	//监听单元格事件
					table.on('tool(test)', function(obj){
		//				console.log(obj,111111111111111111)
					    var data = obj.data;
					    console.log(obj.data)
		//			    var getval=obj.data.prodOrder;
		//			    console.log(obj.event)
					    clickData = obj.data;
					    console.log(clickData)
					  	console.log(clickData.prodOrder)
//					    if(obj.event === 'setSign'){
//		
////							window.location.href="productionReport_page.html?prodOrd="+getval;
//					      
//					    }
		
					 });
		   
			  	}
				  //执行一个table实例
				  
				  //執行
				  
				  $('#btnExecute').click(function(){
				 		
			  			$('.li0_li2').text('0.00');
						$('.li1_li2').text('0.00');
						$('.li2_li2').text('0.00');
						$('.li3_li2').text('0.00');
				  	//alert(1)
				  	
				  	var AtxtPlant=$('#txtPlant').val();//工廠
				  	var AtxtMaterialGrp=$('#txtMaterialGrp').val();//物料分組
				  	var AtxtProdOrder=$('#txtProdOrder').val();//工單號碼
				  	var AtxtMRPController=$('#txtMRPController').val();//MRP 控制者
				  	var AtxtFabric=$('#txtFabric').val();//布號
				  	var AtxtMRPScheduler=$('#txtMRPScheduler').val();//生產調度員
				  	var AchkbxFinishedOrder=$('#chkbxFinishedOrder').checked?1:0;//顯示已完成工單
				  	var displayFinishedOrderFlag = "N";
				  	console.log(AchkbxFinishedOrder)
				  	if ($('#chkbxFinishedOrder').is(":checked")) {
						displayFinishedOrderFlag = "Y";
					}
					if (AtxtPlant == "") {
						AtxtPlant = ""
					}
					if (AtxtProdOrder  == "") {
						AtxtProdOrder = ""
					}
					if (AtxtFabric == "") {
						AtxtFabric = ""
					}
					if (AtxtMaterialGrp == "") {
						AtxtMaterialGrp = ""
					}
					if (AtxtMRPController == "") {
						AtxtMRPController = ""
					}
					if (AtxtMRPScheduler == "") {
						AtxtMRPScheduler = ""
					}
					Pageload();
				  	
				   	
				  });
				 
			  
			  
			  //点击Excel
	  		var AtxtPlant=document.getElementById('txtPlant');//工廠
		  	var AtxtMaterialGrp=document.getElementById('txtMaterialGrp');//物料分組
		  	var AtxtProdOrder=document.getElementById('txtProdOrder');//工單號碼
		  	var AtxtMRPController=document.getElementById('txtMRPController');//MRP 控制者
		  	var AtxtFabric=document.getElementById('txtFabric');//布號
		  	var AtxtMRPScheduler=document.getElementById('txtMRPScheduler');//生產調度員
		  	var AchkbxFinishedOrder=document.getElementById('chkbxFinishedOrder');//顯示已完成工單
		  	//Excel
		  	var AbtnExcel=document.getElementById('btnExcel');
	AbtnExcel.onclick=function(){
		//alert(1)
		window.location.href=getAjaxURL('/mes/weftMachineReport/excel?plant='                                                    			+AtxtPlant.value+"&prodOrd="+AtxtProdOrder.value+"&fabric="+AtxtFabric.value+"&matGrp="+AtxtMaterialGrp.value+"&mrpController="+AtxtMRPController.value+"&mrpScheduler="+AtxtMRPScheduler.value+"&displayFinishedOrderFlag="+AchkbxFinishedOrder.value);

	  
		};
			
			
			//刷新

				$('#shou4').click(function(){
					table.reload('idTest11', {
						url:getAjaxURL("/weftMachineReport/getMachineReportDetailsFirstXQT")
					});
				});
});
    </script>
	</body>

</html>
<style scoped>
	.m{
		margin:0 15px;
		clear: both;
	}
	*{
    	margin: 0;
    	padding: 0;
    }
	.top{
		height: 22px;
		line-height: 22px;
		font-size: 16px;
		border-bottom: 1px rgb(26,160,148) solid;
	}
	.layui-input{
		height: 25px;
	}
	/*.v_d{
		visibility:hidden;
	}*/
	.layui-input-inline{
		padding: 9px 0;
		width: 170px!important;
	}
	.layui-form-label{
		width: auto;
		padding: 0 15px;
	}
	.clearfix:after{
		content: '';
		display: table;
		clear:both;
		visibility: hidden;
	}
	
	.f{
		float: left;
		display: block;
	}
	.r{
		color: red;
	}
	.layui-btn-small{
		padding: 0px 26px;
	}
	#input1{
		width: 20px;
		height: 20px;
	}
	
	#ui1 li,#ui2 li{float: left;border:1px solid #E2E2E2;text-align: center;height: 30px;line-height: 30px;}
	#ui1{height: 40px;}
	#ui2{clear: both;height: 40px;}
	#ui1 .li0,#ui2 .li0{width: 120px;}
	#ui1 .li1,#ui2 .li1{width: 60px;}
	#ui1 .li2,#ui2 .li2{width: 15%;}
	#ui1 .li3,#ui2 .li3{width: 100px;border-right:1px solid #E2E2E2}
	.layui-table-view{margin-bottom: 0px;}
	.laytable-cell-3-salesorder{text-align: center;}
	.layui-table td, .layui-table th{padding: 0px;}
	.layui-table-cell{padding: 0px;text-align: center;}
</style>