<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>打印机头纸</title>
	<meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script type="text/javascript" src="plugins/servies.js" ></script>
    <link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
    <link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">
</head>
<body>
	<div class="top">
		盤頭批次信息
	</div>
    <div class="tops">
    	<label for="">機頭紙編號:</label><input type="text" id="JobsheetNo">
    	<label for="" style="margin-left:30%">工作中心:</label><input type="text" id="materialNo">
    </div>
    <div>
    <span class="topss tab1" style="float:left">
    	<table id="demo1" lay-filter="test1"></table>
    	<i class="layui-icon shou" id='add1'>&#xe654;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='delete1'>&#xe640;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='search1'>&#xe615;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='renovate1'>&#x1002;</i>
    </span>
    <span class="topss tab2" style="float:left">
    	<table id="demo2" lay-filter="test2"></table>
    	<i class="layui-icon shou" id='add2'>&#xe654;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='delete2'>&#xe640;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='search2'>&#xe615;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='renovate2'>&#x1002;</i>
    </span>
    <span class="topss tab3" style="float:left">
    	<table id="demo3" lay-filter="test3"></table>
    	<i class="layui-icon shou" id='add3'>&#xe654;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='delete3'>&#xe640;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='search3'>&#xe615;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='renovate3'>&#x1002;</i> 
    </span>
    <span class="topss tab4" style="float:left">
    	<table id="demo4" lay-filter="test4"></table>
    	<i class="layui-icon shou" id='add4'>&#xe654;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='delete4'>&#xe640;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='search4'>&#xe615;</i>&nbsp;&nbsp;<i class="layui-icon shou" id='renovate4'>&#x1002;</i>
    </span>
    </div>
    <hr>
    <div>
    	<button class="layui-btn layui-btn-small" style="margin:0 0 20px 45%" id="print">打印</button>
    </div>



    <!-- 弹出框 -->
    <!-- GB1盤頭批次--新增 -->
<div id="addO_Add" class="pad dis">
    <label for="">GB1盤頭批次</label><input type="text" id="recode1">
</div>
<!-- GB1盤頭批次--删除 -->
<div id="addO_Delete" class="pad dis">
    刪除已選記錄
</div>
<!-- GB1盤頭批次--搜索 -->
<div id="addO_Search" class="pad dis">
    <div>
        <select name="" id="queryName1">
            <option value="BATCH_NO">GB1盤頭批次</option>
            <option value="BATCH_QNTY">批次重量(KG)</option>
        </select>
        <select name="" id="ueryCondition1">
            <option value="eq">等於</option>
            <option value="ne">不等於</option>
            <option value="bw">開始於</option>
            <option value="bn">不開始於</option>
            <option value="ew">結束於</option>
            <option value="en">不結束於</option>
            <option value="cn">包含</option>
            <option value="nc">不包含</option>
            <option value="in">is null</option>
            <option value="nn">is not null</option>
            <option value="bc">在其中</option>
            <option value="nb">不在其中</option>
        </select>
        <input type="text" id="queryValue1">
    </div>
</div>
<!-- GB2盤頭批次--新增 -->
<div id="addT_Add" class="pad dis">
    <label for="">GB2盤頭批次</label><input type="text" id="recode2">
</div>
<!-- GB2盤頭批次--删除 -->
<div id="addT_Delete" class="pad dis">
    刪除已選記錄
</div>
<!-- GB2盤頭批次--搜索 -->
<div id="addT_Search" class="pad dis">
    <div>
        <select name="" id="queryName2">
            <option value="BATCH_NO">GB2盤頭批次</option>
            <option value="BATCH_QNTY">批次重量(KG)</option>
        </select>
        <select name="" id="ueryCondition2">
            <option value="eq">等於</option>
            <option value="ne">不等於</option>
            <option value="bw">開始於</option>
            <option value="bn">不開始於</option>
            <option value="ew">結束於</option>
            <option value="en">不結束於</option>
            <option value="cn">包含</option>
            <option value="nc">不包含</option>
            <option value="in">is null</option>
            <option value="nn">is not null</option>
            <option value="bc">在其中</option>
            <option value="nb">不在其中</option>
        </select>
        <input type="text" id="queryValue2">
    </div>
</div>
<!-- GB3盤頭批次--新增 -->
<div id="addS_Add" class="pad dis">
    <label for="">GB3盤頭批次</label><input type="text" id="recode3">
</div>
<!-- GB3盤頭批次--删除 -->
<div id="addS_Delete" class="pad dis">
    刪除已選記錄
</div>
<!-- GB3盤頭批次--搜索 -->
<div id="addS_Search" class="pad dis">
    <div>
        <select name="" id="">
            <option value="BATCH_NO">GB3盤頭批次</option>
            <option value="BATCH_QNTY">批次重量(KG)</option>
        </select>
        <select name="" id="">
            <option value="eq">等於</option>
            <option value="ne">不等於</option>
            <option value="bw">開始於</option>
            <option value="bn">不開始於</option>
            <option value="ew">結束於</option>
            <option value="en">不結束於</option>
            <option value="cn">包含</option>
            <option value="nc">不包含</option>
            <option value="in">is null</option>
            <option value="nn">is not null</option>
            <option value="bc">在其中</option>
            <option value="nb">不在其中</option>
        </select>
        <input type="text">
    </div>
</div>
<!-- GB4盤頭批次--新增 -->
<div id="addF_Add" class="pad dis">
    <label for="">GB4盤頭批次</label><input type="text" id="recode4">
</div>
<!-- GB4盤頭批次--删除 -->
<div id="addF_Delete" class="pad dis">
    刪除已選記錄
</div>
<!-- GB4盤頭批次--搜索 -->
<div id="addF_Search" class="pad dis">
    <div>
        <select name="" id="">
            <option value="BATCH_NO">GB4盤頭批次</option>
            <option value="BATCH_QNTY">批次重量(KG)</option>
        </select>
        <select name="" id="">
            <option value="eq">等於</option>
            <option value="ne">不等於</option>
            <option value="bw">開始於</option>
            <option value="bn">不開始於</option>
            <option value="ew">結束於</option>
            <option value="en">不結束於</option>
            <option value="cn">包含</option>
            <option value="nc">不包含</option>
            <option value="in">is null</option>
            <option value="nn">is not null</option>
            <option value="bc">在其中</option>
            <option value="nb">不在其中</option>
        </select>
        <input type="text">
    </div>
</div>
</body>
<script type="text/javascript" src="plugins/layui/layui.all.js"></script>
<script type="text/javascript" src="plugins/layui/lay/modules/table.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.11.3.min.js"></script>
<script>
    var printParams = {};
    // console.log(window.location.href.split('?')[1].split('&'))
    if (window.location.href.split('?')[1]) {
        window.location.href.split('?')[1].split('&').forEach(function(item,idx){
            var k = item.split('=')[0];
            var v = item.split('=')[1];
            printParams[k] = v;
        })
    }
    console.log(printParams)
    //特别注意：以下4个表格因增加、删除不走后台，前端需加模拟数据，因此layUI的表格重载时不能修改数据，故增加、删除时会ajax请求，然后在加入数据显示数据表格，此方法虽然繁琐，但却实用。
	$(document).ready(function(){
    //表格--数据渲染
    layui.use('table', function(){
        var table = layui.table;        
        //session传过来的值
        var receive1 = printParams.loca1;  
        var receive2 = printParams.loca2;  
        var receive3 = printParams.loca3;
        var receive4 = printParams.hdnOrderItem1;  
        var receive5 = printParams.hdnOrderItem2;  
        var receive6 = printParams.hdnOrderItem3;
        var receive7 = printParams.hdnOrderItem4;  
        var receive8 = printParams.Mat1;  
        var receive9 = printParams.Mat2;
        var receive10 = printParams.Mat3;  
        var receive11 = printParams.Mat4;
	    // console.log("session传过来的值---------------------------------------------")
	    // console.log(receive1)
	    // console.log(receive2)
	    // console.log(receive3)
	    // console.log(receive4)
	    // console.log(receive5)
	    // console.log(receive6)
	    // console.log(receive7)
	    // console.log(receive8)
	    // console.log(receive9)
	    // console.log(receive10)
	    // console.log(receive11)
	    $("#JobsheetNo").val(receive2);
        $("#materialNo").val(receive3);
        //  data1,data2,data3,data4:ajax获取请求表格数据的载体，方便在增加、删除、搜索时直接加入数据显示表格
        var data1,data2,data3,data4;
        var i1,i2,i3,i4;                                       //删除里面for循环的i
        var unit1,unit2,unit3,unit4;                           //复选框勾选后赋值比较
        var checkedidx1,checkedidx2,checkedidx3,checkedidx4;
        var group1 = [],group2 = [],group3 = [],group4 = [];   //判断是否有勾选，来进行删除
        //表格1--ajax获取数据
        // GB1盤頭批次--重载
        $("#renovate1").click(function(){
            $.ajax({
                url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                // async:false,
                data:{
                    OrderNo: receive1, 
                    OrderItem: receive4,
                    MaterialNo:receive8
                },
                success:function(res){
                    if (res.status == 200) {
                        data1 = res.data;   //此处的data
                        setTable1();
                    } else {
                        layer.alert(res.message, {title: "提示"});
                    }
                }
            });
        });
        $("#renovate1").click();

        //表格2--ajax获取数据
        // GB2盤頭批次--重载
        $("#renovate2").click(function(){
            $.ajax({
                url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                // async:false,
                data:{
                    OrderNo: receive1, 
                    OrderItem: receive5,
                    MaterialNo:receive9
                },
                success:function(res){
                    if (res.status == 200) {
                        data2 = res.data;
                        setTable2();
                    } else {
                        layer.alert(res.message,{title:'提示'})
                    }
                }
            });
        });
        $("#renovate2").click();
        
        //表格3--ajax获取数据
        // GB3盤頭批次--重载
        $("#renovate3").click(function(){
            $.ajax({
                url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                // async:false,
                data:{
                    OrderNo: receive1, 
                    OrderItem: receive6,
                    MaterialNo:receive10
                },
                success:function(res){
                    if (res.status == 200) {
                        data3 = res.data;   //此处的data
                        setTable3();
                    } else {
                        layer.alert(res.message, {title: "提示"});
                    }
                }
            });
        });
        $("#renovate3").click();

        //表格4--ajax获取数据
        // GB4盤頭批次--重载
        $("#renovate4").click(function(){
            $.ajax({
                url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                // async:false,
                data:{
                    OrderNo: receive1, 
                    OrderItem: receive7,
                    MaterialNo:receive11
                },
                success:function(res){
                    if (res.status == 200) {
                        data4 = res.data;   //此处的data
                        setTable4();
                    } else {
                        layer.alert(res.message, {title: "提示"});
                    }
                }
            });
        });
        $("#renovate4").click();


        function setTable1(){
		    //第一个表格
		    table.render({
		        elem: '#demo1',
    		    height: 315,
    		    // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                data:data1,
    		    cols: [[ //表头
    		        {checkbox: true},
    		        {field: 'BATCH_NO', title: 'GB1盤頭批次', width:120},
    		        {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
    		    ]],
                done: function (res,curr,count) {
                    $('.layui-table-cell')[0].style.zIndex = '-2';
                    unit1 = ''
                }
		    });

            //表格1-监听复选框选择--获取行数据
            table.on('checkbox(test1)', function(obj){
                // console.log(obj.checked); //当前是否选中状态
                // console.log(obj.data); //选中行的相关数据
                // console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
                
                unit1 = '';

                //取消其餘的點亮
                if (obj.checked) {
                    if (checkedidx1) {
                        $('.tab1').find('tr .layui-form-checkbox').eq(checkedidx1).click()
                    }
                    //顺序
                    unit1 = obj.data;
                    checkedidx1 = obj.data.LAY_TABLE_INDEX+1;
                } else {
                    checkedidx1 = '';
                }

                // jusdge1 = obj.checked;
                // if(jusdge1){      //删除中判断是否有勾选框
                //     group1.push(obj.data)
                // }else{
                //     group1.forEach(function(value,index){
                //         if(cmp(group1[index],obj.data)==true){
                //             group1.splice(index,1)    //删除相同的对象
                //         };
                //     })
                // };
                
            });
        }
            // GB1盤頭批次--新增
			$("#add1").click(function(){
                layer.open({
                    area: ['400px', '280px']
                    ,title:'新增記錄'
                    ,type:1
                    ,content: $('#addO_Add')
                    ,btn: ['提交', '取消']
                    ,cancel: function(){ 
                        $('#addO_Add').css('display','none')
                    }
                    ,yes: function(index, layero){
                        data1.push({
                            BATCH_NO:$("#recode1").val()
                        });
                        //第一个表格--新增一条数据
                        table.render({
                            elem: '#demo1',
                            height: 315,
                            // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:data1,
                            cols: [[ //表头
                                {checkbox: true},
                                {field: 'BATCH_NO', title: 'GB1盤頭批次', width:120},
                                {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                            ]],
                            done: function (res,curr,count) {
                                $('.layui-table-cell')[0].style.zIndex = '-2';
                            }
                        });
                        $("#recode1").val("")  //清空-GB1盤頭批次-input框
                        layer.close(index)  //取消加载中
                        $('#addO_Add').css('display','none')
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addO_Add').css('display','none')
                    }
                });
			});
			// GB1盤頭批次--删除
			$("#delete1").click(function(){
                if(group1 === undefined||group1.length == 0){
                    layer.alert('請選擇壹行', {
                        title: "提示"
                    });
                }else{
                    layer.open({
                        area: ['400px', '280px']
                        ,title:'删除'
                        ,type:1
                        ,content: $('#addO_Delete')
                        ,btn: ['删除', '取消']
                        ,cancel: function(){ 
                            $('#addO_Delete').css('display','none')
                        }
                        ,yes: function(index, layero){
                            table.render({
                                elem: '#demo1',
                                height: 315,
                                // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                data:data1,
                                cols: [[ //表头
                                    {checkbox: true},
                                    {field: 'BATCH_NO', title: 'GB1盤頭批次', width:120},
                                    {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                ]],
                                done: function (res,curr,count) {
                                    $('.layui-table-cell')[0].style.zIndex = '-2';
                                }
                            });
                            
                            group1 = [];
                            layer.close(index);
                            $('#addO_Delete').css('display','none')
                        }
                        ,btn2: function(index, layero){
                            layer.closeAll();
                            $('#addO_Delete').css('display','none')
                        }
                    });
                }
			});
			// GB1盤頭批次--搜索
			$("#search1").click(function(){
				// console.log(123)
                layer.open({
                    area: ['450px', '280px']
                    ,title:'搜尋'
                    ,type:1
                    ,content: $('#addO_Search')
                    ,btn: ['搜尋', '取消']
                    ,cancel: function(){ 
                        $('#addO_Search').css('display','none')
                    }
                    ,yes: function(index, layero){
                        $.ajax({
                            url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:{
                                OrderNo: receive1, 
                                OrderItem: receive4,
                                MaterialNo:receive8,
                                queryName:document.getElementById("queryName1").value,
                                queryCondition:document.getElementById("ueryCondition1").value,
                                queryValue:document.getElementById("queryValue1").value
                            },
                            success:function(res){
                                console.log(res)
                                if(res.status == 200){
                                    table.render({
                                        elem: '#demo1',
                                        height: 315,
                                        // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                        data:res.data,
                                        cols: [[ //表头
                                            {checkbox: true},
                                            {field: 'BATCH_NO', title: 'GB1盤頭批次', width:120},
                                            {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                        ]],
                                        done: function (res,curr,count) {
                                            $('.layui-table-cell')[0].style.zIndex = '-2';
                                        }
                                    });
                                    layer.closeAll();
                                    $('#addO_Search').css('display','none')
                                    $("#queryValue1").val("")
                                }else{
                                    layer.alert(res.message, {
                                        title: "提示"
                                    });
                                }
                            }
                        })
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addO_Search').css('display','none')
                    }
                });
			});
            
            
        // data2 = [{
        //     BATCH_NO:0000000469,
        //     BATCH_QNTY:10
        // },{
        //     BATCH_NO:0000000471,
        //     BATCH_QNTY:10
        // }]    
        // setTable2()
        function setTable2(){
		    //第二个表格
		    table.render({
    		    elem: '#demo2',
    		    height: 315,
    		    // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                data:data2,
    		    cols: [[ //表头
    		        {checkbox: true},
    		        {field: 'BATCH_NO', title: 'GB2盤頭批次', width:120},
    		        {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
    		    ]],
                done: function (res,curr,count) {
                    $('.tab2 .layui-table-cell')[0].style.zIndex = '-2';
                    unit2 = '';
                    //默认第一个点亮
                    // $('.tab2').find('tr .layui-form-checkbox').eq(1).click();
                }
		    });

            //表格2-监听复选框选择--获取行数据
            table.on('checkbox(test2)', function(obj){
                // console.log(obj.checked); //当前是否选中状态
                // console.log(obj.data); //选中行的相关数据
                // console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
                unit2 = '';
                //取消其餘的點亮
                if (obj.checked) {
                    if (checkedidx2) {
                        $('.tab2').find('tr .layui-form-checkbox').eq(checkedidx2).click();
                    }
                    unit2 = obj.data;
                    checkedidx2 = obj.data.LAY_TABLE_INDEX+1;
                } else {
                    checkedidx2 = '';
                }

                // jusdge2 = obj.checked;
                // if(jusdge2){      //删除中判断是否有勾选框
                //     group2.push(obj.data)
                // }else{
                //     group2.forEach(function(value,index){
                //         if(cmp(group2[index],obj.data)==true){
                //             group2.splice(index,1)    //删除相同的对象
                //         };
                //     })
                // };
                
            });
        }
		    // GB2盤頭批次--新增
			$("#add2").click(function(){
				console.log(123)
                layer.open({
                    area: ['400px', '280px']
                    ,title:'新增記錄'
                    ,type:1
                    ,content: $('#addT_Add')
                    ,btn: ['提交', '取消']
                    ,cancel: function(){ 
                        $('#addT_Add').css('display','none')
                    }
                    ,yes: function(index, layero){
                        data2.push({
                            BATCH_NO:$("#recode2").val()
                        });
                        //第二个表格--新增一条数据
                        table.render({
                            elem: '#demo2',
                            height: 315,
                            // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:data2,
                            cols: [[ //表头
                                {checkbox: true},
                                {field: 'BATCH_NO', title: 'GB2盤頭批次', width:120},
                                {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                            ]],
                            done: function (res,curr,count) {
                                $('.tab2 .layui-table-cell')[0].style.zIndex = '-2';
                            }
                        });
                        $("#recode2").val("")  //清空-GB2盤頭批次-input框
                        layer.close(index)  //取消加载中
                        $('#addT_Add').css('display','none')
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addT_Add').css('display','none')
                    }
                });
			});
			// GB2盤頭批次--删除
			$("#delete2").click(function(){
                if(group2 === undefined||group2.length == 0){
                    layer.alert('請選擇壹行', {
                        title: "提示"
                    });
                }else{
                    layer.open({
                        area: ['400px', '280px']
                        ,title:'删除'
                        ,type:1
                        ,content: $('#addT_Delete')
                        ,btn: ['删除', '取消']
                        ,cancel: function(){ 
                            $('#addT_Delete').css('display','none')
                        }
                        ,yes: function(index, layero){
                            table.render({
                                elem: '#demo2',
                                height: 315,
                                // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                data:data2,
                                cols: [[ //表头
                                    {checkbox: true},
                                    {field: 'BATCH_NO', title: 'GB2盤頭批次', width:120},
                                    {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                ]],
                                done: function (res,curr,count) {
                                    $('.tab2 .layui-table-cell')[0].style.zIndex = '-2';
                                }
                            });
                            
                            group2 = [];
                            layer.close(index);
                            $('#addT_Delete').css('display','none')
                        }
                        ,btn2: function(index, layero){
                            layer.closeAll();
                            $('#addT_Delete').css('display','none')
                        }
                    });
                }
			});
			// GB2盤頭批次--搜索
			$("#search2").click(function(){
				// console.log(123)
                layer.open({
                    area: ['450px', '280px']
                    ,title:'搜尋'
                    ,type:1
                    ,content: $('#addT_Search')
                    ,btn: ['搜尋', '重設']
                    ,cancel: function(){ 
                        $('#addT_Search').css('display','none')
                    }
                    ,yes: function(index, layero){
                        $.ajax({
                            url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:{
                                OrderNo: receive1, 
                                OrderItem: receive5,
                                MaterialNo:receive9,
                                queryName:document.getElementById("queryName2").value,
                                queryCondition:document.getElementById("ueryCondition2").value,
                                queryValue:document.getElementById("queryValue2").value
                            },
                            success:function(res){
                                console.log(res)
                                table.render({
                                    elem: '#demo2',
                                    height: 315,
                                    // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                    data:res.data,
                                    cols: [[ //表头
                                        {checkbox: true},
                                        {field: 'BATCH_NO', title: 'GB2盤頭批次', width:120},
                                        {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                    ]],
                                    done: function (res,curr,count) {
                                        $('.tab2 .layui-table-cell')[0].style.zIndex = '-2';
                                    }
                                });
                                $("#queryValue2").val("");
                                layer.closeAll();
                                $('#addT_Search').css('display','none');
                            }
                        })
                    }
                    ,btn2: function(index, layero){
                        
                    }
                });
			});



        function setTable3(){
		    //第三个表格
		    table.render({
    		    elem: '#demo3',
                height: 315,
                // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                data:data3,
                cols: [[ //表头
                    {checkbox: true},
                    {field: 'BATCH_NO', title: 'GB3盤頭批次', width:120},
                    {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                ]],
                done: function (res,curr,count) {
                    $('.tab3 .layui-table-cell')[0].style.zIndex = '-2';
                }
    		});

            //表格3-监听复选框选择--获取行数据
            table.on('checkbox(test3)', function(obj){
                // console.log(obj.checked); //当前是否选中状态
                // console.log(obj.data); //选中行的相关数据
                // console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
                unit3 = '';

                //取消其餘的點亮
                if (obj.checked) {
                    if (checkedidx3) {
                        $('.tab3').find('tr .layui-form-checkbox').eq(checkedidx3).click()
                    }
                    unit3 = obj.data;
                    checkedidx3 = obj.data.LAY_TABLE_INDEX+1;
                } else {
                    checkedidx3 = '';
                }
                // jusdge3 = obj.checked;
                // if(jusdge3){      //删除中判断是否有勾选框
                //     group3.push(obj.data)
                // }else{
                //     group3.forEach(function(value,index){
                //         if(cmp(group3[index],obj.data)==true){  
                //             group3.splice(index,1)    //删除相同的对象
                //         };
                //     })
                // };
                
            });
        }
		    // GB3盤頭批次--新增
			$("#add3").click(function(){
				console.log(123)
                layer.open({
                    area: ['400px', '280px']
                    ,title:'新增記錄'
                    ,type:1
                    ,content: $('#addS_Add')
                    ,btn: ['提交', '取消']
                    ,cancel: function(){ 
                        $('#addS_Add').css('display','none')
                    }
                    ,yes: function(index, layero){
                        data3.push({
                            BATCH_NO:$("#recode3").val()
                        });
                        //第二个表格--新增一条数据
                        table.render({
                            elem: '#demo3',
                            height: 315,
                            // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:data3,
                            cols: [[ //表头
                                {checkbox: true},
                                {field: 'BATCH_NO', title: 'GB3盤頭批次', width:120},
                                {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                            ]],
                            done: function (res,curr,count) {
                                $('.tab3 .layui-table-cell')[0].style.zIndex = '-2';
                            }
                        });
                        $("#recode3").val("")  //清空-GB2盤頭批次-input框
                        layer.close(index)  //取消加载中
                        $('#addS_Add').css('display','none')
                        console.log(data3)
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addS_Add').css('display','none')
                    }
                });
			});
			// GB3盤頭批次--删除
			$("#delete3").click(function(){
                if(group3 === undefined||group3.length == 0){
                    layer.alert('請選擇壹行', {
                        title: "提示"
                    });
                }else{
                    layer.open({
                        area: ['400px', '280px']
                        ,title:'删除'
                        ,type:1
                        ,content: $('#addS_Delete')
                        ,btn: ['删除', '取消']
                        ,cancel: function(){ 
                            $('#addS_Delete').css('display','none')
                        }
                        ,yes: function(index, layero){
                            table.render({
                                elem: '#demo3',
                                height: 315,
                                // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                data:data3,
                                cols: [[ //表头
                                    {checkbox: true},
                                    {field: 'BATCH_NO', title: 'GB3盤頭批次', width:120},
                                    {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                ]],
                                done: function (res,curr,count) {
                                    $('.tab3 .layui-table-cell')[0].style.zIndex = '-2';
                                }
                            });
                            
                            group3 = [];
                            layer.close(index);
                            $('#addS_Delete').css('display','none')
                        }
                        ,btn2: function(index, layero){
                            layer.closeAll();
                            $('#addS_Delete').css('display','none')
                        }
                    });
                }
			});
			// GB3盤頭批次--搜索
			$("#search3").click(function(){
				// console.log(123)
                layer.open({
                    area: ['450px', '280px']
                    ,title:'删除'
                    ,type:1
                    ,content: $('#addS_Search')
                    ,btn: ['删除', '取消']
                    ,cancel: function(){ 
                        $('#addS_Search').css('display','none')
                    }
                    ,yes: function(index, layero){
                        $.ajax({
                            url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:{
                                OrderNo: receive1, 
                                OrderItem: receive6,
                                MaterialNo:receive10,
                                queryName:document.getElementById("queryName3").value,
                                queryCondition:document.getElementById("ueryCondition3").value,
                                queryValue:document.getElementById("queryValue3").value
                            },
                            success:function(res){
                                console.log(res)
                                table.render({
                                    elem: '#demo3',
                                    height: 315,
                                    // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                    data:res.data,
                                    cols: [[ //表头
                                        {checkbox: true},
                                        {field: 'BATCH_NO', title: 'GB3盤頭批次', width:120},
                                        {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                    ]],
                                    done: function (res,curr,count) {
                                        $('.tab3 .layui-table-cell')[0].style.zIndex = '-2';
                                    }
                                });
                                $("#queryValue3").val("");
                                layer.closeAll();
                                $('#addS_Search').css('display','none');
                            }
                        })
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addS_Search').css('display','none')
                    }
                });
			});
            
            

        function setTable4(){
		    //第四个表格
		    table.render({
    		    elem: '#demo4',
    		    height: 315,
    		    // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
    		    data: data4, //开启分页
    		    cols: [[ //表头
    		        {checkbox: true},
    		        {field: 'BATCH_NO', title: 'GB4盤頭批次', width:120},
    		        {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
    		    ]],
                done: function (res,curr,count) {
                    $('.tab4 .layui-table-cell')[0].style.zIndex = '-2';
                }
		    });

            //表格4-监听复选框选择--获取行数据
            table.on('checkbox(test4)', function(obj){
                // console.log(obj.checked); //当前是否选中状态
                // console.log(obj.data); //选中行的相关数据
                // console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
                unit4 = '';

                //取消其餘的點亮
                if (obj.checked) {
                    if (checkedidx4) {
                        $('.tab2').find('tr .layui-form-checkbox').eq(checkedidx4).click()
                    }
                    unit4 = obj.data;
                    checkedidx4 = obj.data.LAY_TABLE_INDEX+1;
                } else {
                    checkedidx4 = '';
                }

                // jusdge4 = obj.checked;
                // if(jusdge4){      //删除中判断是否有勾选框
                //     group4.push(obj.data)
                // }else{
                //     group4.forEach(function(value,index){
                //         if(cmp(group4[index],obj.data)==true){
                //             group4.splice(index,1)    //删除相同的对象
                //         };
                //     })
                // };

            });
        }
		    // GB4盤頭批次--新增
			$("#add4").click(function(){
				console.log(123)
                layer.open({
                    area: ['400px', '280px']
                    ,title:'新增記錄'
                    ,type:1
                    ,content: $('#addF_Add')
                    ,btn: ['提交', '取消']
                    ,cancel: function(){ 
                        $('#addF_Add').css('display','none')
                    }
                    ,yes: function(index, layero){
                        data4.push({
                            BATCH_NO:$("#recode2").val()
                        });
                        //第二个表格--新增一条数据
                        table.render({
                            elem: '#demo4',
                            height: 315,
                            // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:data4,
                            cols: [[ //表头
                                {checkbox: true},
                                {field: 'BATCH_NO', title: 'GB2盤頭批次', width:120},
                                {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                            ]],
                            done: function (res,curr,count) {
                                $('.tab4 .layui-table-cell')[0].style.zIndex = '-2';
                            }
                        });
                        $("#recode4").val("")  //清空-GB2盤頭批次-input框
                        layer.close(index)  //取消加载中
                        $('#addF_Add').css('display','none')
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addF_Add').css('display','none')
                    }
                });
			});
			// GB4盤頭批次--删除
			$("#delete4").click(function(){
				if(group4 === undefined||group4.length == 0){
                    layer.alert('請選擇壹行', {
                        title: "提示"
                    });
                }else{
                    layer.open({
                        area: ['400px', '280px']
                        ,title:'删除'
                        ,type:1
                        ,content: $('#addF_Delete')
                        ,btn: ['删除', '取消']
                        ,cancel: function(){ 
                            $('#addF_Delete').css('display','none')
                        }
                        ,yes: function(index, layero){
                            table.render({
                                elem: '#demo4',
                                height: 315,
                                // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                data:data4,
                                cols: [[ //表头
                                    {checkbox: true},
                                    {field: 'BATCH_NO', title: 'GB2盤頭批次', width:120},
                                    {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                ]],
                                done: function (res,curr,count) {
                                    $('.tab4 .layui-table-cell')[0].style.zIndex = '-2';
                                }
                            });
                            
                            group4 = [];
                            layer.close(index);
                            $('#addF_Delete').css('display','none')
                        }
                        ,btn2: function(index, layero){
                            layer.closeAll();
                            $('#addF_Delete').css('display','none')
                        }
                    });
                }
			});
			// GB4盤頭批次--搜索
			$("#search4").click(function(){
				// console.log(123)
                layer.open({
                    area: ['450px', '280px']
                    ,title:'删除'
                    ,type:1
                    ,content: $('#addF_Search')
                    ,btn: ['删除', '取消']
                    ,cancel: function(){ 
                        $('#addF_Search').css('display','none')
                    }
                    ,yes: function(index, layero){
                        $.ajax({
                            url:getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                            data:{
                                OrderNo: receive1, 
                                OrderItem: receive7,
                                MaterialNo:receive11,
                                queryName:document.getElementById("queryName4").value,
                                queryCondition:document.getElementById("ueryCondition4").value,
                                queryValue:document.getElementById("queryValue4").value
                            },
                            success:function(res){
                                console.log(res)
                                table.render({
                                    elem: '#demo4',
                                    height: 315,
                                    // url: getAjaxURL('/warpMachineJobSheet/getBeamBatchDetails'), //数据接口
                                    data:res.data,
                                    cols: [[ //表头
                                        {checkbox: true},
                                        {field: 'BATCH_NO', title: 'GB4盤頭批次', width:120},
                                        {field: 'BATCH_QNTY', title: '批次重量(KG)', width:120},
                                    ]],
                                    done: function (res,curr,count) {
                                        $('.tab4 .layui-table-cell')[0].style.zIndex = '-2';
                                    }
                                });
                                $("#queryValue4").val("");
                                layer.closeAll();
                                $('#addF_Search').css('display','none');
                            }
                        })
                    }
                    ,btn2: function(index, layero){
                        layer.closeAll();
                        $('#addF_Search').css('display','none')
                    }
                });
			});
            

        $('#print').click(function(){
            // console.log(unit1)
            // console.log(unit2)
            // console.log(unit3)
            // console.log(unit4)
            
            var arr = [];

            if (unit1) {
                arr.push({
                    BATCH_NO:unit1.BATCH_NO,
                    MAT:receive8,
                    ORDER_ITEM:receive4      
                })
            }

            if (unit2) {
                arr.push({
                    BATCH_NO:unit2.BATCH_NO,
                    MAT:receive9,
                    ORDER_ITEM:receive5      
                })
            }

            if (unit3) {
                arr.push({
                    BATCH_NO:unit3.BATCH_NO,
                    MAT:receive10,
                    ORDER_ITEM:receive6      
                })
            }

            if (unit4) {
                arr.push({
                    BATCH_NO:unit4.BATCH_NO,
                    MAT:receive11,
                    ORDER_ITEM:receive7      
                })
            }

            if (arr.length == 0) {
                layer.alert('請選擇壹行', {title: "提示"});
                return 
            }

            var params = {
                ORDERNO: receive1, //單號
                SERIALNO:receive2,  //機頭紙
                WORKCENTER:receive3,  //工作中心
                FABRIC:printParams.FABRIC,  //布號
                FINISHEDQNTY:printParams.FINISHEDQNTY,
                REMAININGQNTY:printParams.REMAININGQNTY,
                PANNEDQNTY:printParams.PANNEDQNTY,
                LIST:JSON.stringify(arr),
                // LIST:arr,
                PRINTBY:'a_test'
                // PRINTBY:sessionStorage["loginName"]
            }

            $.ajax({
                url:getAjaxURL('/warpMachineJobSheet/printBeamBatchDetails'), //数据接口
                data:params,
                success:function(data){
                    console.log(data);
                    
                    if (data.status == 200) {
                        file=data.data;
                        for(var par=0;par<file.length;par++){

                            // window.open(getAjaxURL(file[par]));
                            window.open(file[par]);
                        }
                    } else {
                        layer.alert(res.message, {title: "提示"});
                    }
                }
            })

        })











		});
	})
</script>
</html>

<!-- 公共方法 -->
<script>
    cmp = function( x, y ) { 
        if ( x === y ) { 
         return true; 
            if ( ! ( x instanceof Object ) || ! ( y instanceof Object ) ) { 
             return false; 
            } 
            if ( x.constructor !== y.constructor ) { 
             return false; 
            } 
        for ( var p in x ) { 
         if ( x.hasOwnProperty( p ) ) { 
             if ( ! y.hasOwnProperty( p ) ) { 
              return false; 
             } 
             if ( x[ p ] === y[ p ] ) { 
              continue; 
             } 
             if ( typeof( x[ p ] ) !== "object" ) { 
              return false; 
             } 
             if ( ! Object.equals( x[ p ], y[ p ] ) ) { 
              return false; 
             } 
         } 
        } 
            for ( p in y ) { 
                 if ( y.hasOwnProperty( p ) && ! x.hasOwnProperty( p ) ) { 
                 return false; 
                 } 
            } 
        return true; 
        }
    }
</script>
<style>
	.top{
		color: rgb(32,76,125);
		padding: 5px 15px;
		border-bottom: 2px rgb(30,140,195) solid;
	}
	.tops{
		padding: 5px 15px;
	}
	.topss{
		padding: 5px 4px;
	}
	.shou{
		cursor: pointer;
	}
	.pad{
		padding: 20px;
	}
	.dis{
		display: none;
	}
</style>