<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Layui</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<script type="text/javascript" src="plugins/servies.js" ></script>
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<!--<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
		<link rel="stylesheet" href="build/css/shiteTable.css" />
		<link rel="stylesheet" href="build/css/chosen.css">
	</head>

	<body>
	<div class="m" id="m">
	    <div class="top">
			<span>$t('經編整經交班表維護報表')</span>
		</div>
		<div class="tops">
		   <!-- <form class="layui-form" action="">-->
                <div class="layui-form-item">
                	
					<div class="layui-form-item">
   						<div id="cityContainer" class="selectContainer">
					       <label class="layui-form-label">$t('工作中心')<span style="color:red">*</span></label>
					    
					       	<select name="dept" data-placeholder="" style="width:210px;" id="cityName" class="dept_select"> 
							    <!--<option value="-1"></option>
							    <option value="部门1"></option>
							    <option value="部门2"></option>-->
							 </select>
					     
							<!--<div class="layui-input-inline">					       
					        <input type="text" placeholder="请输入" list="cityList" class="selectInput" name="cityName" id="cityName" value="" style="text-transform:uppercase;" onfocus="fuzzySearch.call(this)"/>
					        <div class="picture_click dropDowns" style=""></div>
					        <div id="cityList" class="selectList" name="makeupCoSe" >
					            <!--<div id="001">1</div>
					            <div id="002">2</div>
					            <div id="003">3</div>
					            <div id="004">4</div>
					            <div id="005">5</div>
					            <div id="006">6</div>
					            <div id="007">7</div>
					           
					        </div>-->
					    </div>
					    </div>
					</div>

					<div class="layui-inline">
				      <label class="layui-form-label">$t('排程日期')<span style="color:red">*</span></label>
				      <div class="layui-input-inline">
				        <input type="text" class="layui-input" id="test1" placeholder="yyyy-MM-dd" value="">
				      </div>
				    </div>
				</div>
			<!--</form>-->
		</div>
		<div>
			<button class="layui-btn layui-btn-small" id="bt">$t('搜索')</button>
        	<button class="layui-btn layui-btn-small" id="btnModify">$t('編輯')</button>
        	<button class="layui-btn layui-btn-small" id="btnSave">保存</button>
        	<button class="layui-btn layui-btn-small" id="btnExport">$t('導出')</button>
        	<button class="layui-btn layui-btn-small" id="btnPreview">$t('預覽')</button>
        	<button class="layui-btn layui-btn-small" id="btnPrint">$t('打印')</button>
        	<button class="layui-btn layui-btn-small" id="btnOutput">$t('查看整經產量報表')</button>
		</div>
		<div class="m">
            <table class="layui-table" lay-data="{height:515,page:false, id:'test'}" lay-filter="test" id="tab">
				<thead>
				    <tr>
				      <th lay-data="{radio: false, LAY_RadioCHECKED: false,width:45}" ></th>
				      <th lay-data="{field: 'workcenter', title: '工作<br>中心',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'orderStatus', title: '工單<br>狀態',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'serialNo', title: '生產<br>序號',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'beamNumber', title: '盤頭<br>料號',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'creelNo', title: 'Creel<br>No',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'productionorder', title: '盤頭工<br>單號',unresize: true,width:70}"></th>
				      <th lay-data="{field: 'beamBatch', title: '盤頭<br>批次',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'yarnMaterial', title: '紗線<br>料號',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'numberofBeam', title: '盤頭<br>個數',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'numberofYarn', title: '紗線<br>頭數',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'length', title: '長度<br>(m)',unresize: true,width:50}"></th>
				      <th lay-data="{field: 'yarnBatch', title: '紗線<br>批次',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'consumeTime', title: '耗時<br>(H)',unresize: true,width:50}"></th>
				      <th lay-data="{field: 'scheduleStartTime', title: '預計開始<br>生產時間',unresize: true,width:120}"></th>
				      <th lay-data="{field: 'speed', title: '機<br>速',unresize: true,width:40}"></th>
				      <th lay-data="{field: 'scheduleFinishTime', title: '預計產<br>出時間',unresize: true,width:80}"></th>
				      <th lay-data="{field: 'planQuantity', title: '預計<br>產量',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'planDenier', title: '預計<br>旦數',unresize: true,width:60}"></th>
				      <th lay-data="{field: 'yarnReservation', title: '紗線預<br>留號',unresize: true,width:70}"></th>
				      <th lay-data="{field: 'date', title: '排程<br>日期',unresize: true,width:60}"></th>
				      
				      
				    </tr>
				</thead>
            </table>
		</div>
		
		<!--编辑-->
        <div id="et">
        	<span>$t('工作中心')<input type="text" value="1" id="bv1" disabled="disabled"></span>
        	<span class="sp">$t('工單狀態')<input type="text" value="" id="bv2" disabled="disabled"></span>
        	<span>$t('生產序號')<input type="text" value="" id="bv3"></span>
        	<span class="sp">$t('盤頭料號')<input type="text" value="" id="bv4" disabled="disabled"></span><br />
        	<span>Creel No<input type="text" value="" id="bv5" disabled="disabled"></span>
        	<span class="sp">$t('盤頭工單號')<input type="text" value="" id="bv6" disabled="disabled"></span>
        	<span>$t('盤頭批次')<input type="text" value="" id="bv7" disabled="disabled"></span>
        	<span class="sp">$t('紗線料號')<input type="text" value="" id="bv8" disabled="disabled"></span><br />
        	<span>$t('盤頭個數')<input type="text" value="" id="bv9" disabled="disabled"></span>
        	<span class="sp">$t('紗線頭數')<input type="text" value="" id="bv10" disabled="disabled"></span>
        	<span>$t('長度')(m)<input type="text" value="" id="bv11"></span>
        	<span class="sp">$t('紗線批次')<input type="text" value="" id="bv12" disabled="disabled"></span><br />
        	<span>$t('耗時')(H)<input type="text" value="" id="bv13" disabled="disabled"></span>
        	<span class="sp">$t('預計開始生產時間')<input type="text" value="" id="bv14"></span>
        	<span> $t('機速') <input type="text" value="" id="bv15"></span>
        	<span class="sp">$t('預計產出時間')<input type="text" value="" id="bv16" disabled="disabled"></span><br />
        	<span>$t('預計產量')<input type="text" value="" id="bv17" disabled="disabled"></span>
        	<span class="sp">$t('預計旦數')<input type="text" value="" id="bv18" disabled="disabled"></span>
        	<span>$t('紗線預留號')<input type="text" value="" id="bv19" disabled="disabled"></span>
        	<span class="sp">$t('排程日期')<input type="text" value="" id="bv20" placeholder="yyyy-MM-dd" disabled="disabled"></span>
        </div>
        
        <!--查看整經產量報表-->
       
        	<table class="layui-table" lay-filter="test" id="tab1" style="display: none;" >
        				
				<thead>
				    <tr>
				    	<th>Date</th><th>JE01</th><th>JE02</th><th>JE03</th><th>JE04</th><th>JE05</th><th>JF01</th><th>JF02</th><th>JF03</th><th>JF04</th><th>JF05</th><th>JF06</th><th>$t('拉架')</th><th>$t('尼龍')</th><th>$t('總產量')</th>
				    </tr> 
				</thead>
			    <tbody id="tbody">
				    <tr></tr>
				   
			    </tbody>
						
        	</table>
        	
	</div>
		<script type="text/javascript" src="plugins/layui/layuis.all.js"></script>
		<!--<script type="text/javascript" src="plugins/layui/layui.js"></script>-->
		<script type="text/javascript" src="plugins/layui/lay/modules/tables.js" ></script>
		<script src="build/js/jquery.js"></script>
		<!-- <script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.11.3.min.js"></script> -->
		<script type="text/javascript" src="build/js/jquery.js" ></script>
        <script src="build/js/di18n.js"></script>
        <script src="build/js/lang.js"></script>
		<script>
			var tableData;
			var ta;
			var All=0;
			layui.use(['laydate','table'], function(){
  				var laydate = layui.laydate;
  				var table = layui.table;
  				//排程日期
				laydate.render({
			    	elem: '#test1'
				});
				
				//选中复选框
			 	table.on('radio(test)', function(obj){
	              	// console.log(obj.checked); //当前是否选中状态
	              	ta= obj.checked;
	              	// console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
	          		console.log(ta);
	              	data = obj.data;
	              	console.log(data);
	            });

			 	// $(".m").delegate('input','onchange',function(e){
                    // console.log(111)
                // })

	        	//编辑点击事件
	        	$('#btnModify').click(function(){
	        		$('.edit').attr("disabled",false);
	        		console.log(tableData);
	        		
	        		return
					// if(ta==true){
					// 	$('#bv1').val(data.workcenter);//workcenter
					// 	$('#bv2').val(data.orderStatus);//orderStatus
					// 	$('#bv3').val(data.serialNo);//serialNo
					// 	$('#bv4').val(data.beamNumber);//beamNumber
					// 	$('#bv5').val(data.creelNo);//creelNo
					// 	$('#bv6').val(data.productionorder);//productionorder
					// 	$('#bv7').val(data.beamBatch);//beamBatch
					// 	$('#bv8').val(data.yarnMaterial);//yarnMaterial
					// 	$('#bv9').val(data.numberofBeam);//numberofBeam
					// 	$('#bv10').val(data.numberofYarn);//NumberofYarn
					// 	$('#bv11').val(data.length);//length
					// 	$('#bv12').val(data.yarnBatch);//yarnBatch
					// 	$('#bv13').val(data.consumeTime);//consumeTime
					// 	$('#bv14').val(layui.laytpl.toDateString(data.scheduledStartTime));//schedulestarttime
					// 	$('#bv15').val(data.speed);//speed
					// 	$('#bv16').val(layui.laytpl.toDateString(data.scheduleFinishTime));//scheduleFinishTime
					// 	$('#bv17').val(data.planQuantity);//planQuantity
					// 	$('#bv18').val(data.planDenier);//planDenier
					// 	$('#bv19').val(data.yarnReservation);//yarnReservation
					// 	$('#bv20').val(data.date);//date
					// 	layer.open({
					// 	    btn: [strchangeL('提交'), strchangeL('取消')],
					//         type: 1,
					//         title:strchangeL('编辑'),
					//         area: ['750px', '360px'],
					//         content:$('#et'),
					//         yes: function(){
					        	
					// 			$.ajax({
					// 				url:getAjaxURL("/warpShiftWorkMaintainReport/saveShiftWorkReport"),
					// 				type:"GET",
					// 				data:{
					// 					//工作中心
					// 					workcenter:$('#bv1').val(),
					// 					//工單狀態
					// 					orderStatus:$('#bv2').val(),
					// 					//生產序號
					// 					serialNo:$('#bv3').val(),
					// 					//盤頭料號
					// 					beamNumber:$('#bv4').val(),
					// 					//Creel No
					// 					creelNo:$('#bv5').val(),
					// 					//盤頭工單號
					// 					productionorder:$('#bv6').val(),
					// 					//盤頭批次
					// 					beamBatch:$('#bv7').val(),
					// 					//紗線料號
					// 					yarnMaterial:$('#bv8').val(),
					// 					//盤頭個數
					// 					numberofBeam:$('#bv9').val(),
					// 					//紗線頭數
					// 					NumberofYarn:$('#bv10').val(),
					// 					//長度(m)
					// 					length:$('#bv11').val(),
					// 					//紗線批次
					// 					yarnBatch:$('#bv12').val(),
					// 					//耗時(H)
					// 					consumeTime:$('#bv13').val(),
					// 					//預計開始生產時間
					// 					schedulestarttime:$('#bv14').val(),
					// 					//機速
					// 					speed:$('#bv15').val(),
					// 					//預計產出時間
					// 					scheduleFinishTime:$('#bv16').val(),
					// 					//預計產量
					// 					planQuantity:$('#bv17').val(),
					// 					//預計旦數
					// 					planDenier:$('#bv18').val(),
					// 					//紗線預留號
					// 					yarnReservation:$('#bv19').val(),
					// 					//排程日期
					// 					date:$('#bv20').val(),
					// 				},
									
					// 				success:function(data){
					// 					$("#et").css('display','none')
					// 					layer.close(layer.index)
										
					// 					if (data.status == 200) {
					// 						table.reload('idTest11', {										  
					// 							url:getAjaxURL('/warpShiftWorkMaintainReport/listShiftWorkMaintainReport')
					// 						});
											
					// 						ta = '';
					// 					} else {
					// 						layer.alert(data.message,{title:'提示'})
					// 					}

					// 				}
					//         	})
								
					//     	},
					//         btn2:function(){
					//         	$("#et").css('display','none')
					// 			layer.close(layer.index)
					//         }
					//         ,cancel: function(){ 
					// 		    //右上角关闭回调
					// 		    $("#et").css('display','none')
					// 		    //return false 开启该代码可禁止点击该按钮关闭
					// 	  	}
					// 	});
					// }else{
					// 	//alert("请选中再编辑");
					// 	layer.alert(strchangeL('请选中再编辑'),{title: strchangeL("提示")});
					// };
				
	        	});
	        	
	        	function inputChange(){
	        		console.log(123)
	        	}

				//保存
				$('#btnSave').click(function(){
	        		var postData = [];
					var isPush = false;
					for(var i=0;i<tableData.length;i++){
						isPush = false;
	        			// console.log(tableData[i])
						// console.log('serialNo--------------')
						// console.log(tableData[i].serialNo);
						// console.log($('.serialNo')[i].value);
	        			if (tableData[i].serialNo != $('.serialNo')[i].value) {
	        				tableData[i].serialNo = $('.serialNo')[i].value;
	        				isPush = true;
	        			}
	        			// console.log('yarnLength--------------')
						// console.log(tableData[i].yarnLength);
						// console.log($('.yarnLength')[i].value);
	        			if (Number(tableData[i].yarnLength) != Number($('.yarnLength')[i].value)) {
	        				tableData[i].yarnLength = $('.yarnLength')[i].value;
	        				isPush = true;
	        			}
	        			// console.log('scheduleStartTime--------------')
						// console.log(tableData[i].scheduleStartTime);
						// console.log(layui.laytpl.toDateString(tableData[i].scheduleStartTime));
						// console.log($('.scheduleStartTime')[i].value);
						// console.log(Date.parse(new Date($('.scheduleStartTime')[i].value)));
						if (!Date.parse(new Date($('.scheduleStartTime')[i].value))) {
							layer.alert('第'+(Number(i) + 1)+'行请输入正确时间格式',{title:'提示'})
							return
						}
	        			if (tableData[i].scheduleStartTime != Date.parse(new Date($('.scheduleStartTime')[i].value))) {
	        				// tableData[i].scheduleStartTime = $('.scheduleStartTime')[i].value;
	        				// 转时间戳
	        				tableData[i].scheduleStartTime = Date.parse(new Date($('.scheduleStartTime')[i].value));
	        				isPush = true;
	        			}
	        			// console.log('speed--------------')
						// console.log(tableData[i].speed);
						// console.log($('.speed')[i].value);
	        			if (tableData[i].speed != $('.speed')[i].value) {
	        				tableData[i].speed = $('.speed')[i].value;
	        				isPush = true;
	        			}
	        			// tableData[i].serialNo = $('.serialNo')[i].value;
	        			// tableData[i].length = $('.length')[i].value;
	        			// tableData[i].scheduledStartTime = $('.scheduledStartTime')[i].value;
	        			// tableData[i].speed = $('.speed')[i].value;

	        			// console.log(isPush)
	        			if (isPush) {
							postData.push({
								//工作中心
								workcenter:tableData[i].workcenter,
								//工單狀態
								orderStatus:tableData[i].orderStatus,
								//生產序號
								serialNo:tableData[i].serialNo,
								//盤頭料號
								beamNo:tableData[i].beamNo,
								//Creel No
								creelNo:tableData[i].creelNo,
								//盤頭工單號
								prodOrderNo:tableData[i].prodOrderNo,
								//盤頭批次
								beamBatch:tableData[i].beamBatch,
								//紗線料號
								yarnMaterial:tableData[i].yarnMaterial,
								//盤頭個數
								noOfBeam:tableData[i].noOfBeam,
								//紗線頭數
								noOfYarn:tableData[i].noOfYarn,
								//長度(m)
								yarnLength:tableData[i].yarnLength,
								//紗線批次
								yarnBatch:tableData[i].yarnBatch,
								//耗時(H)
								consumeTime:tableData[i].consumeTime,
								//預計開始生產時間
								scheduleStartTime:tableData[i].scheduleStartTime,
								//機速
								speed:tableData[i].speed,
								//預計產出時間
								scheduleFinishTime:tableData[i].scheduleFinishTime,
								//預計產量
								planQnty:tableData[i].planQnty,
								//預計旦數
								planDenier:tableData[i].planDenier,
								//紗線預留號
								yarnReservation:tableData[i].yarnReservation,
								//排程日期
								reportDate:tableData[i].reportDate
							})
	        			}

	        		}

	        		console.log(postData);

	        		$.ajax({
    					url:getAjaxURL("/warpShiftWorkMaintainReport/saveShiftWorkReport"),
    					type:"GET",
    					data:{
    						list:JSON.stringify(postData)
    					},
    					success:function(data){
    						$("#et").css('display','none')
							if (data.status == 200) {
								
								$('.edit').attr("disabled",true);
								layer.alert('修改成功',{title:'提示'});

							} else {
								table.reload('idTest11', {										  
									url:getAjaxURL('/warpShiftWorkMaintainReport/listShiftWorkMaintainReport')
								});
								layer.alert(data.message,{title:'提示'})
							}

    					}
                	})

				})
				

				var colArr = [ //表头
			      	{radio: true, LAY_RadioCHECKED: false,width:20},
			      	{field: 'workcenter', title: '工作<br>中心',unresize: true,width:60,size:'sm'}
                    ,{field: 'orderStatus', title: '工單<br>狀態',unresize: true,width:60,size:'sm'}
                    // ,{field: 'serialNo', title: '生產<br>序號',unresize: true,width:60,size:'sm'}
                    ,{field: 'serialNo', title: '生產<br>序號',unresize: true,width:60,size:'sm',templet: '<div><input class="edit serialNo" type="text" value="{{d.serialNo}}" disabled style="width:100%;"></div>'}
                    ,{field: 'beamNo', title: '盤頭<br>料號',unresize: true,width:60,fontSize:10} 
                    ,{field: 'creelNo', title: 'Creel<br>No',unresize: true,width:60,size:'sm'}
                    ,{field: 'prodOrderNo', title: '盤頭工<br>單號',unresize: true,width:70,size:'sm'}
                    ,{field: 'beamBatch', title: '盤頭<br>批次',unresize: true,width:60,size:'sm'}
                    ,{field: 'yarnMaterial', title: '紗線<br>料號',unresize: true,width:60}
                    ,{field: 'noOfBeam', title: '盤頭<br>個數',unresize: true,width:60}
                    ,{field: 'noOfYarn', title: '紗線<br>頭數',unresize: true,width:60,templet: '<div>{{ layui.laytpl.changeNum(d.noOfYarn) }}</div>'}
                    // ,{field: 'yarnLength', title: '長度<br>(m)',unresize: true,width:50}
                    ,{field: 'yarnLength', title: '長度<br>(m)',unresize: true,width:50,templet: '<div><input class="edit yarnLength" type="text" value="{{ layui.laytpl.changeNum(d.yarnLength)}}" disabled style="width:100%;"></div>'}
                    ,{field: 'yarnBatch', title: '紗線<br>批次',unresize: true,width:60}
                    ,{field: 'consumeTime', title: '耗時<br>(H)',unresize: true,width:50}
                    // ,{field: 'scheduledStartTime', title: '預計開始<br>生產時間',unresize: true,width:120,templet: '<div>{{ layui.laytpl.toDateString(d.scheduledStartTime) }}</div>'}
                    ,{field: 'scheduleStartTime', title: '預計開始<br>生產時間',unresize: true,width:120,templet: '<div><input class="edit scheduleStartTime" type="text" value="{{ layui.laytpl.toDateString(d.scheduleStartTime) }}" disabled style="width:100%;"></div>'}
                    // ,{field: 'speed', title: '機<br>速',unresize: true,width:40}
                    ,{field: 'speed', title: '機<br>速',unresize: true,width:40,templet: '<div><input class="edit speed" type="text" value="{{d.speed}}" disabled style="width:100%;"></div>'}
                    ,{field: 'scheduleFinishTime', title: '預計產<br>出時間',unresize: true,width:80,templet: '<div>{{ layui.laytpl.toDateString(d.scheduleFinishTime) }}</div>'}
                    ,{field: 'planQnty', title: '預計<br>產量',unresize: true,width:60}
                    ,{field: 'planDenier', title: '預計<br>旦數',unresize: true,width:60}
                    ,{field: 'yarnReservation', title: '紗線預<br>留號',unresize: true,width:70}
                    ,{field: 'reportDate', title: '排程<br>日期',unresize: true,width:60}
			    ];
				arrchangeL(colArr);
				
			  	//第一个实例
	
				//搜索
				$('#bt').click(function(){
					All=1;
					console.log($('#cityName').val())
					if($('#cityName').val()==''){
						// layer.load(2);
						table.render({
							elem: '#tab'
							,height: 515
							,loading: true
							,url: getAjaxURL('/warpShiftWorkMaintainReport/listShiftWorkMaintainReportAll') //数据接口
							,page: false //开启分页
							,response: {
								statusName: 'status' //数据状态的字段名称，默认：code
								,statusCode: 200 //成功的状态码，默认：0
								,msgName: 'message' //状态信息的字段名称，默认：msg
								,countName: 'totals' //数据总数的字段名称，默认：count
								,dataName: 'data' //
							}
							,cols: [colArr] //表头
							,id:'idTest11'
							,where: {
								txtDate:$('#test1').val(),
							}
							,done: function (res,curr,count) {
								// laydate.render({
								// 	elem: '.scheduleStartTime'
								// 	,type: 'datetime'
								// });
								console.log('all');
								console.log(res);
								tableData = res.data;
								// layer.closeAll('loading');
								//每次搜索或reload需要清空單選框checked標識
								ta = '';
	                            $('.layui-table-cell')[0].style.visibility = 'hidden';
	                            // $('.edit').change(function(){
	                            // 	console.log(123)
	                            // })	
	                        }
						});
						return;
					};
					
					$.ajax({
						type:"post",
						url:getAjaxURL('/warpShiftWorkMaintainReport/checkWarpWorkCenter'),
						async:false,
						data:{
							ddlWC:$('#cityName').val()
						},
						success:function(data){
							// layer.load(2);
							if(data.data==""){
								layer.closeAll('loading');
								layer.alert(strchangeL("工作中心不存在"),{title: strchangeL("提示")});
								$('tbody').html('');
								return;
							}else{
								table.render({
									elem: '#tab'
									,height: 515
									,loading: true
									,url: getAjaxURL('/warpShiftWorkMaintainReport/listShiftWorkMaintainReport') //数据接口
									,page: false //开启分页
									,response: {
										statusName: 'status' //数据状态的字段名称，默认：code
										,statusCode: 200 //成功的状态码，默认：0
										,msgName: 'message' //状态信息的字段名称，默认：msg
										,countName: 'totals' //数据总数的字段名称，默认：count
										,dataName: 'data' //
									}
									,cols: [colArr] //表头
									,id:'idTest11'
									,limit:10
									,limits:[10,30,50]
									,where: {
										ddlWC:$('#cityName').val(),
										txtDate:$('#test1').val(),
									}
									,done: function (res,curr,count) {
										// laydate.render({
										// 	elem: '.scheduleStartTime'
										// 	,type: 'datetime'
										// });
										console.log(res)
										tableData = res.data;
										// layer.closeAll('loading');
										//每次搜索或reload需要清空單選框checked標識
										ta = '';
			                            $('.layui-table-cell')[0].style.visibility = 'hidden';
			                            // $('.edit').change(function(){
			                            // 	console.log(123)
			                            // })		
			                        }

								});

							}
							
						}
					});
					
				
				})
			
				
				//时间轴的转换
				//时间戳的处理
				layui.laytpl.toDateString = function(d, format){
					
				   	var date = new Date(d || new Date())
				   
					Y = date.getFullYear() + '-';
			        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
			        D = date.getDate() + ' ';
			        h = date.getHours();
			        if(h<10){
			          h='0'+h;	
			        }
			       
			        m = date.getMinutes();
			        if(m<10){
			        	m="0"+m
			        }
			        s = date.getSeconds();
			        if(s<10){
			        	s="0"+s
			        }
			        return Y+M+D+h+":"+m+":"+s;
				};
				
				layui.laytpl.changeNum = function(n){
					return Number(n)
				}

				//导出
				$('#btnExport').click(function(){
					if(All==0)return;
					window.location.href=getAjaxURL('/warpShiftWorkMaintainReport/downloadExcel?txtDate='+$('#test1').val()+"&ddlWC="+$('#cityName').val());
				});
				
				//预览	
				var btnPreview=document.getElementById('btnPreview');
				$('#btnPreview').click(function(){
					if(All==0)return;
					$.ajax({
						type:"GET",
						url:getAjaxURL("/warpShiftWorkMaintainReport/downloadPDF"),
						async:true,
						data:{
							ddlWC:$('#cityName').val(),
							txtDate:$('#test1').val()
						},
						success:function(data){
							console.log(data)
							console.log(data.message)
							if(data.status===200){
								
							// window.open(getAjaxURL("/"+data.message))
							window.open(data.message);
							}else{
								//alert("导出失败")
								layer.alert(data.message,{title: strchangeL("提示")});
							}
							
						}
					});
				
				});
				
				
  			});
			//打印
			$('#btnPrint').click(function(){
				if(All==0)return;
				$.ajax({
					type:"GET",
					url:getAjaxURL("/warpShiftWorkMaintainReport/downloadPDF"),
					async:true,
					
					data:{
						ddlWC:$('#cityName').val(),
						txtDate:$('#test1').val(),
					},
					success:function(data){
						console.log(data)
						console.log(data.message)
						if(data.status===200){
						// window.open(getAjaxURL(data.message));
						window.open(data.message);
						}else{
							//alert("导出失败")
							layer.alert(data.message,{title: strchangeL("提示")});
						}
						
					}
				});
		 	});



			
			//工作中心数据(下拉)	
			function dload(){
				$.ajax({
					type:"GET",
					url:getAjaxURL("/warpShiftWorkMaintainReport/selWarpWorkCenter"),
					success:function(data){
						
						// console.log(data)
						// console.log(data.data[1].workcenter)
						// var tab = '';
						var tab = '<option value="">Select All</option>';
						for(var i in data.data){
							tab+="<option>"+data.data[i].workcenter+"</option>";
							// arr.push(data.data[i].workcenter);
						}
	                $("#cityName").html(tab);
	                
					$('.dept_select').chosen();	
					}
				});
			}
			
			$(function(){
				dload();
	   		 	// $('#cityName').chosen();
			});
			
	//默认参考日期为前一天 创建天数为当天不能修改
	
            var preDate = String(new Date().getFullYear())+'-'+String(new Date().getMonth() + 1)+'-'+String(new Date().getDate());
            $('#test1').val(preDate); 
			
			/* 当前时间处理*/
			function dateAdd(startDate) {
		        startDate = new Date(startDate);
		        startDate = +startDate + 1000*60*60*24;
		        startDate = new Date(startDate);
		        var Monht = (startDate.getMonth()+1)>9 ? (startDate.getMonth()+1):("0"+(startDate.getMonth()+1));
		        var Dates = startDate.getDate()>9 ? startDate.getDate():("0"+startDate.getDate());
		        var nextStartDate = startDate.getFullYear()+"-"+Monht+"-"+Dates;
		        console.log(nextStartDate)
		        return nextStartDate;
		    }
		
           //	dload();
           
        	//查看整經產量報表	
			(function(){
				$('#btnOutput').click(function(){
					if(!$('#test1').val()) {
						//alert('请选择日期')
						layer.alert(strchangeL('请选择日期'),{title: strchangeL("提示")});
						return false
					};
					layer.open({
			     		type:1,
					    content: $('#tab1'),
					    area: ['1200px', '410px'],
					    success: function(layero, index){
						    $.ajax({
						    	type:"get",
						    	url:getAjaxURL("/warpShiftWorkMaintainReport/checkOutputReport"),
						    	async:true,
						    	data:{
						    		startDate:$('#test1').val()
						    	},
						    	success:function(data){
						    		
//						    		var Atbody=document.getElementById('tbody');
						    		var newdatas = data.data
						    		var startdata = $('#test1').val()

					    			var str=''
					    			var datas = []
							    	var k = 0;
							    	for (var i=0;i<8;i++){
							    		
							    		if (newdatas.length!=undefined && newdatas[k]!=undefined &&  startdata==newdatas[k]['finishdate']){
							    			console.log(datas,"----111111")
							    			datas.push(newdatas[k])
							    			k+=1
							    		}
							    		else{
							    			datas.push({finishdate:startdata,e01:0,e02:0,e03:0,e04:0,e05:0,f01:0,f02:0,f03:0,f04:0,f05:0,f06:0,lycra:0,nylon:0,qty:0} )
							    		}
										startdata = dateAdd(startdata)
							    	}
								    	console.log(datas,1111)
								    	
					    			for(var i=0;i<datas.length;i++){
					    				str+='<tr>'
					    				str+="<td>"+datas[i].finishdate+"</td>"
					    				str+="<td>"+datas[i].e01+"</td>"
					    				str+="<td>"+datas[i].e02+"</td>"
					    				str+="<td>"+datas[i].e03+"</td>"
					    				str+="<td>"+datas[i].e04+"</td>"
					    				str+="<td>"+datas[i].e05+"</td>"
					    				str+="<td>"+datas[i].f01+"</td>"
					    				str+="<td>"+datas[i].f02+"</td>"
					    				str+="<td>"+datas[i].f03+"</td>"
					    				str+="<td>"+datas[i].f04+"</td>"
					    				str+="<td>"+datas[i].f05+"</td>"
					    				str+="<td>"+datas[i].f06+"</td>"
					    				str+="<td>"+datas[i].lycra+"</td>"
					    				str+="<td>"+datas[i].nylon+"</td>"
					    				str+="<td>"+datas[i].qty+"</td>"
					    				str+="</tr>"
					    			}
					    			$('#tbody').html(str);
						    	}
						    });
					  	},
					  	cancel: function(){ 
					    //右上角关闭回调
					    $("#tab1").css('display','none')
					    //return false 开启该代码可禁止点击该按钮关闭
					  }
					});
				})
				
			})()
				
					
		</script>
<script src="build/js/chosen.jquery.js"></script>
	</body>

</html>
