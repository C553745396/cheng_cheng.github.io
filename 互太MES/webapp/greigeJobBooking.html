<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>Layui</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">
		<link rel="stylesheet" href="plugins/layui/css/layui.css" media="all" />
		<!--<link rel="stylesheet" type="text/css" href="http://www.jq22.com/jquery/font-awesome.4.6.0.css">-->
		<script type="text/javascript" src="plugins/servies.js" ></script>
		<link rel="stylesheet" href="build/css/greigeJobBooking.css" />
	</head>

	<body>
		<div class="m">
			<div class="top">
				<span>$t('经编胚布报工')</span>
			</div>
            <!-- 开始input框 -->
            <!-- 第一行 -->
            <div class="layui-form-item">
			    <label class="layui-form-label"  class="required">
			    	<span style="color:white;"><span class="v_d">$t('工單')</span></span>$t('布票號碼')<span style="color:red">*</span>
			    </label>
			    <div class="layui-input-inline">
			      <input id="rollNo" type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input" value="5000001734">
			    </div>
			    <form class="layui-form" action="">
			        <label class="layui-form-label">
			        	<span class="v_d">$t('工單')</span>GB1 $t('盘头批次')<span class="v_d">*</span>
			        </label>
					<div class="layui-input-inline" id="div_c">
						<select name="interest" id="selGB1BatchNo">
							<!--<option value="">请选择</option>
							<option value="JE01" >JE01</option>
							<option value="JE02" >JE02</option>
							<option value="JE03" >JE03</option>
							<option value="JE04" >JE04</option>
							<option value="0000000194" >0000000194</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
							
					</div>
					<label class="layui-form-label"><span class="v_d">工1&nbsp;</span>GB1 $t('盘头批次2')<span class="v_d">*</span></label>
					<div class="layui-input-inline">
					    <select id="selGB1BatchNo2">
							<!--<option value="">请选择</option>
							<option value="JE01" >JE01</option>
							<option value="JE02" >JE02</option>
							<option value="JE03" >JE03</option>
							<option value="JE04" >JE04</option>
							<option value="0000000194" >0000000194</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
				</form>
			</div>
            <!-- 第二行 -->
            <div class="layui-form-item">
			    <label class="layui-form-label"><span style="color:white;"><span class="v_d">$t('工單')</span></span>$t('工單號碼')<span class="v_d">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" id="txtOrderNo" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg" disabled="disabled" style="background: #EBEBE4;">
			    </div>
			    <form class="layui-form" action="">
			        <label class="layui-form-label"><span class="v_d">$t('工單')</span>GB2 $t('盘头批次')<span class="v_d">*</span></label>
					<div class="layui-input-inline bg2">
						<select name="quiz1" id="selGB2BatchNo" class="bg4">
							<!--<option value="">请选择</option>
							<option value="JE01" >JE01</option>
							<option value="JE02" >JE02</option>
							<option value="JE03" >JE03</option>
							<option value="JE04" >JE04</option>
							<option value="0000000194" >0000000194</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
					<label class="layui-form-label"><span class="v_d">工1&nbsp;</span>GB2 $t('盘头批次2')<span class="v_d">*</span></label>
					<div class="layui-input-inline">
						<select name="quiz1" id="selGB2BatchNo2">
							<!--<option value="">请选择</option>
							<option value="JE01" selected="">JE01</option>
							<option value="JE02" selected="">JE02</option>
							<option value="JE03" selected="">JE03</option>
							<option value="JE04" selected="">JE04</option>
							<option value="JE05" selected="">JE05</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
				</form>
			</div>
            <!-- 第三行 -->
			<div class="layui-form-item">
			    <label class="layui-form-label"><span style="color:white;"><span class="v_d">$t('工單')</span></span>$t('生產機號')<span class="v_d">*</span></label>
			    <div class="layui-input-inline" >
			      <input type="test" name="password" id="txtMachineNo"  lay-verify="required" autocomplete="off" class="layui-input bg" disabled="disabled" style="background: #EBEBE4;">
			    </div>
			    <form class="layui-form" action="">
			        <label class="layui-form-label"><span class="v_d">$t('工單')</span>GB3 $t('盘头批次')<span class="v_d">*</span></label>
					<div class="layui-input-inline">
						<select name="quiz1" id="selGB3BatchNo">
							<!--<option value="">请选择</option>
							<option value="JE01" selected="">JE01</option>
							<option value="JE02" selected="">JE02</option>
							<option value="JE03" selected="">JE03</option>
							<option value="JE04" selected="">JE04</option>
							<option value="JE05" selected="">JE05</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
					<label class="layui-form-label"><span class="v_d">工1&nbsp;</span>GB3 $t('盘头批次2')<span class="v_d">*</span></label>
					<div class="layui-input-inline">
						<select name="quiz1" id="selGB3BatchNo2"> 
							<!--<option value="">请选择</option>
							<option value="JE01" selected="">JE01</option>
							<option value="JE02" selected="">JE02</option>
							<option value="JE03" selected="">JE03</option>
							<option value="JE04" selected="">JE04</option>
							<option value="JE05" selected="">JE05</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
				</form>
			</div>
            <!-- 第四行 -->
			<div class="layui-form-item">
			    <label class="layui-form-label"><span style="color:white;"><span class="v_d">$t('工單工單')</span></span>$t('布号')<span class="v_d">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" id="txtGreigeNo" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg" disabled="disabled"  style="background: #EBEBE4;">
			    </div>
			    <form class="layui-form" action="">
			        <label class="layui-form-label"><span class="v_d">$t('工單')</span>GB4 $t('盘头批次')<span class="v_d">*</span></label>
					<div class="layui-input-inline">
						<select name="quiz1" id="selGB4BatchNo">
							<!--<option value="">请选择</option>
							<option value="JE01" selected="">JE01</option>
							<option value="JE02" selected="">JE02</option>
							<option value="JE03" selected="">JE03</option>
							<option value="JE04" selected="">JE04</option>
							<option value="JE05" selected="">JE05</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
					<label class="layui-form-label"><span class="v_d">工1&nbsp;</span>GB4 $t('盘头批次2')<span class="v_d">*</span></label>
					<div class="layui-input-inline">
						<select name="quiz1" id="selGB4BatchNo2">
							<!--<option value="">请选择</option>
							<option value="JE01" selected="">JE01</option>
							<option value="JE02" selected="">JE02</option>
							<option value="JE03" selected="">JE03</option>
							<option value="JE04" selected="">JE04</option>
							<option value="JE05" selected="">JE05</option>
							<option value="你的工号">江西省</option>
							<option value="你最喜欢的老师">福建省</option>-->
						</select>
					</div>
				</form>
			</div>
            <!-- 第五行 -->
			<div class="layui-form-item">
			    <label class="layui-form-label"  class="required"><span style="color:white;"><span class="v_d">$t('工單工單')</span></span>$t('匹号')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" id="txtUnitID" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1">
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">$t('工單工單')&nbsp;</span>$t('炮車編碼')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtShaftNo" >
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">$t("工工單")&nbsp;</span>$t('胚布WPI(左)')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtPG1061">
			    </div>
			</div>
            <!-- 第六行 -->
            <div class="layui-form-item">
			    <label class="layui-form-label"><span style="color:white;"><span class="v_d">$t('工單')</span></span>$t('機臺人員'):</label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtOperator">
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">工單工單&nbsp;</span>$t('炮車條碼')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtShaftCode">
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">工工單&nbsp;</span>$t('胚布WPI(中)')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtPG1062">
			    </div>
			</div>
			<!-- 第七行 -->
            <div class="layui-form-item">
			    <label class="layui-form-label" class="required"><span style="color:white;"><span class="v_d">工單</span></span>$t('開始時間')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtStartTime" placeholder="">
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">工單工單&nbsp;</span>$t('炮車重量')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtShaftWt">
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">工工單&nbsp;</span>$t('胚布WPI(右)')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtPG1063">
			    </div>
			</div>
            <!-- 第八行 -->
			<div class="layui-form-item">
			    <label class="layui-form-label" class="required"><span style="color:white;"><span class="v_d"></span></span>$t('胚布毛重(KG)')<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtGreigeGrossWt">
			    </div>
			    <label class="layui-form-label"><span class="v_d">工單&nbsp;</span>$t('胚布净重(KG)'):</label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg" id="txtGreigeNetWt" disabled="disabled"  style="background: #EBEBE4;">
			    </div>
			    <label class="layui-form-label" class="required"><span class="v_d">工工單工工&nbsp;</span>$t('胚布')CPI<span style="color:red">*</span></label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtPG1058">
			    </div>
			</div>
            <!-- 第九行 -->
            <div class="layui-form-item">
			    <label class="layui-form-label"><span style="color:white;"><span class="v_d"></span></span>$t('报工日期/时间'):</label>
			    <div class="layui-input-inline">
			    	<input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg " id="txtEndTime" disabled="disabled" style="background: #EBEBE4;">
			      <!--<input type="text" class="layui-input" id="test1">-->
			    </div>
			    <!--此处隐藏-->
			    <label class="layui-form-label v_d"><span class="v_d">工單&nbsp;</span>$t('胚布净重')(KG):</label>
			    <div class="layui-input-inline v_d">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input">
			    </div>
			    <!--此处隐藏-->
			    <label class="layui-form-label" class="required">
			    	<span class="v_d">工工單工&nbsp;&nbsp;</span>
			    	$t('胚布封度')
			    	<span style="color:red">*</span>
			    </label>
			    <div class="layui-input-inline">
			      <input type="test" name="password" required lay-verify="required" autocomplete="off" class="layui-input bg1" id="txtPG1060">
			    </div>
			</div>
            <button class="layui-btn layui-btn-small" id="btnConfirm">$t('报工')</button>
            
		</div>
		<script type="text/javascript" src="plugins/layui/layui.all.js"></script>
        <script type="text/javascript" src="plugins/layui/layui.js"></script>
        <script type="text/javascript" src="build/js/jquery.js" ></script>
		<script src="plugins/layui/lay/modules/form.js" type="text/javascript"></script>
		<script src="build/js/di18n.js"></script>
        <script src="build/js/lang.js"></script>
        
		<script>
$(document).ready(function() {
	var alerted1=false;
	var alerted2=false;
	var alerted3=false;
	$("#txtPG1061").blur(function() {
		alerted2=false;
		var value = $(this).val();
		var ex = /^(\+|-)?\d+$/;//--/^\d+$/;	// 为整数
		if ((ex.test(value)) && value<1000) {
			return;
		}else{
			
			if(!alerted1){
				alerted1 = true;
				layer.alert(strchangeL("必须是整数且小于1000"));
			}
			$(this).val("");
			return false;
		}
	});
	
	$("#txtPG1062").blur(function() {
		alerted1=false;
		var value = $(this).val();
		var ex = /^(\+|-)?\d+$/;//--/^\d+$/;	// 为整数
		
		if ((ex.test(value)) && value<1000) {
			return true;
		}else{
			if(!alerted2){
				alerted2 = true;
				layer.alert(strchangeL("必须是整数且小于1000"));
			}
			
			$(this).val("");
			return false;
		}

	});
	
	$("#txtPG1063").blur(function() {
		var value = $(this).val();
		var ex = /^(\+|-)?\d+$/;//--/^\d+$/;	// 为整数
		
		if ((ex.test(value))&&value<1000) {
			return true;
		}else{
			layer.alert(strchangeL("必须是整数且小于1000"));
			$(this).val("");
			
			return false;
		}

	});
	

	
	//获取布票号码不存在清空val数据
	
	function empty(){
		$('#txtOrderNo').val('');
		$('#txtMachineNo').val('');
		$('#txtGreigeNo').val('');
		$('#txtUnitID').val('');
		$('#txtOperator').val('');
		$('#txtStartTime').val('');
		$('#txtGreigeGrossWt').val('');
		$('#txtEndTime').val('');
		$('#txtShaftNo').val('');
		$('#txtShaftCode').val('');
		$('#txtShaftWt').val('');
		$('#txtGreigeNetWt').val('');
		$('#txtPG1061').val('');
		$('#txtPG1062').val('');
		$('#txtPG1063').val('');
		$('#txtPG1058').val('');
		$('#txtPG1060').val('');
		$('.layui-select-title input').val('');
		eipt();
	}
	//清空input框disabled
	function eipt(){
		$("#btnConfirm").removeAttr("disabled");
		$("#btnConfirm").css("color",'#000000');
		$("select").removeAttr("disabled").removeClass("txtFieldDisable");
		$(".layui-input").removeAttr("high");
		$(".high").removeAttr("disabled");
		$(".high").removeClass("txtFieldDisable");
		$(".txtFieldDisable").removeClass("txtFieldDisable");
		$(".bg1").removeClass("txtFieldDisable1");
		$(".bg1").removeAttr("disabled");
		$('.layui-select-disabled .layui-disabled').css("background","#FFFFFF")
	}
	
	
	
//		//第一行
//		//布票號碼
//		var rollNo=document.getElementById('rollNo').value;
//		//工單號碼
//		var	txtOrderNo=document.getElementById('txtOrderNo').value;
//		//生產機號
//		var	txtMachineNo=document.getElementById('txtMachineNo').value;
//		//布号
//		var	txtGreigeNo=document.getElementById('txtGreigeNo').value;
//		//匹号
//		var	txtUnitID=document.getElementById('txtUnitID').value;
//		//機臺人員
//		var	txtOperator=document.getElementById('txtOperator').value;
//		//開始時間
//		var	txtStartTime=document.getElementById('txtStartTime').value;
//		//胚布毛重
//		var	txtGreigeGrossWt=document.getElementById('txtGreigeGrossWt').value;
//		//报工日期/时间:
//		var	txtEndTime=document.getElementById('txtEndTime').value;
//		
//		//第二行
//		//GB1 盘头批次
//		var	selGB1BatchNo=document.getElementById('selGB1BatchNo').value;
//		//GB2 盘头批次
//		var	selGB2BatchNo=document.getElementById('selGB2BatchNo').value;
//		//GB3 盘头批次
//		var	selGB3BatchNo=document.getElementById('selGB3BatchNo').value;
//		//GB4 盘头批次
//		var	selGB4BatchNo=document.getElementById('selGB4BatchNo').value;
//		//炮車編碼
//		var	txtShaftNo=document.getElementById('txtShaftNo').value;
//		//炮車條碼
//		var	txtShaftCode=document.getElementById('txtShaftCode').value;
//		//炮車重量
//		var	txtShaftWt=document.getElementById('txtShaftWt').value;
//		//胚布净重
//		var	txtGreigeNetWt=document.getElementById('txtGreigeNetWt').value;
//		
//		
//		//第三行
//		//GB1 盘头批次2
//		var	selGB1BatchNo2=document.getElementById('selGB1BatchNo2').value;
//		//GB2 盘头批次2
//		var	selGB2BatchNo2=document.getElementById('selGB2BatchNo2').value;
//		//GB3盘头批次2
//		var selGB3BatchNo2=document.getElementById('selGB3BatchNo2').value;
//		//GB4 盘头批次2
//		var	selGB4BatchNo2=document.getElementById('selGB4BatchNo2').value;
//		//胚布WPI(左)
//		var	txtPG1061=document.getElementById('txtPG1061').value;
//		//胚布WPI(中)
//		var	txtPG1062=document.getElementById('txtPG1062').value;
//		//胚布WPI(右)
//		var	txtPG1063=document.getElementById('txtPG1063').value;
//		//胚布CPI
//		var	txtPG1058=document.getElementById('txtPG1058').value;
//		//胚布封度
//		var	txtPG1060=document.getElementById('txtPG1060').value;
		
			layui.use(['form', 'laydate'], function() {
					var laydate = layui.laydate;
					var form = layui.form;
					laydate.render({
						elem: '#tex' //指定元素,
						
					});
					laydate.render({
						elem: '#txtStartTime' //指定元素,
						 ,type: 'datetime'
    					
					});
				
				});

/*结束*/

$("#rollNo").keydown(function(event) {

	if(event.keyCode == 13) {
		var rollNo = $('#rollNo').val();   //布票號碼
		
				if (rollNo == "") {
					layer.alert(strchangeL("輸入的布票號碼不存在"))
				} else {
					
				initFileds();
		
		$.ajax({
			url: getAjaxURL('/knittingCompletionConfirm/getWarpfcompletionConfirm'),
			type: "POST",
			async: false,
			//                          dataType: "json",
			data: {
//				roll_no: JSON.stringify($(this).val())
				roll_no:rollNo
			},
			success: function(data) {
				if(data.status==400){
					console.log(data)
					console.log($('#rollNo').val())
					console.log($('#rollNo').val()+":"+data.message)
					empty();
					layer.alert(strchangeL("布票號碼")+$('#rollNo').val()+":"+data.message,{title: strchangeL("提示")})
					$('#rollNo').blur();
					$("#btnConfirm").attr("disabled", "disabled");
					$("#btnConfirm").css("color",'#A0A0A0');
				} else if (data.data.confStatus == 'Y') {
					
					console.log(data.data.confStatus)
					console.log(data.status)
					
					//工單號碼
					$('#txtOrderNo').val(data.data.prodOrderNo);
					//生產機號
					$('#txtMachineNo').val(data.data.machineNo);
					//布号
					$('#txtGreigeNo').val(data.data.greigeNo);
					//匹号
					$('#txtUnitID').val(data.data.unitId);
					//機臺人員
					$('#txtOperator').val(data.data.operator);
					//開始時間
					$('#txtStartTime').val(timestampToTime(data.data.startTime));
					//胚布毛重
					$('#txtGreigeNetWt').val(data.data.netWeight);
					//报工日期/时间:
				    $('#txtEndTime').val(timestampToTime(data.data.confTime));
					//炮車編碼
					$('#txtShaftNo').val(data.data.shaftNo);
					//炮車條碼
					$('#txtShaftCode').val(data.data.shaftCode);
					//炮車重量
					$('#txtShaftWt').val(data.data.shaftWeight);
					//胚布毛重
					$('#txtGreigeGrossWt').val(data.data.grossWeight);

					pDown();
					
					 layer.alert(strchangeL("布票號碼:")+data.data.rollno+strchangeL("工单已报工"),{title: strchangeL("提示")});
						//GB1 盘头批次
//					console.log(document.getElementById("selGB1BatchNo"))
				document.getElementById("selGB1BatchNo").options.add(new Option(data.data.gb1_batchno,data.data.gb1_batchno));
					//Gb2 盘头批次
				document.getElementById("selGB2BatchNo").options.add(new Option(data.data.gb2_batchno,data.data.gb2_batchno));

					//GB3 盘头批次
				document.getElementById("selGB3BatchNo").options.add(new Option(data.data.gb3_batchno,data.data.gb3_batchno));

					//GB4 盘头批次
				document.getElementById("selGB4BatchNo").options.add(new Option(data.data.gb4_batchno,data.data.gb4_batchno));

					//GB1 盘头批次2
				document.getElementById("selGB1BatchNo2").options.add(new Option(data.data.gb1_batchno2,data.data.gb1_batchno2));

					//GB2 盘头批次2
				document.getElementById("selGB2BatchNo2").options.add(new Option(data.data.gb2_batchno2,data.data.gb2_batchno2));

					//GB3盘头批次2
				document.getElementById("selGB3BatchNo2").options.add(new Option(data.data.gb3_batchno2,data.data.gb3_batchno2));

					//GB4 盘头批次2
				document.getElementById("selGB4BatchNo2").options.add(new Option(data.data.gb4_batchno2,data.data.gb4_batchno2));

							disabledFileds();
//							$(".layui-input").attr("class","high");
//							$(".high").attr("disabled", "disabled").addClass("txtFieldDisable");
							$('#rollNo').removeClass('high');
							$('#rollNo').removeClass('txtFieldDisable');
							$('#rollNo').removeAttr('disabled');
							$('.bg1').attr("disabled", "disabled").addClass("txtFieldDisable");
							$('input').addClass("bg")
							//$('.layui-select-title').attr("disabled", "disabled").addClass("txtFieldDisable")
					layui.use('form',function(){
						form = layui.form
						form.render()
					})
				}else{
					var prodOrderNo=data.data.prodOrdNum;
					console.log(data.data.prodOrdNum)
					if(prodOrderNo==''){
						layer.alert(strchangeL("沒有數據"))
					}else{
						
					//工單號碼
					$('#txtOrderNo').val('');
					//生產機號
					$('#txtMachineNo').val('');
					//布号
					$('#txtGreigeNo').val('');
					//匹号
					$('#txtUnitID').val('');
					//機臺人員
					$('#txtOperator').val('');
					//開始時間
					$('#txtStartTime').val('');
					
					
					//胚布毛重
					$('#txtGreigeNetWt').val('');
					//报工日期/时间:
				    $('#txtEndTime').val('');
					//炮車編碼
					$('#txtShaftNo').val('');
					//炮車條碼
					$('#txtShaftCode').val('');
					//炮車重量
					$('#txtShaftWt').val('');
					//胚布毛重
					$('#txtGreigeGrossWt').val('');
						
						
					//工單號碼
					$('#txtOrderNo').val(data.data.prodOrdNum);
					//生產機號
					$('#txtMachineNo').val(data.data.machineNo);
					//布号
					$('#txtGreigeNo').val(data.data.greigeNo);
					
					 pDown();
					
				$('.bg1').attr("disabled", "disabled").addClass("txtFieldDisable")
//					console.log(document.getElementById("selGB1BatchNo"))
					document.getElementById("selGB1BatchNo").options.add(new Option(data.data.gb1_batchno,data.data.gb1_batchno));
					//Gb2 盘头批次
					document.getElementById("selGB2BatchNo").options.add(new Option(data.data.gb2_batchno,data.data.gb2_batchno));

					//GB3 盘头批次
					document.getElementById("selGB3BatchNo").options.add(new Option(data.data.gb3_batchno,data.data.gb3_batchno));

					//GB4 盘头批次
					document.getElementById("selGB4BatchNo").options.add(new Option(data.data.gb4_batchno,data.data.gb4_batchno));

					//GB1 盘头批次2
					document.getElementById("selGB1BatchNo2").options.add(new Option(data.data.gb1_batchno2,data.data.gb1_batchno2));

					//GB2 盘头批次2
					document.getElementById("selGB2BatchNo2").options.add(new Option(data.data.gb2_batchno2,data.data.gb2_batchno2));

					//GB3盘头批次2
					document.getElementById("selGB3BatchNo2").options.add(new Option(data.data.gb3_batchno2,data.data.gb3_batchno2));

					//GB4 盘头批次2
					document.getElementById("selGB4BatchNo2").options.add(new Option(data.data.gb4_batchno2,data.data.gb4_batchno2));
                        //document.getElementById('selGB4BatchNo2').value=data.data[0].gb4Batchno2;
					eipt();
					layui.use('form',function(){
						form = layui.form
						form.render()
					})
					}
				}
				
			},
			

		})
	}
	}
})

	function pDown(){
					var ptxtOrderNo=$('#txtOrderNo').val();
					var str="";
					if(ptxtOrderNo==""){
						return false;
					}else{
						var txtOrderNo = $('#txtOrderNo').val();   //布票號碼
						$.ajax({
							type: "POST",
							url:getAjaxURL("/knittingCompletionConfirm/getBatches"),
							async:false	,
							data:{
								orderNo:txtOrderNo
							},
							
							
						success:function(data){
							console.log(data)
							console.log(data.status)
							if(data.status==400){
								layer.alert(strchangeL("布票號碼")+":"+$('#rollNo').val()+data.message,{title: strchangeL("提示")});
								empty()
							}
							data=data.data;
							var sel=document.getElementById('selGB1BatchNo');
							var sel1=document.getElementById('selGB2BatchNo');
							var sel2=document.getElementById('selGB3BatchNo');
							var sel3=document.getElementById('selGB4BatchNo');
							var sel_1=document.getElementById('selGB1BatchNo2');
							var sel_2=document.getElementById('selGB2BatchNo2');
							var sel_3=document.getElementById('selGB3BatchNo2');
							var sel_4=document.getElementById('selGB4BatchNo2');
	　						var option_all=document.createElement ("option");
							option_all.text='';
							for(var i=0;i<data.length;i++){
											
		//						console.log(data[i].batchNo)
		//						console.log(data[i].itemId)
//								console.log(data[i].orderItemNO)
		//									
									if(data[i].orderItemNO == '0010'){
										//GB1 盘头批次
										var option=document.createElement ("option");
										
										option.text = data[i].batchNo;
										//sel.appendChild(option_all);
									    sel.appendChild(option);
//											console.log(sel)
										
//										if ($("#selGB1BatchNo2").children().size() == 0) {
//											var option1=document.createElement ("option");
//											option1.text = data[i].batchNo;
//										    sel_1.appendChild(option1);
//										}

										//GB1 盘头批次2
										var option1=document.createElement ("option");
										
										option1.text = data[i].batchNo;
										sel_1.appendChild(option_all);
									    sel_1.appendChild(option1);
										
									}else if(data[i].orderItemNO == '0020'){
										//GB2 盘头批次
										var option=document.createElement ("option");
										
										option.text = data[i].batchNo;
										//sel1.appendChild(option_all);
									    sel1.appendChild(option);	
//										if ($("#selGB2BatchNo2").children().size() == 0) {
//											var option1=document.createElement ("option");
//											option1.text = data[i].batchNo;
//									    	sel_2.appendChild(option1);
//										}
										//GB2 盘头批次2
										var option1=document.createElement ("option");
										
										option1.text = data[i].batchNo;
										sel_2.appendChild(option_all);
									    sel_2.appendChild(option1);
//									      sel_2.appendChild(option1);			
									}else if(data[i].orderItemNO == '0030'){
										//GB3 盘头批次
										var option=document.createElement ("option");
										
										option.text = data[i].batchNo;
									    sel2.appendChild(option);
									    //sel2.appendChild(option_all);
//									    if ($("#selGB3BatchNo2").children().size() == 0) {
//									    	var option1=document.createElement ("option");
//											option1.text = data[i].batchNo;
//									    	sel_3.appendChild(option1);
//										}
									    //GB3 盘头批次2
									    var option1=document.createElement ("option");
										
										option1.text = data[i].batchNo;
									    sel_3.appendChild(option1);
									    sel_3.appendChild(option_all);
									}else if(data[i].orderItemNO == '0040'){
										//GB4 盘头批次
										var option=document.createElement ("option");
										
										option.text = data[i].batchNo;
									    sel3.appendChild(option);
									    //sel3.appendChild(option_all);
//									    if ($("#selGB4BatchNo2").children().size() == 0) {
//									    	var option1=document.createElement ("option");
//											option1.text = data[i].batchNo;
//									    	sel_4.appendChild(option1);
//										}
										//GB4 盘头批次2
										var option1=document.createElement ("option");
										option1.text = data[i].batchNo;
									    sel_4.appendChild(option1);
									    sel_4.appendChild(option_all);
									}
								}
								
//							
						}
							
							
						});
					}
				}

	function disabledFileds() {
		$("select").attr("disabled", "disabled").addClass("txtFieldDisable");
		
		$(".required").next().find(":text:not('#rollNo')").attr({readonly: true,tabIndex: -1}).addClass("txtFieldDisable");
		$("#txtOperator").attr({readonly: true,tabIndex: -1}).addClass("txtFieldDisable");
		$("#btnConfirm").attr("disabled", "disabled");
		$("#btnConfirm").css("color",'#A0A0A0');
		
	}
	
		function initFileds() {
					$("select").removeAttr("disabled").removeClass("txtFieldDisable").empty();
					$(".required").next().find(":text:not('#txtRollNo')").attr({readonly: false,tabIndex: 0}).removeClass("txtFieldDisable").val("");
					$("#txtOperator").attr({readonly: false,tabIndex: 0}).removeClass("txtFieldDisable").val($.trim($("#hdnUser").val()));
					$(":text.txtFieldDisable").val("");
					$("#btnConfirm").attr("disabled", "disabled");
		}
	//胚布毛重与胚布净重 炮車重量之间的计算
	
	$("#txtGreigeGrossWt").bind('keyup',function(){
		$('#txtGreigeNetWt').val($('#txtGreigeGrossWt').val()-$('#txtShaftWt').val()+".00")
	})
	$('#txtShaftWt').bind('keyup',function(){
		$('#txtGreigeNetWt').val($('#txtGreigeGrossWt').val()-$('#txtShaftWt').val()+".00")
	})
	//报工
		var btnConfirm=document.getElementById('btnConfirm');

		btnConfirm.onclick=function(){
			//判断可输入框必填
			
       if ($('#txtUnitID').val()=='' || $('#txtShaftNo').val()=='' || $('#txtPG1061').val()=='' || $('#txtOperator').val()=='' || $('#txtShaftCode').val()=='' || $('#txtPG1062').val()=='' || $('#txtStartTime').val()=='' || $('#txtShaftWt').val()=='' || $('#txtPG1063').val()=='' || $('#txtGreigeGrossWt').val()=='' || $('#txtPG1058').val()=='' || $('#txtPG1060').val()=='') {
				layer.alert(strchangeL('请输入必输欄位'));
				return false;
			}
//			var alertMandatoryFlag = false;
//				$.each($(".required").next().find(":text"), function(index, element) {
//					if ($.trim(element.value) == "") {
//						alertMandatoryFlag = true;
//						return false;
//					}
//			});
//				
//			if (alertMandatoryFlag) {
//				alert('请输入必输欄位');
//				return false;
//			}
			
			if ($("#txtGreigeNetWt").val() <= 0) {
				layer.alert(strchangeL("淨重量必須大於等於零"));
				return false;
			}
			$.ajax({
				type:"get",
				url:getAjaxURL("/knittingCompletionConfirm/warpConfirm"),
				data:{
				//布票號碼
				ROLLNO:$('#rollNo').val(),
				//工單號碼
				PROD_ORDER_NO:$('#txtOrderNo').val(),
				//生產機號
				MACHINE_NO:$('#txtMachineNo').val(),
				//布号
				GREIGE_NO:$('#txtGreigeNo').val(),
				//匹号
				UNITID:$('#txtUnitID').val(),
				//機臺人員
				OPERATOR:$('#txtOperator').val(),
				//開始時間
				START_TIME:$('#txtStartTime').val(),
				//胚布毛重
				GROSSWT:$('#txtGreigeGrossWt').val(),
				//报工日期/时间:
				END_TIME:$('#txtEndTime').val(),
				
				//第二行
				//GB1 盘头批次
				GB1BATCH:$('#selGB1BatchNo').val(),
				//GB2 盘头批次
				GB2BATCH:$('#selGB2BatchNo').val(),
				//GB3 盘头批次
				GB3BATCH:$('#selGB3BatchNo').val(),
				//GB4 盘头批次
				GB4BATCH:$('#selGB4BatchNo').val(),
				//炮車編碼
				SHAFTNO:$('#txtShaftNo').val(),
				//炮車條碼
				SHAFT_CODE:$('#txtShaftCode').val(),
				//炮車重量
				SHAFTWT:$('#txtShaftWt').val(),
				//胚布净重
				NETWT:$('#txtGreigeNetWt').val(),
				
				
				//第三行
				//GB1 盘头批次2
				GB1BATCH2:$('#selGB1BatchNo2').val(),
				//GB2 盘头批次2
				GB2BATCH2:$('#selGB2BatchNo2').val(),
				//GB3盘头批次2
				GB3BATCH2:$('#selGB3BatchNo2').val(),
				//GB4 盘头批次2
				GB4BATCH2:$('#selGB4BatchNo2').val(),
				//胚布WPI(左)
				PG1061:$('#txtPG1061').val(),
				//胚布WPI(中)
				PG1062:$('#txtPG1062').val(),
				//胚布WPI(右)
				PG1063:$('#txtPG1063').val(),
				//胚布CPI
				PG1058:$('#txtPG1058').val(),
				//胚布封度
				PG1060:$('#txtPG1060').val()
				},
				success:function(data){
					console.log(data)
					console.log(data.message)
					if(data.status=='200') {
						layer.alert(data.message)
					}else if(data.status=='400'){
						layer.alert(data.message,{title: strchangeL("提示")})
					}
				}
			});
		}
	
});//尾部				
		</script>
		<!--公共方法-->
		<script>
//			时间戳转时间格式
			function timestampToTime(timestamp) {
				        var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
				        Y = date.getFullYear() + '-';
				        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
				        D = date.getDate() + ' ';
				        h = date.getHours() + ':';
				        m = date.getMinutes() + ':';
				        s = date.getSeconds();
				        return Y+M+D+h+m+s;
				    }
		</script>
	</body>

</html>
