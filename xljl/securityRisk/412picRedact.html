<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>图片编辑</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <link href="../public/style/alert/css/qikoo.css" rel="stylesheet">
    <link href="../public/style/public.css" rel="stylesheet" type="text/css">
	 <link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
    <!--<link href="../style/index.css" rel="stylesheet" type="text/css">-->
    <script type="text/javascript" src="../public/js/jquery.js"></script>
    <script type="text/javascript" src="../public/js/jQuery.alertShow.js"></script>
    <script type="text/javascript" src="../js/joint.js"></script>
    <style>
    	.redact {
		    overflow: hidden;
		    position: relative;
		}
		
		.redact > img {
		    width: 100%;
		    height: auto;
		}
		
		.redact span {
		    width: 4rem;
		    height: 4rem;
		    overflow: hidden;
		    border-radius: 2rem;
		    position: absolute;
		    left: 50%;
		    bottom: 5%;
		    transform: translateX(-50%);
		}
		
		.redact span img {
		    width: 100%;
		    height: auto;
		}
		
		.redactMessage {
		    /*overflow: hidden;*/
		    padding: .8rem 0;
		}
		
		.redactMessage label {
		    width: 30%;
		    height: 100%;
		    overflow: hidden;
		    line-height: 2.8rem;
		    float: left;
		    text-align: center;
		    font-size: 1.2em;
		}
		
		.redactMessage input {
		    width: 65%;
		    height: 2.2rem;
		    float: left;
		    border: 0;
		    border-radius: .3rem;
		    margin-top: .3rem;
		    text-indent: .8rem;
		    font-size: 14px;
		}
		
		.redactMessage textarea {
		    width: 65%;
		    /*height: 6em;*/
		    overflow: hidden;
		    float: left;
		    resize: none;
		    border: 0;
		    border-radius: .3rem;
		    margin-top: .6rem;
		    text-indent: .8rem;
		    line-height: 1.6rem;
		    font-size: 14px;
		}
    	.addControl {
			width: 100%;
			height: 50px;
			background-color: #28907E;
			position: fixed;
			bottom: 0;
		}
		
		.addControl div {
			width: 50%;
			float: left;
		    text-align: center;
		    color: white;
		    height: 100%;
		    position: relative;
		}
		.addControl div p {
		    width: 100%;
		    height: 60%;
		    float: left;
		    line-height: 120%;
		    font-size: 10px !important;
		}
		.addControl div p:nth-child(1){
			margin-top: 2%;
		}
		.addControl div .saveImg {
			background: url(../img/save.png)no-repeat center;
			background-size: auto 65%;
		}
		
		.addControl div .cancelImg {
			background: url(../img/close.png)no-repeat center;
			background-size: auto 65%;
		}
		
		.addControl div .border {
			width: 0;
			height: 60%;
			border-right: 1px solid #fff;
			position: absolute;
			right: 0;
			top: 20%;
		}
    </style>
</head>
<body >
<div class="indexPage" style="background: #eee">		
<section class="cell-6 redact">
    <img src="">
    <span class="canvas"><img src="../img/redactBtn.png"></span>
</section>
<section class="cell-4 redactMessage">
    <div class="cell-1">
        <label>照片名称</label>
        <input type="text" id="fileName" class="text">
    </div>
    <div class="cell-7">
        <label>照片描述</label>
        <textarea id="desc" placeholder="限50字" maxlength="50" rows="5"></textarea>
    </div>
</section>
<div class="addControl">
			<div class="save">
				<p class="saveImg"></p>
				<p>保存</span>
				<p class="border"></p>
			</div>
			<div class="cancel">
				<p class="cancelImg"></p>
				<p>取消</p>
			</div>
		</div>
</div>
</body>
</html>
<script>
	var time = window.location.search.split('=')[1];
	var temp = window.localStorage.getItem(time);
	$(function(){
		$('.redact>img').attr('src',temp.split(',')[4]);
		$('#fileName').val(temp.split(',')[2]);
		$('#desc').val(temp.split(',')[7])
	})
	
	$('#fileName').focus(function(){
		$('.redact').hide();
	})
	$('#fileName').blur(function(){
		$('.redact').show();
	})
	$('#desc').focus(function(){
		$('.redact').hide();
	})
	$('#desc').blur(function(){
		$('.redact').show();
	})
    $('.save').on('click',function(){
    	
    	if(!$('#fileName').val()){
    		qikoo.dialog.alert("文件名不能为空")
    	}else if(!$('#desc').val()){
    		qikoo.dialog.alert("照片描述不能为空")
    	}else{
    		
	    	var t = temp.split(",");
	    	var len = t.length;
	    	t[2]= $('#fileName').val();
	    	t[7]=$('#desc').val();
	    	t[5]="1";
	    	for(var i=0;i<len;i++){
	    		if(i==0){
	    			temp=t[i];
	    		}else{
	    			temp=temp+","+t[i];
	    		}
	    	}
	    	window.localStorage.setItem(time,temp);
	    	history.back();
    	}
    	
    })
    $('.cancel').on('click',function(){
    	history.back();
    })
    $('.canvas').on('click',function(){
    	window.location.href = '../webContent/611canvas.html?time='+time;
    })
</script>