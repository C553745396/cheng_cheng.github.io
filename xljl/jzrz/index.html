<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>监造日志</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link href="../css/global.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../css/mui/mui_css/mui.min.css">
    <link rel="stylesheet" href="../css/alert/css/qikoo.css"/>
    <link href="../css/mui/mui_css/mui.picker.css" rel="stylesheet"/>
    <link href="../css/mui/mui_css/mui.poppicker.css" rel="stylesheet"/>
   	<link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
   
   
    <style>


        .btns01 {
            /*border-bottom: 12px solid #f5f5f5;*/
            float: left;
            font-size: 1em;
            height: 1.8rem;
            padding: 0 0 0.4em;
            width: 50%;
            color: #878787;
            line-height: 1rem;
            padding: .4rem 0;
            position: relative;
            border-right: 1px solid #d6d6d6;
            background-color: #f7f7f7;
            text-align: center;
            top: 0.5rem;
        }

        .btns01 p img {
            border: 0;
            width: 5%;
        }

        .btns02 {
            /*border-bottom: 12px solid #f5f5f5;*/
            float: left;
            font-size: 1em;
            height: 1.8rem;
            padding: 0 0 0.4em;
            width: 50%;
            color: #878787;
            line-height: 1rem;
            padding: .4rem 0;
            position: relative;
            border-right: 0px solid #d6d6d6;
            background-color: #f7f7f7;
            text-align: center;
            top: 0.5rem;
        }

        #topPopover {
            position: fixed;
            top: 85px;
            width: 100%;
        }

        #topPopover .mui-popover-arrow {
            left: 2rem;
        }

        .mui-popover {
            height: 140px;
        }

        .mui-content {
            padding: 10px;
        }

        .topTip {
            text-align: center;
            /*top:80px;*/
            width: 100%;
            position: absolute;
            font-size: 14px;
            color: #8f8f94;
        }

        .bottomTip {
            text-align: center;
            position: absolute;
            bottom: 0px;
            /*top:80px;*/
            width: 100%;
            position: absolute;
            font-size: 14px;
            color: #8f8f94;
        }
        .pStyle{
            margin-top:5px;
            height: 24px;
            line-height: 15px;
        }
        .mui-table-view{
            padding-top: 5px;
        }
        
        .mui-bar-nav{
        	top:40px;
        }
    </style>


    <!--<script src="../js/mui.picker.js"></script>
    <script src="../js/mui.poppicker.js"></script>-->
</head>

<body>
<header class="mui-bar mui-bar-nav">

    <div class="btns01" id="selectDiv">
        <p>筛选<img src="../img/select_03.png" class="i_coins"></p>
    </div>
    <div class="btns02" id="addButton">
        <p>新增</p>
    </div>
</header>

<div class="indexPage">
    <div class="topTip" id='topTip' style="display: none;">下拉可以刷新</div>
    <div class="bottomTip" id='bottomTip' style="display: none;">上拉加载更多</div>
    <div class="mui-scroll-wrapper" style="top:84px;">
        <div class="mui-scroll" id="scrollDiv">
            <ul id="list" class="mui-table-view mui-table-view-chevron">

            </ul>
        </div>
    </div>
</div>

<div id="topPopover" class="mui-popover">
    <div class="mui-popover-arrow"></div>
    <div class="mui-scroll-wrapper">
        <div class="mui-scroll">
            <form class="mui-input-group">

                <div class="mui-input-row">

                    <input type="text" class="mui-input-clear" id='wlmsText' placeholder="项目名称">
                </div>

                <div class="mui-input-row">

                    <input type="text" class="mui-input-clear" id='recordUsernameText' placeholder="记录人">
                </div>
                <div class="mui-button-row">
                    <button id="selectButton" type="button" class="mui-btn mui-btn-primary">查询
                    </button>
                    &nbsp;&nbsp;
                    <button id="cancelButton" type="button" class="mui-btn mui-btn-danger">取消
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript" src="../cordova.js"></script>
<script src="../JM/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="../public/js/public.js"></script>
<!--<script src="../js/AJAX/prodBuild.js" type="text/javascript" charset="utf-8"></script>-->

<script src="../JM/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/core.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/enc-base64.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/cipher-core.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/aes.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/sha256.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/jmUtil.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="../js/public/joint.js"></script>

<script src="../js/AJAX/prodBuild.js" type="text/javascript" charset="utf-8"></script>
<script src="../public/js/jQuery.alertShow.js" type="text/javascript" charset="utf-8"></script>

<script src="../js/mui.min.js"></script>

<!--<script src="js/update.js" type="text/javascript" charset="utf-8"></script>-->
<script type="text/javascript" charset="UTF-8">
    var page = 1;
    var totalPages = 0;
    var jsonObj = eval('(' + data.data1001.request + ')');
    // 是否需要刷新的变量， true刷新
    var flagRefres = false;
    // 是否需要加载更多的变量， true加载
    var flagDoMore = false;

    mui.init();

    mui.ready(function () {

        

    });

    jQuery(function () {
//        // console.log(222222);

    });

function onDeviceReady (){
	//筛选按钮绑定事件
        var showSelect = document.getElementById('selectDiv');
        showSelect.addEventListener('click', function (event) {
            mui('#topPopover').popover('show');
        }, false);

        // 新增按钮绑定事件
        var addButton = document.getElementById("addButton");
        addButton.addEventListener('click', function (event) {
            window.location.href = 'edit.html?oprType=add';
        }, false);

        // 查询框， 查询按钮绑定事件
        var selectButton = document.getElementById("selectButton");
        selectButton.addEventListener('click', function (event) {
            // 查询列表
            doSelect();
            // 关闭查询框
            mui('#topPopover').popover('hide');
        }, false);
        // 查询框， 取消按钮绑定事件
        var cancelButton = document.getElementById("cancelButton");
        cancelButton.addEventListener('click', function (event) {
            // 关闭查询框
            mui('#topPopover').popover('hide');
        }, false);


        // 查询列表的拖动事件， 上拉加载，下拉刷新
        //拖动结束事件
        var listObj = document.getElementById('scrollDiv');
        // console.log(listObj);
        listObj.addEventListener("dragend", function () {
//            // console.log('dragend');
            if (flagRefres) {
                doSelect();
            }
            if (flagDoMore) {
                doMore();
            }
            flagRefres = false;
            flagDoMore = false;
            jQuery("#topTip").css("display", "none");
            jQuery("#topTip").html("下拉刷新");
            jQuery("#bottomTip").css("display", "none");
            jQuery("#bottomTip").html("上拉加载更多");
        }, false);
        //拖动中事件
        listObj.addEventListener("drag", function () {
//            // console.log("drag");
            var top = jQuery("#scrollDiv").css('transform');
            top = top.substring(21, top.length - 1);
            jQuery("#topTip").css("display", "block");
            jQuery("#topTip").html("下拉刷新");
            jQuery("#bottomTip").css("display", "block");
            if (page == totalPages) {
                jQuery("#bottomTip").html("已经没有更多");
            } else {
                jQuery("#bottomTip").html("上拉加载更多");
            }
            var maxY = mui('.mui-scroll-wrapper').scroll()[0].maxScrollY;


            //向下拉
            if (top > 50) {
                jQuery("#topTip").html("释放立即刷新");
                flagRefres = true;
            } else if (top < (maxY - 50) && page < totalPages) {
                jQuery("#bottomTip").html("释放立即加载更多");
                flagDoMore = true;
            }
            //向上拉
//            // console.log(top);
//            // console.log(jQuery("#listDiv")[0].scrollHeight);
//            // console.log(mui('.mui-scroll-wrapper').scroll()[0].maxScrollY);
        }, false);

        //初始化查询区域滚动
        mui('.mui-scroll-wrapper').scroll({
            deceleration: 0.0005
        });

        //初始化查询
        doSelect();
        
}
    /**
     * 初始化查询
     */
    function doSelect() {
    	//alert(232351);
        mui('#topPopover').popover('hide');
        var wlms = jQuery("#wlmsText").val();
        var recordUser = jQuery("#recordUsernameText").val();
        // 将当前页设置为1
        page = 1;
        jsonObj = eval('(' + data.data1001.request + ')');
        jsonObj.data.type = "select";
        jsonObj.data.WLMS = wlms;
        jsonObj.data.RECORD_USERNAME = recordUser;
        jsonObj.data.iPage = page;
        
         var jsonStr = JSON.stringify(jsonObj);
			 data.data1001.request = jsonStr;
			//alert(23235);
        getJSON(url,data.data1001, doSelectBack);

    }
    /**
     * 初始化查询，回调函数
     */
    function doSelectBack(v) {
    	//alert(232335);
       /// v = eval('(' + v + ')');
//				// console.log(v);
        jQuery("#list").children().remove();
        if (v.count) {  //lw@
            var dataObj = v.records;
            totalPages = v.iPageCnt;
//            page = 1;
            var length = dataObj.length;
           
                for (var i = 0; i < length; i++) {
                    var res = "";
                    var MATERIAL_NO = "";
                    if(typeof (dataObj[i].MATERIAL_NO) == "undefined"){

                    } else {
                        MATERIAL_NO = dataObj[i].MATERIAL_NO;
                    }
                    var CPSCGH = "";
                    if(typeof (dataObj[i].CPSCGH) == "undefined"){

                    } else {
                        CPSCGH = dataObj[i].CPSCGH;
                    }
                    res += "<li class='mui-table-view-cell'  >";
                    res += "<div class='mui-slider-right mui-disabled'>";
                    res += "<a name='buttonEdit' class='mui-btn mui-btn-blue' dataId='" + dataObj[i].ID + "'  >编辑</a>";
                    res += "<a name='buttonDel' class='mui-btn mui-btn-red' dataId='" + dataObj[i].ID + "' >删除</a>";
                    res += "</div>";
                    res += "<div class='mui-slider-handle mui-table' name='contentLi' dataId='" + dataObj[i].ID + "' >";
//                    res += "<div class='mui-table-cell mui-col-xs-12'>";
//                    res += "<p class='mui-h6 mui-ellipsis pStyle' ><span class='title2'>项目名称：" + dataObj[i].ERPGCMC + "&nbsp;</span></p>";
//			    	res +="<p class='mui-h6 mui-ellipsiss pStyle'>物资唯一码："+dataObj[i].WZWYM+"</p>";
//                    //res += "<p class='mui-h6 mui-ellipsiss'>项目名称：" + dataObj[i].ERPGCMC + "</p>";
//                    //res += "<p class='mui-h6 mui-ellipsiss'><span class='title5'>设备/材料型号：" + MATERIAL_NO + " 生产工号：" + CPSCGH + "</span></p>";
////			    	//res +="<p class='mui-h6 mui-ellipsiss'></p>";
//                    //res += "<p class='mui-h6 mui-ellipsiss'>监造工作情况：" + dataObj[i].SUPERVISE_SITUATION + "</p>";
//                    res += "<p class='mui-h6 mui-ellipsiss pStyle'><span class='title5'>记录人：" + dataObj[i].RECORD_USERNAME + "&nbsp;&nbsp;记录日期：" + dataObj[i].RECORD_DATE + "</span></p>";
////			    	//res +="<p class='mui-h6 mui-ellipsiss'>记录日期："+dataObj[i].RECORD_DATE+"</p>";
//                    res += "</div>";

                    res +="<div class='mui-row'>";
                    res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                    res += "<p class='mui-h6 mui-ellipsis pStyle'><span class='title2'>" + dataObj[i].ERPGCMC + "&nbsp;</span></p>";
                    res +="</div>";
                    res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                    res +="<p class='mui-h6 mui-ellipsiss pStyle'>"+dataObj[i].WZWYM+"</p>";
                    res +="</div>";
                    res +="</div>";

                    res +="<div class='mui-row'>";
                    res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                    res += "<p class='mui-h6 mui-ellipsiss pStyle'><span class='title5'>" + dataObj[i].RECORD_USERNAME  + "</span></p>";
                    res +="</div>";
                    res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                    res +="<p class='mui-h6 mui-ellipsiss pStyle'>"+dataObj[i].RECORD_DATE+"</p>";
                    res +="</div>";
                    res +="</div>";


                    res += "</div>";
                    res += "</li>";
                    jQuery(res).appendTo('#list');
                }
            
        }
        // 为删除按钮绑定事件
        var delButtons = document.getElementsByName("buttonDel");
        for (var j = 0; j < delButtons.length; j++) {
            delButtons[j].addEventListener('click', function (event) {
                doDel(this.getAttribute("dataId"));
            }, false);
        }
        
        
        // 为编辑按钮绑定事件
        var buttonEdit = document.getElementsByName("buttonEdit");
        for (var j = 0; j < buttonEdit.length; j++) {
            buttonEdit[j].addEventListener('click', function (event) {
                window.location.href='edit.html?oprType=edit&LOGID='+ this.getAttribute("dataId");
            }, false);
        }

        // 点击记录时 ， 查看事件
        var contentLis = document.getElementsByName("contentLi");
        for (var j = 0; j < contentLis.length; j++) {
            contentLis[j].addEventListener('click', function (event) {
                window.location.href='edit.html?oprType=view&LOGID='+ this.getAttribute("dataId");
            }, false);
        }
//				document.getElementsByName("buttonDel")

    }
    /**
     * 加载更多，事件
     */
    function doMore() {
        mui('#topPopover').popover('hide');

        var wlms = jQuery("#wlmsText").val();
        page++;
        var recordUser = jQuery("#recordUsernameText").val();
        jsonObj = eval('(' + data.data1001.request + ')');
        jsonObj.data.type = "select";
        jsonObj.data.WLMS = wlms;
        jsonObj.data.RECORD_USERNAME = recordUser;
        jsonObj.data.iPage = page;
        
         var jsonStr = JSON.stringify(jsonObj);
			 data.data1001.request = jsonStr;
			//alert(23235);
        getJSON(url,data.data1001, doMoreBack);
       // getJSON(jsonObj, doMoreBack);

    }
    /**
     * 加载更多事件的回调函数
     */
    function doMoreBack(v) {
    //    v = eval('(' + v + ')');
//				// console.log(v);
//      jQuery("#list").children().remove();
        if (v.count) {  //lw@
            var dataObj = v.records;
            totalPages = v.iPageCnt;
//            page = 1;
            var length = dataObj.length;

            for (var i = 0; i < length; i++) {
                var res = "";
                var MATERIAL_NO = "";
                if(typeof (dataObj[i].MATERIAL_NO) == "undefined"){

                } else {
                    MATERIAL_NO = dataObj[i].MATERIAL_NO;
                }
                var CPSCGH = "";
                if(typeof (dataObj[i].CPSCGH) == "undefined"){

                } else {
                    CPSCGH = dataObj[i].CPSCGH;
                }
                res += "<li class='mui-table-view-cell'  >";
                res += "<div class='mui-slider-right mui-disabled'>";
                res += "<a name='buttonEdit' class='mui-btn mui-btn-blue' dataId='" + dataObj[i].ID + "'  >编辑</a>";
                res += "<a name='buttonDel' class='mui-btn mui-btn-red' dataId='" + dataObj[i].ID + "' >删除</a>";
                res += "</div>";
                res += "<div class='mui-slider-handle mui-table' name='contentLi' dataId='" + dataObj[i].ID + "' >";
//                res += "<div class='mui-table-cell mui-col-xs-10'>";
//                res += "<p class='mui-h6 mui-ellipsis pStyle'><span class='title2'>项目名称：" + dataObj[i].ERPGCMC + "&nbsp;</span></p>";
//			    res +="<p class='mui-h6 mui-ellipsiss pStyle'>物资唯一码："+dataObj[i].WZWYM+"</p>";
//                //res += "<p class='mui-h6 mui-ellipsiss'>项目名称：" + dataObj[i].ERPGCMC + "</p>";
//                //res += "<p class='mui-h6 mui-ellipsiss'>设备/材料型号：" + MATERIAL_NO + " 生产工号：" + CPSCGH + "</p>";
////			    		res +="<p class='mui-h6 mui-ellipsiss'></p>";
//                //res += "<p class='mui-h6 mui-ellipsiss'>监造工作情况：" + dataObj[i].SUPERVISE_SITUATION + "</p>";
//                res += "<p class='mui-h6 mui-ellipsiss pStyle'>记录人：" + dataObj[i].RECORD_USERNAME + "&nbsp;&nbsp;记录日期：" + dataObj[i].RECORD_DATE + "</p>";
////			    //		res +="<p class='mui-h6 mui-ellipsiss'>记录日期："+dataObj[i].RECORD_DATE+"</p>";
//                res += "</div>";

                res +="<div class='mui-row'>";
                res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                res += "<p class='mui-h6 mui-ellipsis pStyle'><span class='title2'>" + dataObj[i].ERPGCMC + "&nbsp;</span></p>";
                res +="</div>";
                res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                res +="<p class='mui-h6 mui-ellipsiss pStyle'>"+dataObj[i].WZWYM+"</p>";
                res +="</div>";
                res +="</div>";

                res +="<div class='mui-row'>";
                res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                res += "<p class='mui-h6 mui-ellipsiss pStyle'><span class='title5'>" + dataObj[i].RECORD_USERNAME  + "</span></p>";
                res +="</div>";
                res +="<div class='mui-col-sm-6 mui-col-xs-12'>";
                res +="<p class='mui-h6 mui-ellipsiss pStyle'>"+dataObj[i].RECORD_DATE+"</p>";
                res +="</div>";
                res +="</div>";
                res += "</div>";
                res += "</li>";
                jQuery(res).appendTo('#list');
            }

        }
        // 为删除按钮绑定事件
        var delButtons = document.getElementsByName("buttonDel");
        for (var j = 0; j < delButtons.length; j++) {
            delButtons[j].addEventListener('click', function (event) {
                doDel(this.getAttribute("dataId"));
            }, false);
        }


        // 为编辑按钮绑定事件
        var buttonEdit = document.getElementsByName("buttonEdit");
        for (var j = 0; j < buttonEdit.length; j++) {
            buttonEdit[j].addEventListener('click', function (event) {
                window.location.href='edit.html?oprType=edit&LOGID='+ this.getAttribute("dataId");
            }, false);
        }

        // 点击记录时 ， 查看事件
        var contentLis = document.getElementsByName("contentLi");
        for (var j = 0; j < contentLis.length; j++) {
            contentLis[j].addEventListener('click', function (event) {
                window.location.href='edit.html?oprType=view&LOGID='+ this.getAttribute("dataId");
            }, false);
        }
//				document.getElementsByName("buttonDel")

    }

    /**
     * 编辑事件
     */
    function doEdit(v) {
        setTimeout(function () {
            window.location.href = 'list.html';
        }, 500);
    }

    /**
     * 删除事件
     */
    function doDel(id) {
//        mui.toast('删除成功');
//        // console.log(123123);
//		qikoo.dialog.confirm()
		
        qikoo.dialog.confirm('确定要删除吗？', function () {
            jsonObj = eval('(' + data.data1001.request + ')');
            jsonObj.data.type = "del";
            jsonObj.data.ID = id;
            
            var jsonStr = JSON.stringify(jsonObj);
			 data.data1001.request = jsonStr;
					//alert(23235);
       		 getJSON(url,data.data1001, doDelBack);
            //getJSON(jsonObj, doDelBack);
        }, function () {

        });

    }
    /**
     * 删除事件，回调函数
     */

    function doDelBack(v) {
       // v = eval('(' + v + ')');
//				// console.log(v);
        if (v.count) {
           qikoo.dialog.alert("删除成功！");
            doSelect();
        }
    }
</script>
</body>


</html>
