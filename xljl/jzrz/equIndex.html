<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>监造设备选择</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	<link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
    <link href="../css/global.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="../css/mui/mui_css/mui.min.css">
    <link rel="stylesheet" href="../css/alert/css/qikoo.css"/>
    <link href="../css/mui/mui_css/mui.picker.css" rel="stylesheet"/>
    <link href="../css/mui/mui_css/mui.poppicker.css" rel="stylesheet"/>
    <style>


        .btns01 {
            /*border-bottom: 12px solid #f5f5f5;*/
            float: left;
            font-size: 1em;
            height: 1.8rem;
            padding: 0 0 0.4em;
            width: 50%;
            color: #878787;
            line-height: 1rem;
            padding: .4rem 0;
            position: relative;
            border-right: 1px solid #d6d6d6;
            background-color: #f7f7f7;
            text-align: center;
            top: 0.5rem;
        }

        .btns01 p img {
            border: 0;
            width: 5%;
        }

        .btns02 {
            /*border-bottom: 12px solid #f5f5f5;*/
            float: left;
            font-size: 1em;
            height: 1.8rem;
            padding: 0 0 0.4em;
            width: 50%;
            color: #878787;
            line-height: 1rem;
            padding: .4rem 0;
            position: relative;
            border-right: 0px solid #d6d6d6;
            background-color: #f7f7f7;
            text-align: center;
            top: 0.5rem;
        }

        #topPopover {
            position: fixed;
            top: 46px;
            width: 100%;
        }

        #topPopover .mui-popover-arrow {
            left: 2rem;
        }

        .mui-popover {
            height: 140px;
        }

        .mui-content {
            padding: 10px;
        }

        .mui-text-right {
            vertical-align: middle;
        }

        .topTip {
            text-align: center;
            /*top:80px;*/
            width: 100%;
            position: absolute;
            font-size: 14px;
            color: #8f8f94;
        }

        .bottomTip {
            text-align: center;
            position: absolute;
            bottom: 0px;
            /*top:80px;*/
            width: 100%;
            position: absolute;
            font-size: 14px;
            color: #8f8f94;
        }
        .pStyle{
            margin-top:5px;
            height: 24px;
            line-height: 15px;
        }
    </style>
</head>

<body>
<header class="mui-bar mui-bar-nav">

    <div class="btns01" id="selectDiv" onclick="doShaiXuanButton()">
        <p>筛选<img src="../img/select_03.png" class="i_coins"></p>
    </div>
    <div class="btns02" id="addButtonJZRZ" onclick="doQueDing();" >
        <p>确定</p>
    </div>
</header>
<div class="mui-content">
    <div class="topTip" id='topTip' style="display: none;">下拉可以刷新</div>
    <div class="bottomTip" id='bottomTip' style="display: none;">上拉加载更多</div>
    <div id='listDiv' class="mui-scroll-wrapper" style="top:44px;">
        <div class="mui-scroll" id="scrollDiv">
            <ul id="list" class="mui-table-view mui-table-view-radio">

            </ul>
        </div>
    </div>
</div>

<div id="topPopover" class="mui-popover">
    <div class="mui-popover-arrow"></div>
    <div class="mui-scroll-wrapper">
        <div class="mui-scroll">
            <form class="mui-input-group">

                <div class="mui-input-row">

                    <input type="text" class="mui-input-clear" id='wlmsText' placeholder="物资名称">
                </div>

                <div class="mui-input-row">

                    <input type="text" class="mui-input-clear" id='WZWYM' placeholder="物资唯一码">
                </div>
                <div class="mui-button-row">
                    <button id="selectButton" type="button" class="mui-btn mui-btn-primary" >查询
                    </button>
                    &nbsp;&nbsp;
                    <button id="cancelButton" type="button" class="mui-btn mui-btn-danger">取消
                    </button>
                </div>
            </form>
        </div>
    </div>

</div>
 <script type="text/javascript" src="../cordova.js"></script>
	
<script type="text/javascript" src="../public/js/public.js"></script>
<script src="../js/mui.min.js"></script>
<script src="../js/mui.picker.js"></script>
<script src="../js/mui.poppicker.js"></script>
<script src="../JM/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/core.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/enc-base64.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/cipher-core.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/aes.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/CryptoJS/sha256.js" type="text/javascript" charset="utf-8"></script>
<script src="../JM/jmUtil.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/AJAX/prodBuild.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="../js/common.js" type="text/javascript" charset="utf-8"></script>-->
<script src="../js/jQuery.alertShow.js" type="text/javascript" charset="utf-8"></script>
<!--<script src="js/update.js" type="text/javascript" charset="utf-8"></script>-->
<script type="text/javascript" charset="UTF-8">
    var page = 1;
    var totalPages = 0;
    var jsonObj = eval('(' + data.data1001.request + ')');
    var flagRefres = false;
    var flagDoMore = false;
    var equId = '';
    mui.init();

    function onDeviceReady() {
        equId = '';
        var showSelect = document.getElementById('selectDiv');
        showSelect.addEventListener('click', function (event) {

            mui('#topPopover').popover('show');
        }, false);

        //清空radio的选中状态

        //为确定按钮添加事件
//        var addButton = document.getElementById('addButtonJZRZ');
//			  //alert(addButton);
//        addButton.addEventListener('click', function (event) {
////                // console.log(112);
//
//        }, false);

        // 查询框， 查询按钮绑定事件
        // 查询框， 查询按钮绑定事件
        var selectButton = document.getElementById("selectButton");
        selectButton.addEventListener('click', function (event) {
            // 查询列表
            doSelect();
            // 关闭查询框
            mui('#topPopover').popover('hide');
        }, false);
        // 查询框， 取消按钮绑定事件
        var cancelButton = document.getElementById("cancelButton");
        cancelButton.addEventListener('click', function (event) {
            // 关闭查询框
            mui('#topPopover').popover('hide');
        }, false);

        mui('.mui-scroll-wrapper').scroll({
            deceleration: 0.0005
        });

        //拖动结束事件
        var listObj = document.getElementById('scrollDiv');
        listObj.addEventListener("dragend", function () {
            if (flagRefres) {
                doSelect();
            }
            if (flagDoMore) {
                doMore();
            }
            flagRefres = false;
            flagDoMore = false;
            jQuery("#topTip").css("display", "none");
            jQuery("#topTip").html("下拉刷新");
            jQuery("#bottomTip").css("display", "none");
            jQuery("#bottomTip").html("上拉加载更多");
        });
        //拖动中事件
        listObj.addEventListener("drag", function () {
            var top = jQuery("#scrollDiv").css('transform');
            top = top.substring(21, top.length - 1);
            jQuery("#topTip").css("display", "block");
            jQuery("#topTip").html("下拉刷新");
            jQuery("#bottomTip").css("display", "block");
            if (page == totalPages) {
                jQuery("#bottomTip").html("已经没有更多");
            } else {
                jQuery("#bottomTip").html("上拉加载更多");
            }
            var maxY = mui('.mui-scroll-wrapper').scroll()[0].maxScrollY;


            //向下拉
            if (top > 50) {
                jQuery("#topTip").html("释放立即刷新");
                flagRefres = true;
            } else if (top < (maxY - 50) && page < totalPages) {
                jQuery("#bottomTip").html("释放立即加载更多");
                flagDoMore = true;
            }
            //向上拉
            // console.log(top);
            // console.log(jQuery("#listDiv")[0].scrollHeight);
            // console.log(mui('.mui-scroll-wrapper').scroll()[0].maxScrollY);
        });

        //				初始化查询
        doSelect();
    }

    function doRadioClick(val){
//        alert('click'+val);
        equId = val;
//        为确定按钮添加事件
//        var addButton = document.getElementById('addButtonJZRZ');
//        addButton.addEventListener('click',function(){
//
//            alert(equId);
//
////                // console.log(equID);
//            if (typeof(equId) == 'undefined' || equId == "") {
//                qikoo.dialog.alert('您还没有选择设备');
//            } else {
//                //jQuery("input:radio").removeAttr("checked");
//
//                //alert(equID);
//                window.location.href ='edit.html?oprType=addSelect&equId='+equId;
//            }
//        });
    }
    function doRadioSelect(val){
        //alert('select');
    }
    function doRadioChange(val){
        // alert('change');
    }

    function doQueDing(){
        //alert("1");
        //alert(jQuery("input:radio:checked").length());
//        var equID = jQuery("input:radio:checked").val();
        //alert(equID);

//                // console.log(equID);
        if (typeof(equId) == 'undefined' || equId == "") {
            qikoo.dialog.alert('您还没有选择设备');
        } else {
            //jQuery("input:radio").removeAttr("checked");

            //alert(equID);
            window.location.href ='edit.html?oprType=addSelect&equId='+equId;
        }
    }
    function doXuanze(){
        document.querySelector('.mui-table-view.mui-table-view-radio').addEventListener('selected',function(e){
            equId = e.detail.el.dataset.id;
        });
    }
    function doShaiXuanButton(){
        // 查询列表
        doSelect();
        // 关闭查询框
        mui('#topPopover').popover('hide');
    }

    function doSelect() {
        mui('#topPopover').popover('hide');

        var wlms = jQuery("#wlmsText").val();
        var wzwym = jQuery("#WZWYM").val();
        jsonObj = eval('(' + data.data1001.request + ')');
        jsonObj.data.type = "selectEqu";
        jsonObj.data.WLMS = wlms;
        jsonObj.data.WZWYM = wzwym;
        jsonObj.data.iPage = page;
        
        var jsonStr = JSON.stringify(jsonObj);
			 data.data1001.request = jsonStr;
			//alert(23235);
        getJSON(url,data.data1001, doSelectBack);
       // getJSON(jsonObj, doSelectBack);

    }
    function doSelectBack(v) {
       // v = eval('(' + v + ')');
//				// console.log(v);
        jQuery("#list").children().remove();
        if (v.count) {  //lw@
            totalPages = v.iPageCnt;
            page = 1;
            var dataObj = v.records;
            var length = dataObj.length;
            for (var i = 0; i < length; i++) {
                var res = "";
                res += "<li class='mui-table-view-cell' data-id='"+dataObj[i].ID+"'>";
//			    		res +="<div class='mui-slider-right mui-disabled'>";
//			    		res +="<a class='mui-btn mui-btn-blue' onclick='doView("+dataObj[i].ID+")'>查看</a>";
//			    		res +="<a class='mui-btn mui-btn-red'  onclick='doDel("+dataObj[i].ID+")'>删除</a>";
//			    		res +="</div>";
//			    		res +="<div class='mui-slider-handle mui-table'>";
                res += "<div class='mui-navigate-right'>";
                //res += "<div class='mui-table-cell mui-col-xs-10'>";
                res += "<p class='mui-h6 mui-ellipsis pStyle'><span class='title2'>物资名称：" + dataObj[i].WLMS + "&nbsp;</span></p>";
                res +="<p class='mui-h6 mui-ellipsiss pStyle'><span class='title5'>物资唯一码："+dataObj[i].WZWYM+"</span></p>";
//			    		//res +="<p class='mui-h6 mui-ellipsiss'>产品生产工号："+dataObj[i].ERPGCMC+"</p>";
                //res += "<p class='mui-h6 mui-ellipsiss'><span class='title5'>产品生产工号：" + dataObj[i].ERPGCMC + " </span></p>";
                //res += "<p class='mui-h6 mui-ellipsiss'><span class='title5'>产品名称：" + dataObj[i].PRODUCT_NAME + "</span></p>";
                //res += "<p class='mui-h6 mui-ellipsiss'>ERP工程名称：" + dataObj[i].ERPGCMC + "</p>";
                //res += "<p class='mui-h6 mui-ellipsiss'>监造总监：" + dataObj[i].JZZJ_USER_NAME + " 供应商：" + dataObj[i].GYS_NAME + "</p>";
                res += "</div>";
//                res += "<div class='mui-table-cell mui-col-xs-2 mui-text-right'>";
//                res += "<input name='radio1' style='height:20px;width:20px'  value='" + dataObj[i].ID + "' dataId='" + dataObj[i].ID + "' type='radio' onclick='doRadioClick("+dataObj[i].ID+");' onchange='doRadioChange();'" +
//                        "onselect='doRadioSelect();'></input>";
//                res += "</div>";
//                res += "</div>";
                res += "</li>";
                jQuery(res).appendTo('#list');
            }
        }
        doXuanze();
    }

    function doMore() {
        mui('#topPopover').popover('hide');

        var wlms = jQuery("#wlmsText").val();
        var wzwym = jQuery("#WZWYM").val();
        jsonObj = eval('(' + data.data1001.request + ')');
        jsonObj=jsonObj.data;
        jsonObj.data.type = "selectEqu";
        jsonObj.data.WLMS = wlms;
        jsonObj.data.WZWYM = wzwym;
        jsonObj.data.iPage = page;
        
        var jsonStr = JSON.stringify(jsonObj);
			 data.data1001.request = jsonStr;
			//alert(23235);
        getJSON(url,data.data1001, doMoreBack);
       // getJSON(jsonObj, doMoreBack);

    }
    function doMoreBack(v) {
        //v = eval('(' + v + ')');
        // console.log(v);
//				jQuery("#list").children().remove();
        if (v.count) {  //lw@
            var dataObj = v.records;
            var length = dataObj.length;
            for (var i = 0; i < length; i++) {
                var res = "";
                res += "<li class='mui-table-view-cell' data-id='"+dataObj[i].ID+"'>";
//			    		res +="<div class='mui-slider-right mui-disabled'>";
//			    		res +="<a class='mui-btn mui-btn-blue' onclick='doView("+dataObj[i].ID+")'>查看</a>";
//			    		res +="<a class='mui-btn mui-btn-red'  onclick='doDel("+dataObj[i].ID+")'>删除</a>";
//			    		res +="</div>";
//			    		res +="<div class='mui-slider-handle mui-table'>";
                //res += "<div class='mui-table'>";
                res += "<div class='mui-navigate-right'>";
                res += "<p class='mui-h6 mui-ellipsis pStyle'><span class='title2'>物资名称：" + dataObj[i].WLMS + "&nbsp;</span></p>";
                res +="<p class='mui-h6 mui-ellipsiss pStyle'><span class='title5'>物资唯一码："+dataObj[i].WZWYM+"</span></p>";
//			    		//res +="<p class='mui-h6 mui-ellipsiss'>产品生产工号："+dataObj[i].ERPGCMC+"</p>";
                //res += "<p class='mui-h6 mui-ellipsiss'><span class='title5'>产品生产工号：" + dataObj[i].ERPGCMC + " </span></p>";
                //res += "<p class='mui-h6 mui-ellipsiss'><span class='title5'>产品名称：" + dataObj[i].PRODUCT_NAME + "</span></p>";
                //res += "<p class='mui-h6 mui-ellipsiss'>ERP工程名称：" + dataObj[i].ERPGCMC + "</p>";
                //res += "<p class='mui-h6 mui-ellipsiss'>监造总监：" + dataObj[i].JZZJ_USER_NAME + " 供应商：" + dataObj[i].GYS_NAME + "</p>";
                res += "</div>";
//                res += "<div class='mui-table-cell mui-col-xs-2 mui-text-right'>";
//                res += "<input name='radio1' style='height:20px;width:20px'  value='" + dataObj[i].ID + "' dataId='" + dataObj[i].ID + "' type='radio' onclick='doRadioClick("+dataObj[i].ID+");' onchange='doRadioChange();'" +
//                        "onselect='doRadioSelect();'></input>";
//                res += "</div>";
//                res += "</div>";
                res += "</li>";
                jQuery(res).appendTo('#list');
            }
        }
        doXuanze();
    }
    function doDel(id) {
        var btnArray = ['否', '是'];
        mui.confirm('确认是否删除？', '', btnArray, function (e) {
            if (e.index == 1) {
                jsonObj = eval('(' + data.data1001.request + ')');
                jsonObj=jsonObj.data;
                jsonObj.data.type = "del";
                jsonObj.data.ID = id;
                
          var jsonStr = JSON.stringify(jsonObj);
			 data.data1001.request = jsonStr;
			//alert(23235);
        getJSON(url,data.data1001, doDelBack);
              //  getJSON(jsonObj, doDelBack);
            }
        })
    }
    function doDelBack(v) {
        //v = eval('(' + v + ')');
//				// console.log(v);
        if (v.count) {
            mui.toast('删除成功');
            doSelect();
        }
    }
    function doEdit(v) {
        setTimeout(function () {
            window.location.href = 'list.html';
        }, 500);
    }
</script>
</body>

</html>
