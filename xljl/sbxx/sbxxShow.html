<!DOCTYPE html>
<html>
	<head>
	<meta charset="UTF-8">
	<title>设备信息</title>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta content="telephone=no" name="format-detection">
	
	<link href="../css/public.css" rel="stylesheet" type="text/css">
    <link href="../css/alert/css/qikoo.css" rel="stylesheet" type="text/css">
    <link href="../css/sbxx/sbxx.css" rel="stylesheet" type="text/css">
	<link href="../css/mui/mui_css/mui.picker.css" rel="stylesheet" />
	<link href="../css/mui/mui_css/mui.poppicker.css" rel="stylesheet" />
	<link href="../css/mui/mui_css/mui.min.css" rel="stylesheet" type="text/css">
	<link href="../style/index1.css" rel="stylesheet" type="text/css">
	<link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="../public/js/jQuery.alertShow.js"></script>
	<script type="text/javascript" src="../cordova.js"></script>
	<script type="text/javascript" src="../public/js/public.js"></script>
    <script src="../JM/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/mui.min.js" type="text/javascript"></script>
    <script src="../js/mui.picker.min.js"></script>    
	<script src="../js/mui.poppicker.js" type="text/javascript"></script>
	<script src="../JM/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
	<script src="../JM/CryptoJS/core.js" type="text/javascript" charset="utf-8"></script>
	<script src="../JM/CryptoJS/enc-base64.js" type="text/javascript" charset="utf-8"></script>
	<script src="../JM/CryptoJS/cipher-core.js" type="text/javascript" charset="utf-8"></script>
	<script src="../JM/CryptoJS/aes.js" type="text/javascript" charset="utf-8"></script>
	<script src="../JM/CryptoJS/sha256.js" type="text/javascript" charset="utf-8"></script>
	<script src="../JM/jmUtil.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/AJAX/prodBuild.js" type="text/javascript" charset="utf-8"></script>
    
  
    <script type="text/javascript" src="../js/public/joint.js"></script>
    
	<style>
			.btns01 {
	            width: 100%;
	            position: relative;
	            text-align: center;
	            top: -0.2rem;
	        }
			
			.titleSpan {
				height: .3rem;
				line-height: .3rem;
				border-radius: .2rem;
				display: block;
				padding-top: 10px;
				padding-left: 2px;
				float: left;
				width: 40%;
				font-size: 14px;
			}
			
			.valSpan {
				height: .3rem;
				border-radius: .2rem;
				display: block;
				float: left;
				width: 60%;
			}
			
			.valSpan input{
				height: .3rem;
				line-height: .3rem;
				border-radius: .2rem;
				display: block;
				float: left;
				width: 85%;
			}
			/*设备信息-begin*/
	
			.valSpan  i{
				display: inline-block;
				float: right;
				margin-top: -40px;
				margin-right: 20px;
			}
			
			.nomore{
				margin-top: 5px;
				width: 100%;
				text-align: center
			}
	
		 	#middlePopover {
	            position: fixed;
	            top: 46px;
	            width: 99%;
	        }
	        .mui-popover {
	            height: 180px;
	        }
	        
			#middlePopover .mui-popover-arrow {
	            margin-left: 47.5%
	        }
	        
	        /*#img{position: absolute;top:3px;left: 47%;}*/
	/*设备信息-end*/
		</style>
	<script type="text/javascript">
	
	//组织编码&角色编码
	var roleStr = localStorage.getItem(localStorage.getItem("userId") + "roleCode"); //orgCode&roleCode
	//角色编码
	//var roleCode = roleStr.split('&')[1];
	
	var flag = false;
	
	$(function () {

 	});
    function onDeviceReady (){
        //alert(123);
        mui.init();
        showTopTool();
        var areaPicker = new mui.PopPicker();
        initAreaList();

        //筛选按钮绑定事件
        var showSelect = document.getElementById('selectDiv');
        showSelect.addEventListener('click', function (event) {
            mui('#middlePopover').popover('show');
        }, false);

        // 查询框， 查询按钮绑定事件
        var selectButton = document.getElementById("selectButton");
        selectButton.addEventListener('click', function (event) {
            // 查询列表
            onDeviceReady();
            // 关闭查询框
            mui('#middlePopover').popover('hide');
        }, false);
        // 查询框， 取消按钮绑定事件
        var cancelButton = document.getElementById("cancelButton");
        cancelButton.addEventListener('click', function (event) {
            // 关闭查询框
            mui('#middlePopover').popover('hide');
        }, false);

		/*
		 //点击查询按钮
		 $('#queryBtn').on('click', function() {
		 onDeviceReady();
		 });

		 //点击重置按钮
		 $('#resetBtn').on('click', function() {
		 $("#wzmc").val('');
		 $("#cjmc").val('');
		 $('#areaName').val('');
		 sessionStorage.removeItem("sbxx_querys");
		 });

		 */
        //onDeviceReady();


        //初始化  区域归属
        function initAreaList(){
        	//alert(1234);
            var obj = eval('(' + data.data708.request + ')');
            //jsonObj.head.roleName=roleName
            var jsonStr = JSON.stringify(obj);
            data.data708.request = jsonStr;
            getJSON(url, data.data708, data708);
            //getJSON(obj, data708);
        }

        function data708(v){
            //alert("v3:"+v);
            v = eval('(' + v.toLowerCase() + ')');
            if(v.data.cont){
                var cont = v.data.cont;
                areaPicker.setData(cont);


                //设置之前的条件
                var q = sessionStorage.getItem("sbxx_querys");
                if(q){
                    var qs = q.split(",");
                    $('#areaName').val(qs[0]);
                    $("#cjmc").val(qs[1]);
                    $("#wzmc").val(qs[2]);
                }
            }
        }

        //查询函数
        var jsonObj = eval('(' + data.data701.request + ')');

        window.parent.document.addEventListener("deviceready", onDeviceReady, false);

        function onDeviceReady () {
        	//alert(1235);
            var areaName = $('#areaName').val();
            var cjmc = $("#cjmc").val();
            var wzmc = $("#wzmc").val();
            sessionStorage.setItem("sbxx_querys",areaName+","+cjmc+","+wzmc);//保存查询条件，为了页面跳转后重复赋值
            var jsonStr = JSON.stringify(jsonObj);
            data.data701.request = jsonStr;

            jsonObj.areaName = areaName;
            jsonObj.cjmc = cjmc;
            jsonObj.wzmc = wzmc;
            jsonObj.start=0;
            //alert(3333);
            pageUpDown();
            //alert(4444);
            getJSON(url, data.data701, data701);
            //alert(5555);
        }
        //列表数据
        function data701(v){
        	//alert(66666);
        	//alert("666"+v);
           // v = eval('(' + v + ')');
            //alert("v2"+v);
            $('.equ_items').children().remove();
            var dataObj = v.data.cont;
            var length = dataObj.length;           
            if(length>0){  //lw@
            	//alert(7777);
                var dataObj = v.data.cont;
                var length = dataObj.length;
                //alert("v1"+v);
                for(var i=0;i<length;i++){

                    var res = "";
                    res += "<li class='mui-table-view-cell'>";
                    res +="<div class='mui-slider-handle mui-table'>";
                    res += '<div class="sbxx" id="'+dataObj[i].ID+'" ><span class="sbxx_span"><div><span class="wlms title2 contentOne">'+dataObj[i].WLMS+'</span><span class="zjzj title5 contentTwo">'+dataObj[i].USER_NAME+'</span></div><div><span class="project title5 contentTwo">'+dataObj[i].ERPGCMC+'</span><span class="qygs title5 contentTwo">'+dataObj[i].AREA+'</span></div></span></div>';
                    res +="</div>";
                    res +="</li>";
                    $(res).appendTo('.equ_items');

                }
            }else{
                $('.nomore').remove();
                $('<div class="nomore"><span>没有更多记录</span></div>').appendTo('.equ_items');
            }

        }

        //下一页
        function pageUpDown() {
        	//alert(8888);
            $("#scroll").on("scroll", function() {
                var s = $("#scroll")[0];
                if (s.clientHeight + s.scrollTop > s.scrollHeight - 2) {
                    if (flag) {
                        var start = $('.sbxx').length;
                        jsonObj.start=start;
                        var jsonStr = JSON.stringify(jsonObj);
            			data.data701.request = jsonStr;
                        //getJSON( jsonObj, data7011);
                        getJSON(url, data.data701, data7011);
                    }
                }
            });
            $("#scroll").on('touchmove',function(){
                flag = true;
            })
        }

        function data7011(v){
        	//alert(99999);
            //v = eval('(' + v + ')');
            if(v.data.cont){
            	//alert(0000);
                $('.nomore').remove();
                var dataObj = v.data.cont;
                var length = dataObj.length;
                for(var i=0;i<length;i++){
                    var res = "";
                    res += "<li class='mui-table-view-cell'>";
                    res +="<div class='mui-slider-handle mui-table'>";
                    res += '<div class="sbxx" id="'+dataObj[i].ID+'" ><span class="sbxx_span"><div><span class="wlms title2 contentOne">'+dataObj[i].WLMS+'</span><span class="zjzj title5 contentTwo">'+dataObj[i].USER_NAME+'</span></div><div><span class="project title5 contentTwo">'+dataObj[i].ERPGCMC+'</span><span class="qygs title5 contentTwo">'+dataObj[i].AREA+'</span></div></span></div>';
                    res +="</div>";
                    res +="</li>";
                    $(res).appendTo('.equ_items');
                }
            }else{
                if($('.nomore').length==0){
                    $('<div class="nomore"><span>没有更多记录</span></div>').appendTo('.equ_items');
                }
            }
        }

        //点击列表中的数据，页面跳转到详细页面
        $('.equ_items').delegate('.sbxx','click',function(e){
            var tID = e.target.id;
            if(tID==""){
                tID = e.target.parentNode.id;
                if(tID==""){
                    tID = e.target.parentNode.parentNode.id;
                    if(tID==""){
                        tID = e.target.parentNode.parentNode.parentNode.id;
                    }
                }
            }
            window.location.href = 'sbxxEdit.html?tID='+tID;
        });

        $('#scroll').on('scroll',function(){
            var top = $('#scroll').scrollTop();
            if (top > 100) {
                $('.top').show()
            }else{
                $('.top').hide()
            }
        })

        $('.top').on('click',function(){
            $('#scroll').scrollTop(0);
            $('.top').hide()
        })
    }



    function showTopTool() {
			var indexHight = $('body')[0].offsetHeight;
			var hight1 = $('.equBody_header')[0].offsetHeight;
			var hight3 = indexHight - hight1 -10 ;
			$('.sbxxShow').css("height", hight3 + 'px')
		}
</script>
	</head>
	    <body class="equBody">
	  
	    	<header class="cell-1 equBody_header">
	    		<div class="btns01" id="selectDiv">
			        <p>
			        	<!--<a href="#middlePopover" >-->
			        		&nbsp;&nbsp;&nbsp;&nbsp;<img src="../img/select_03.png"  class="i_coins" style="
    margin-right: 7px;" id="img">&nbsp;&nbsp;&nbsp;&nbsp;
			        	<!--</a>-->
			        </p>
			    </div>
	    	</header>
	    	<section class="sbxxShow oneName" >
	    		<div class="equ_items" id="scroll" >
		    		<!--<li class='mui-table-view-cell'>
                  		 <div class='mui-slider-handle mui-table'>
	                    	<div class="sbxx" id="'+dataObj[i].ID+'" >
	                    		<span class="sbxx_span">
	                    			<div>
	                    				<span class="wlms title2 contentOne">12搜索搜索</span>
	                    				<span class="zjzj title5 contentTwo">23搜索搜索</span>
	                    			</div>
	                    			<div>
	                    				<span class="project title5 contentTwo">搜索搜索</span>
	                    				<span class="qygs title5 contentTwo">23搜索搜索</span>
	                    			</div>
	                    		</span>
	                    	</div>
                   		</div>
                    </li>
		    		-->
	    		</div>
	    		<div class="top" style="bottom: 20px">
	    			<img src="../img/tourCheckTop.png" alt="" />
	    			<span>回顶部</span>
	    		</div>
	    	</section>
	    	
	    	<div id="middlePopover" class="mui-popover" >
			    <div class="mui-popover-arrow"></div>
			    <div class="mui-scroll-wrapper">
			        <div class="mui-scroll">
			            <form class="mui-input-group">
			                <div class="mui-input-row">
			                    <input type="text" class="mui-input-clear" id='wzmc' placeholder="物资名称">
			                </div>
			                <div class="mui-input-row">
			                    <input type="text" class="mui-input-clear" id='cjmc' placeholder="厂家名称">
			                </div>
			                <div class="mui-input-row">
			                    <input type="text" class="mui-input-clear" id='areaName' placeholder="归属区域">
			                </div>
			                <div class="mui-button-row">
			                    <button id="selectButton" type="button" class="mui-btn mui-btn-primary">查询
			                    </button>
			                    &nbsp;&nbsp;
			                    <button id="cancelButton" type="button" class="mui-btn mui-btn-danger">取消
			                    </button>
			                </div>
			            </form>
			        </div>
			    </div>
			</div>
	    </body>
</html>
