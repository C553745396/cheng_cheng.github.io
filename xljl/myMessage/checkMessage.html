  <!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>消息详情</title>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	    <meta content="yes" name="apple-mobile-web-app-capable">
	    <meta content="black" name="apple-mobile-web-app-status-bar-style">
	    <meta content="telephone=no" name="format-detection">
	    <link href="../public/style/alert/css/qikoo.css" rel="stylesheet">
	    <link href="../public/style/public.css" rel="stylesheet">
	    <link href="../style/index.css" rel="stylesheet">
	     <link rel="stylesheet" type="text/css" href="../public/style/touchzoom/scale.css"/>
		 <link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
	    <script type="text/javascript" src="../cordova.js"></script>
		<script type="text/javascript" src="../public/js/public.js"></script>
		<script type="text/javascript" src="../public/js/jquery.js"></script>
		<script type="text/javascript" src="../js/public/joint.js"></script>
		<script type="text/javascript" src="../public/js/jQuery.alertShow.js"></script>
	    <script type="text/javascript" src="../js/AJAX/coreBuild.js"></script>
	    <script src="../public/js/touchzoom/scale.js" type="text/javascript"></script>
	    <style>
	    .replyMessage{
	    	background-color: #fff;
	    }
	    
	    	#CompanyNewsBackground {
			    background: #eeeeee;
			}
			
			.CompanyNews {
			    /*border: 1px solid #7c7c7c;*/
			    margin-top: .5rem;
			    color: white;
			    /*margin-right: 5%;*/
			    width: 50%;
			    height: auto;
			    border-radius: .5rem;
			    position: relative;
			    left: 45%;
			    line-height: 1.5rem;
			    top: -8%;
			    background-color: #1515FF;
			    z-index: 2;
			}
			
			.CompanyNews div {
			    width: 90%;
			    
			    font-size: 1.2em;
			    padding: .5rem;
			    /*margin: 0 auto;*/
			    margin-top: .1rem;
			    margin-bottom: .8rem;
			    word-wrap: break-word;
			}
			.CompanyNewsDate {
			    width: 40%;
			    /*margin-left: auto;
			    margin-right: auto;*/
			    text-align: center;
			    padding: .3rem 0;
			    font-size: 0.8em;
			    /*background: #e5e5e5;*/
			    color: #7c7c7c;
			    border-radius: .6em;
			    margin-top: 1.5rem;
			    margin-bottom: .3rem;
			    position: relative;
			    /*left: 55%;*/
			    right: -5%;
			    top: -1%;
			}
			.name{
				width: 40%;
				display: inline-block;
				position: relative;
				/*left: 55%;*/
				right: -65%;
				text-align: right;
				font-size: 0.8em;
			}
			.triangle {
		    position:absolute;
		    top:50%;
		    margin-top:-8px;
		    /*right:-200%;*/
		   left: 100%;
		    display:block;
		    width:0;
		    height:0;
		    overflow:hidden;
		    line-height:0;
		    font-size:0;
		    border-bottom:8px solid #FFF;
		    border-top:8px solid #FFF;
		    border-right:none;
		    border-left:8px solid #1515FF;
		    z-index: 1;
			}
			.come{
				left: 5%;
			}
			.CompanyNewsDate.come{
				left: 55%;
				top: 2%;
				
			}
			.CompanyNews.come{
				background-color: #00FF00;
				color: black;
				
			}
			.name.come{
				text-align: center;
				left: 55%;
				top: 0%;
			}
			.triangle.come{
				left: -8px;
				border-bottom:8px solid #FFF;
		    border-top:8px solid #FFF;
		    border-left:none;
		    border-right:8px solid #00FF00;
			}

.sendMessage {
    width: 100%;
    height: 3rem;
    overflow: hidden;
    border-top: 2px solid #e2e2e2;
    position: fixed;
    bottom: 0;
    left: 0;
    background: #dfdfdf;
    /*padding-bottom: 1.5em;*/
}

#messageBrowse {
    float: left;
    margin-left: .8rem;
    margin-top: .3rem;
}


.sendMessage input {
    width: 62%;
    height: 1.5rem;
    border: 1px solid #7cd1ee;
    border-radius: .4rem;
    margin-top: .9em;
    margin-left: 5%;
    text-indent: .8rem;
    float: left;
    outline: none;
}
#messageSend {
    float: left;
    color: #12AAED;
    font-size: 1rem;
    margin-top: 0.9rem;
    margin-left: 4%;
}


.messageIcon img {
    /*width: 30%;
    height: 30%;*/
    width: 2.3rem;
		height: 2.3rem;
}



	    </style>
	</head>
	<body >
		<div class="indexPage replyMessage">	
		<div class="CompanyNewsDate come">
			<span id="notTime"></span>			
		</div>
		<span id="noticeName" class="name come"></span>
		<div class="CompanyNews come">
			<span class="triangle come"></span>
			<div>
				<span id="notContent">没有数据,请重新加载...</span><br />
			</div>
		</div>
		
		<div id="titleDiv" style="display: none;" class="CompanyNewsDate">
			<span id="replyTime"></span>			
		</div>
		<div id="neirDiv" style="display: none;" class="CompanyNews">
			<span class="triangle"></span>
			<div>
				<span id="notContent1"></span><br />
			</div>
		</div>
		
		<section id="sendSec" class="sendMessage">
		    <div id="div">
		        <span id="messageBrowse" class="messageIcon"><img src="../img/photos.png"></span>
		        <input type="text" id="textNotice">
		        <span id="messageSend">发送</span>
		        <!--<span id="messageCamera" class="messageIcon"><img src="../img/messageCamera.png"></span>-->.
		    </div>
		</section>
		<section class="imgzoom_pack">
    		<div class="imgzoom_img"><img src="" /></div>
    </section>
     </div>
	</body>
</html>
<script type="text/javascript">
//var tID = window.location.search.split('=')[1];
var tID = window.location.search.substring(window.location.search.indexOf('=')+1,window.location.search.indexOf('&'));
var noticeType = window.location.search.split('=')[2].substr(0,1);
if(noticeType!='1'){
	document.getElementById("sendSec").style.display='none'
}
$(function(){
    document.addEventListener("deviceready", onDeviceReady, false);
    function onDeviceReady () {
    	var jsonObj = eval('('+coreData.data014.request+')');
			jsonObj.data.id = tID;
			var jsonStr = JSON.stringify(jsonObj);
			coreData.data014.request = jsonStr;
			getJSON(url, coreData.data014, data014)
			var replyInfo = localStorage.getItem(tID)
			if(replyInfo!=null){
				document.getElementById("sendSec").style.display='none'
				var replyObj = JSON.parse(replyInfo)
				var contStr = ""
				var urlStr = replyObj.url
				if(urlStr!=""){
					var str = urlStr.split("@")
					for(var i=0;i<str.length;i++){
						contStr = contStr + '<span class="imgs"> <img style="width:30px;height:18px" src="'+str[i]+'">&nbsp;  </span>'
					}
				}
				contStr = replyObj.cont+contStr
				document.getElementById("notContent1").innerHTML=contStr
				document.getElementById("replyTime").innerHTML=replyObj.time
				//document.getElementById("relyName").innerHTML=localStorage.getItem("userName")
				document.getElementById("titleDiv").style.display='block'
				document.getElementById("neirDiv").style.display='block'
					ImagesZoom.init({
							"elem": ".imgs"
					});
			}
    }
    function data014(v){
    	var dataObj = eval(v.data.cont)
    	if(dataObj){
    		document.getElementById("notTime").innerHTML=dataObj[0].SEND_TIME
	    	document.getElementById("noticeName").innerHTML=dataObj[0].SENDER
				document.getElementById("notContent").innerHTML=dataObj[0].CONTENT
    	}
    	
    }

  var urlstr = ""
  var setTime
	$('.sendMessage div').delegate('span:eq(1)','click',function(e){
		var cont = document.getElementById("textNotice").value
		document.getElementById("notContent1").innerHTML=cont
		var nowTime = getNowTime()
		document.getElementById("replyTime").innerHTML=nowTime
		document.getElementById("titleDiv").style.display='block'
		document.getElementById("neirDiv").style.display='block'
		var choose = window.sessionStorage.getItem('choose'+tID);
		
		var jsonObj = eval('('+coreData.data002.request+')');
		jsonObj.data.id = tID;
		jsonObj.data.cont = cont;
		if(choose==null){
			jsonObj.data.picture = '0'
			var jsonStr = JSON.stringify(jsonObj);
			coreData.data002.request = jsonStr;
			getJSON(url, coreData.data002, function(e){
				var nowTime = getNowTime()
				localStorage.setItem(tID,'{"cont":"'+cont+'","url":"","time":"'+nowTime+'"}')
				//document.getElementById("textNotice").value="";
				document.getElementById("sendSec").style.display='none'
			})
		}else if(choose==""){

			jsonObj.data.picture = '0'
			var jsonStr = JSON.stringify(jsonObj);
			coreData.data002.request = jsonStr;
			getJSON(url, coreData.data002, function(e){
				var nowTime = getNowTime()
				localStorage.setItem(tID,'{"cont":"'+cont+'","url":"","time":"'+nowTime+'"}')
				//document.getElementById("textNotice").value="";
				document.getElementById("sendSec").style.display='none'
			})
			
		}else{
			var chooseArr = choose.split(",")
			var len = chooseArr.length
			$("body").append('<div class="loading" id="loadingGif" style="display:block"><img src="../../img/loading.gif"></div>');
	    $("body").append('<div class="loadingMoveDiv" id="loadingGifDiv" style="top: 0;"></div>');
	    setTime=setTimeout(function(){ 
				$("#loadingGif").remove();
				$("#loadingGifDiv").remove();
			},60000*len);
	
			for(var i =0;i<len;i++){
				var temp = window.sessionStorage.getItem(chooseArr[i])
				var posy = temp.split(",")[0];
				var posx = temp.split(",")[1];
				var url = temp.split(",")[2];
				jsonObj.data.posy = posy;
				jsonObj.data.posx = posx;
				var jsonStr = JSON.stringify(jsonObj);
				coreData.data002.request = jsonStr;
				var data1={"method":"entry","request":encodeURIComponent(coreData.data002.request)};
				upload(url,data1);
			}
			
		}

	})
	function upload(url,data1){
		mam.navigator.appupload.appServerUpload(successUploadPICCallback, errCallback, "GCGKJL", "JL", url, data1);
		function successUploadPICCallback(obj){
			var cont = document.getElementById("textNotice").value
			qikoo.dialog.alert("发送成功")
			
			var dataobj = eval('('+obj+')')
	
			if(urlstr==""){
				urlstr = url
			}else{
				urlstr = urlstr +"@"+ url
			}

			var nowTime = getNowTime()
			localStorage.setItem(tID,'{"cont":"'+cont+'","url":"'+urlstr+'","time":"'+nowTime+'"}')
			
			var replyInfo = localStorage.getItem(tID)
			if(replyInfo!=null){
				var replyObj = JSON.parse(replyInfo)
				var contStr = ""
				var urlStr = replyObj.url
				if(urlStr!=""){
					var str = urlStr.split("@")
					for(var i=0;i<str.length;i++){
						contStr = contStr + '<span class="imgs"> <img style="width:25px;height:15px" src="'+str[i]+'">  </span>'
					}
				}
				contStr = replyObj.cont+contStr
				document.getElementById("notContent1").innerHTML=contStr
				document.getElementById("replyTime").innerHTML=replyObj.time
				document.getElementById("titleDiv").style.display='block'
				document.getElementById("neirDiv").style.display='block'
				ImagesZoom.init({
							"elem": ".imgs"
					});
			}

			//document.getElementById("textNotice").value="";
			document.getElementById("sendSec").style.display='none'
			$("#loadingGif").remove();
			$("#loadingGifDiv").remove();
			clearTimeout(setTime);
		}
		function errCallback(obj){
			qikoo.dialog.alert("发送失败")
			$("#loadingGif").remove();
			$("#loadingGifDiv").remove();
			clearTimeout(setTime);
		}
	}
	
	
})


$('#messageBrowse').on('click',function(){
	var messId = window.location.search.substring(window.location.search.indexOf('=')+1,window.location.search.indexOf('&'));
	window.location.href = '211picture.html?messId='+messId;
})
</script>    