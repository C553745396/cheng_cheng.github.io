<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
                      "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<!--<link rel="stylesheet" type="text/css" href="css/mam.css" />-->
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>工程管控测试</title>
<link rel="stylesheet" href="css/mui.min.css" />
<link rel="stylesheet" href="css/style.css" />
<script type="text/javascript" src="js/mui.min.js" ></script>
<script type="text/javascript" src="js/jquery-1.7.2.min.js" ></script>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>

</head>
<body align="center">


		<script type="text/javascript">
			$(function(){
				$('#login_bg').height($("body").height());
			});
		</script>

<div id="login_bg">
	<p style="font-size: 30px;color: #6ab3a9; margin-top: 20%; font-weight: bold;height: 50px;line-height: 50px;">工程管理信息平台</p>
</div>
		<div id="Whole">
			
			<div class="conter">
				
				<div class="login_title">
					<!--<img src="images/login_title.png" width="220rem"/>-->
				</div>
			
				<div class="account_opacity">
					<div class="account">	
					   <input type="text" value="" id="user" placeholder="请输入用户名"/>
					</div>
				</div>
				<div class="assword account_opacity">
					<div class="account">
					  <input type="password" value="" id="pass" placeholder="请输入密码"/>
					</div>  
				</div>
			<div id="verification_img">
				<div id="verification">
				
					<input class="iput" type="text"  id="checkimage" value="" placeholder="请输入验证码"/>
					<img id="imageDataV" onclick="getCheckImage();" src="" style="float: right;width: 100px;height:33px;font-size: 12px;display: inline-block;border:none;text-align: center;">
					<input type="button" id="ipt"  style="color:white;background:#419d90;position: absolute; font-size: 12px;width: 106px;height:35px; right: -3px;top:-1px; border:none;border-radius: 5px;" value="获取图形验证码">
				</div>
			</div>	
			
				
				<button type="button" class="bt"  onclick="verifyCode()">登录</button>
				
				<!--<button type="button" class="bt1"  onclick="exitAccount()" style="margin-top: 10px;">退出登录</button>
				
				
				<button type="button" class="bt2" onclick="share()" style="margin-top: 10px;">分享</button>
				
				<button type="button" class="bt3"  onclick="getInfo()" style="margin-top: 10px;">获取应用信息</button>-->

			</div>
		</div>


</body>
<script type="text/javascript">  
	
document.addEventListener("deviceready", onDeviceReady, false);

function onDeviceReady()
{
//	getCheckImage();
	var loginName = localStorage.getItem("myLoginName");
	if(loginName != null && loginName != ""){
        document.getElementById("user").value = loginName;
	}
	
}

//function getInfo(){
//	mam.navigator.settings.getAppInfo(getInfoCallBack);
//}
//function getInfoCallBack(v){
//	var json = JSON.stringify(v);
////	alert("getJson插件调用成功: "+json);
//}

//function share(){
//	mam.navigator.settings.share();
//}

//获取图像验证码
function getCheckImage(){
	try{
	mam.navigator.userlogin.getCheckImage(imageSCcallback);
	} catch(e){
		//var testInput=document.getElementById("ipt");
	Ainput.value = '再次获取验证码';
	Ainput.style.display="block";
	}
}

var guid;
function imageSCcallback(v)
{
	var scjson = JSON.stringify(v);
//	alert("getJson插件调用成功: "+scjson);
guid=v.guid;

if(v.imageData == ''){
	document.getElementById("imageDataV").src="";
//	var testInput=document.getElementById("ipt");
	Ainput.value = '再次获取验证码';
	Ainput.style.display="block";
} else {
	document.getElementById("imageDataV").src="data:image/jpeg;base64,"+v.imageData;
}
//document.getElementById("imageDataV").src="data:image/jpeg;base64,"+v.imageData;
//document.getElementById("getcheckImage").src=v.imageData;

console.log(scjson);
//document.getElementById("test").setAttribute("src", n+".png");
}

//登录
function verifyCode(){
	
	var loginName = document.getElementById("user").value;
    localStorage.setItem("myLoginName",loginName);
	var password = document.getElementById("pass").value;
	var checkCode = document.getElementById("checkimage").value;
//	alert(" loginName  "+loginName, "password  "+password," checkCode  "+checkCode,"  guid  "+guid);
     console.log(" loginName  "+loginName, "password  "+password," checkCode  "+checkCode,"  guid  "+guid);
	if(!checkVarilate(loginName,password,checkCode)) return;
	localStorage.setItem("loginName",loginName);
	mam.navigator.userlogin.verifyCode(verifyCodecallback,loginName,password,checkCode,guid);
	
//	window.location.href="index1.html";
}

function verifyCodecallback(v)
{
	var tcjson = JSON.stringify(v);
	var code = v.code; 
	var msg = v.msg;
	if (code == '000000'){
		window.sessionStorage.setItem("notFirst","true");
//		alert("userId:"+v.data.id);
		localStorage.setItem("userId",v.data.id);
		localStorage.setItem("userName",v.data.name);
		window.location.href="index1.html";
	} else {
		mui.alert(msg);
	}
	
}

//退出登录
//function exitAccount(){ 
//	mui.confirm("是否要退出登录","提示",null,function(e){
//		if(e.index==1){
//			mam.navigator.userlogin.exitAccount();
//			
//		}
//	});
//	
//}
//
//


var Ainput=document.getElementById("ipt");
function showinput(){
	
	Ainput.onclick=function(){
		this.style.display="none";
		getCheckImage();
	}
}
showinput();

//验证表单

function checkVarilate(loginName,password,checkCode){
	if(loginName==''){
	  mui.alert("对不起，帐号不能为空!");
		return false;
	}else if(password==""){
		mui.alert("对不起，密码不能为空!");
		return false;
	}else if(checkCode==""){
		mui.alert("对不起，验证码不能为空!")
	};
	
	return true;
	};

//判断登录状态
function checkLogin(){
	var userid = getUserId();
	
	if(userid == undefined || userid == null || userid == ""){
		mui.alert("请重新登录",null,function(){
			goURL("login.html");
		});
	}
	
}

</script> 
</html>
