<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>出勤记录</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <link href="../public/style/public.css" rel="stylesheet" type="text/css">
    <link href="../style/index.css" rel="stylesheet" type="text/css">
 	<link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="../cordova.js"></script>
	<script type="text/javascript" src="../public/js/public.js"></script>
    <script type="text/javascript" src="../public/js/jquery.js"></script>
    <script type="text/javascript" src="../public/js/dateXWG.js"></script>
    <script type="text/javascript" src="../js/AJAX/coreBuild.js"></script>
    <script type="text/javascript" src="../js/public/joint.js"></script>
    <style>

    	.kaoqinShow {
		    overflow: hidden;
		    overflow-y:auto;
		    height: 30%;
		}
		
		.kaoqinShow ul {
		    width: 100%;
		    height: auto;
		}
		
		.kaoqinShow ul li {
		    padding: .4rem 0;
		    line-height: 2.8rem;
		    border-bottom: 1px solid #D6D6D6;
		}
		
		
		.kaoqinShow ul li p{
		    float: left;
		    height: 100%;
		    font-size: 1em;
		    overflow: hidden;
		    text-overflow: ellipsis;
		    white-space: nowrap;
		}
		.kaoqinShow ul li p:first-child{
			
		    width: 80%;
		    padding-left: 5%;
		}
		.kaoqinShow ul li p:last-child{
			
		    width: 15%;
		}
		.kaoqinShow ul li p i {
		    width: 8%;
		    height: 100%;
		    display: inline-block;
		    margin-right: 2%;
		}
		
		.kaoqinShow ul li p i img {
		    width: 100%;
		    height: auto;
		    vertical-align: middle;
		}
		.signInHeader>div>img{
			width: auto;
			height: 50%;
			position: relative;
			top: 25%;
			
		}
		.dateLeft{
			float: left;
		}
		.dateRight{
			float: right;
			visibility: hidden;
		}
    </style>
</head>
<body >
	<div class="indexPage sd">	
<section class="signIn">
    <header class="signInHeader">
        <div>
        	<img class="dateLeft" src="../img/item_08.png"/>
            <i><img src="../img/testRecordCalendar.png"></i>

            <p></p>
            <img class="dateRight" src="../img/item_07.png"/>
        </div>
    </header>
</section>
<section class="week">
    <span>日</span>
    <span>一</span>
    <span>二</span>
    <span>三</span>
    <span>四</span>
    <span>五</span>
    <span>六</span>
</section>
<div class="date">
    <div class="signInDate"></div>
    <div class="signInError">
        <p><i></i><span>异常</span></p>

        <p><i></i><span>休假</span></p>

        <p><i></i><span>签到</span></p>
    </div>
</div>
<section class="cell-12 kaoqinShow project">
	<ul>
		
	</ul>
</section> 
</div>
</body>
<script type="text/javascript">
    $(function () {
        document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady () {
        	var dateTime = new Date();
        	var yearNow = dateTime.getFullYear();
            var monthNow = dateTime.getMonth() + 1;
            if(monthNow < 10){
            	monthNow = '0'+monthNow;
            }
        	var jsonObj = eval('('+coreData.data008.request+')');
			jsonObj.data.year = yearNow;
			jsonObj.data.month = monthNow;
			var jsonStr = JSON.stringify(jsonObj);
			coreData.data008.request = jsonStr;
			getJSON(url, coreData.data008, data008);
   		}
        var data;
        function data008(v) {
            data = v.data.records
            for (var i = 0; i < data.length; i++) {
            	var showTime =  data[i].dutydate
                if (data[i].dutydate) {
                    for (var j = 0; j < $('.signInDate span').length; j++) {
                        if ($('.signInDate span').eq(j).text() == parseInt(data[i].dutydate.split('-')[2])) {
                            if (data[i].isdutyexcp == 1) {
                                if($('.signInDate span i')){
                                	$('.signInDate span b').eq(j).attr('id',showTime)
                                    $('.signInDate span').eq(j).append('<i></i>');
                                }
                            } else if (data[i].isdutyexcp == 2) {
                            	$('.signInDate span b').eq(j).attr('id',showTime)
                                $('.signInDate span').eq(j).append('<i style="background:#3FDBDD;border: none; z-index: 1"></i>');
                                $('.signInDate span').eq(j).find('b').css('color','#fff');
                            } else if (data[i].isdutyexcp == 0) {
                            	$('.signInDate span b').eq(j).attr('id',showTime)
                                $('.signInDate span').eq(j).append('<i style="background:#aa89bd;border: none; z-index: 1"></i>');
                                $('.signInDate span').eq(j).find('b').css('color','#fff');
                            }
                        }
                    }
                }
            }
            $('.signInDate span').delegate('b','click',function(e){
            	var showDate = e.target.id
            	$('.kaoqinShow ul').find('li').remove();
            	for (var i = 0; i < data.length; i++) {
            		if(data[i].dutydate==showDate){
	            		var excpinfo;
		            	if (data[i].isdutyexcp == 0) {
		            		excpinfo = "  异常";
		            	}
		            	if (data[i].isdutyexcp == 1) {
		            		excpinfo = "  正常";
		            	}
		            	if (data[i].isdutyexcp == 2) {
		            		excpinfo = "  休假";
		            	}
		            	var showTime =  data[i].dutydate+" "+data[i].dutytime+"~"+data[i].offdutytime
						$('<li class="cell-1"><p >' + showTime + '</p><p>'+excpinfo+'</p></li>').appendTo('.kaoqinShow ul')
            		}
	            }
            })
            
        }
        
        $('.dateLeft').on('click',function(){
			num = 1;
			showDate();
			$(this).css("visibility","hidden");
			$('.dateRight').css("visibility","visible");
			
			var dateTime = new Date();
        	var yearNow = dateTime.getFullYear();
            var monthNow = dateTime.getMonth() + 1 - num;
            if (monthNow==0) {
            	yearNow = yearNow-1;
            	monthNow = 12;
            }
            if(monthNow < 10){
            	monthNow = '0'+monthNow;
            }
        	var jsonObj = eval('('+coreData.data008.request+')');
			jsonObj.data.year = yearNow;
			jsonObj.data.month = monthNow;
			var jsonStr = JSON.stringify(jsonObj);
			coreData.data008.request = jsonStr;
			getJSON(url, coreData.data008, data008);
			
		})
		$('.dateRight').on('click',function(){
			num = 0;
			showDate();
			$(this).css("visibility","hidden");
			$('.dateLeft').css("visibility","visible");
			
			var dateTime = new Date();
        	var yearNow = dateTime.getFullYear();
            var monthNow = dateTime.getMonth() + 1;
            if(monthNow < 10){
            	monthNow = '0'+monthNow;
            }
        	var jsonObj = eval('('+coreData.data008.request+')');
			jsonObj.data.year = yearNow;
			jsonObj.data.month = monthNow;
			var jsonStr = JSON.stringify(jsonObj);
			coreData.data008.request = jsonStr;
			getJSON(url, coreData.data008, data008);
		})
    })

</script>
</html>