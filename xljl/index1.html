<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8"/>
    <title>兴力监理</title>
    <!--<meta content="text/html; charset=utf-8" http-equiv="Content-Type">-->
    <!--<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">-->
    <!--<meta content="yes" name="apple-mobile-web-app-capable">-->
    <!--<meta content="black" name="apple-mobile-web-app-status-bar-style">-->
    <!--<meta content="telephone=no" name="format-detection">-->

    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link href="public/style/alert/css/qikoo.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="public/style/public.css">
    <link rel="stylesheet" type="text/css" href="style/indexSecond.css"/>
    <link rel="stylesheet" type="text/css" href="public/style/slideBar.css">

    <!--标准mui.css-->
    <link rel="stylesheet" href="public/style/mui.min.css">

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="public/js/public.js"></script>
    <script type="text/javascript" src="public/js/jquery.js"></script>
    <script type="text/javascript" src="public/js/mui.min.js"></script>
    <script type="text/javascript" src="js/public/joint.js"></script>
    <script type="text/javascript" src="public/js/jQuery.alertShow.js"></script>
    <script type="text/javascript" src="js/AJAX/coreBuild.js"></script>
    <!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=ED41WD9ZxMj2rBdRfRwnFL11"></script>
    <script type="text/javascript" src="http://developer.baidu.com/map/jsdemo/demo/convertor.js"></script>-->
    <style>
        .pmName {
            width: 300px;
            height: 200px;
            overflow: auto;

        }

        .pmName > label {
            width: 100%;
            display: inline-block;
            text-align: left;
            position: relative;
            text-indent: 6%;
        }

        .pmName > label > input {
            position: absolute;
            top: 38%;
        }

        .pmName > label > span {
            padding-left: 5%;
            width: 95%;
            height: 20px;
            display: block;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .pmName > label > span:last-child {
            color: #28907E;
        }

        .mui-slider-indicator {
            bottom: 0;
        }

        .mui-slider {
            background-color: #f2f2f2;
        }
    </style>
</head>


<body>

<div class="indexPage">
    <section class="indexcell-1">
        <div class="headImg">
            <img src="img/touxiang.png" class="touxiang"/>
            <img src="img/touxiang_bg.png" class="touxiang_bg"/>
            <img src="img/touxiang_quan.png" class="touxiang_quan"/>
            <p class="welcome" id="loginName"></p>
            <p class="orgRole" id="orgRole"></p>
        </div>
        <div class="navi">
            <div class="message">
                <span class="message_img"></span>
                <span>我的消息</span>
                <span class="num" id="noticeLen" style="display: none;"></span>
                <span class="border"></span>
            </div>
            <div class="attendance">
                <span class="attendance_img"></span>
                <span>出勤管理</span>
                <span class="border"></span>
            </div>
            <div class="tongxulu">
                <span class="phone_img"></span>
                <span>通讯录</span>
                <span class="border"></span>
            </div>
            <div class="switch">
                <span class="switch_img"></span>
                <span>角色切换</span>
            </div>
        </div>
    </section>
    <section class="indexcell-2" id="slider">
        <div>
            <span>当前位置：</span>
            <span class="address"></span>
            <span class="refesh"></span>
        </div>
    </section>
    <section class="indexcell-3">
        <div id="Gallery" class="mui-slider" style="margin-top:15px;">
            <div class="mui-slider-group mui-slider-loop">
                <div class="mui-slider-item mui-slider-item-duplicate">
                   <ul class="indexList indexList1" id="indexList2">                      
                        <li class="knowledge">
                            <span class="knowledge_img0"></span>
                            <span class="title">设备信息</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img1"></span>
                            <span class="title">进度维护</span>
                        </li><li class="knowledge">
                            <span class="knowledge_img2"></span>
                            <span class="title">厂家一览</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img3"></span>
                            <span class="title">监造日志</span>
                        </li>
                    </ul>
                </div>
                <div class="mui-slider-item">
                    <ul class="indexList indexList2">
                        <li class="project">
                            <span class="project_img"></span>
                            <span class="title">工程一览</span>
                        </li>
                        <li class="risk">
                            <span class="risk_img"></span>
                            <span class="title">风险一览</span>
                        </li>
                        <li class="progress">
                            <span class="progress_img"></span>
                            <span class="title">问题一览</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img"></span>
                            <span class="title">知识库</span>
                        </li>                      
                    </ul>
                </div>
                <div class="mui-slider-item">
                    <ul class="indexList indexList1" id="indexList1">                      
                        <li class="knowledge">
                            <span class="knowledge_img0"></span>
                            <span class="title">设备信息</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img1"></span>
                            <span class="title">厂家一览</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img2"></span>
                            <span class="title">进度维护</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img3"></span>
                            <span class="title">监造日志</span>
                        </li>
                    </ul>
                </div>
                <div class="mui-slider-item mui-slider-item-duplicate">
                   <ul class="indexList indexList2" >
                        <li class="project">
                            <span class="project_img"></span>
                            <span class="title">工程一览</span>
                        </li>
                        <li class="risk">
                            <span class="risk_img"></span>
                            <span class="title">风险一览</span>
                        </li>
                        <li class="progress">
                            <span class="progress_img"></span>
                            <span class="title">问题一览</span>
                        </li>
                        <li class="knowledge">
                            <span class="knowledge_img"></span>
                            <span class="title">知识库</span>
                        </li>                      
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <section class="indexFooter">
        <div class="indexSignFooter">
            <p class="c_kao">
                <i><img src="img/signIndex.png"></i>
                <span id="kao1">工作签到</span>
            </p>
            <p class="c_tui">
                <i><img src="img/signOutIndex.png"></i>
                <span id="kao2">工作签退</span>
            </p>
        </div>
    </section>
</div>


</body>
<script type="text/javascript">
            mui.init({
                swipeBack:true //启用右滑关闭功能
            });
            var slider = mui("#Gallery");
    //  定位功能
    function mylocation() {
        mam.navigator.openSwitch.lbs(successCallback, errorCallBack);
        function successCallback(v) {
            window.sessionStorage.setItem('jingweidu', v.longitude + '/' + v.latitude)
            var str = v.address;
            window.sessionStorage.setItem("address", str);
            $('.address').text(str)
        }

        function errorCallBack() {
            qikoo.dialog.alert("没有获取到位置")
        }
    }

    function nowTime() {
        var dateTime = new Date();
        year = dateTime.getFullYear();
        month = dateTime.getMonth() + 1;
        day = dateTime.getDate();
        return year + "-" + fnW(month) + "-" + fnW(day);
    }
    function fnW(str) {
        var num;
        str > 9 ? num = str : num = "0" + str;
        return num;
    }

    $(function () {
        touxiang();
        indexcell3();
        document.addEventListener("deviceready", onDeviceReady, false);
        function onDeviceReady() {

            //定位
//    	var notFirst = window.sessionStorage.getItem("notFirst");
//    	alert(notFirst)
//    	if (notFirst=="true") {
//    		var name = window.localStorage.getItem("userName");
//	   		$('.userName').text("您好,"+name);
//
//	   		var url = window.sessionStorage.getItem("headImg");
//	   		if (url) {
//	    		$('.indexincon-1 img').attr("src",url)
//	   		}
//  		if (localStorage.getItem(localStorage.getItem("userId")+"deptRole")) {
//	    		$('.org_role').text(localStorage.getItem(localStorage.getItem("userId")+"deptRole"))
//
//	    		var deptVal = localStorage.getItem(localStorage.getItem("userId")+"roleCode")
//	    		alert(deptVal)
//				if(deptVal=="ZSB&ZGB_BMZR"||deptVal=="ZSB&ZGB_BMZZ"||deptVal=="ZSB&JYB_BMZR"
//				||deptVal=="ZSB&CWB_BMZR"){
//					$('.indexUl li:eq(0)').hide()
//					$('.indexUl li:eq(1)').hide()
//					$('.indexUl li:eq(2)').hide()
//				}
//  		}else{
//  			$('.org_role').text("没有角色")
//				$('.indexUl li:eq(0)').hide()
//				$('.indexUl li:eq(1)').hide()
//				$('.indexUl li:eq(2)').hide()
//  		}
//
//  		var str = window.sessionStorage.getItem("address");
//	       	$('#address').text(str)
//
//  		kaoqin();
//
//    	}else{
            mylocation();
            //获取用户登录信息
//	    	mam.navigator.loadconfig.loginsession(1, login);
            login();
//    	}

        }


        var execType = "";
        //签到
        $(".c_kao").on("click", function () {
            var kaoUserId = localStorage.getItem("userId")


            var startTime = localStorage.getItem(kaoUserId + "startTime");
            if (startTime != null) {
                var arrstime = startTime.split(" ");
                var todayTime = nowTime()
                if (todayTime != arrstime[0]) {
                    localStorage.removeItem(kaoUserId + "startTime")
                    document.getElementById("kao1").innerHTML = '工作签到'
                    localStorage.removeItem(kaoUserId + "endTime")
                    document.getElementById("kao2").innerHTML = '工作签退'
                    qikoo.dialog.alert("工作签到时间过期，请重新签到")
                    return
                }
            }


            if (localStorage.getItem(kaoUserId + "startTime") != null) {
                if (localStorage.getItem(kaoUserId + "endTime") == null) {
                    qikoo.dialog.alert("请签退结束后再签到")
                    return
                }
            }
            qikoo.dialog.confirm('你确定要签到吗？', function () {
                if (localStorage.getItem(kaoUserId + "startTime") != null) {
                    if (localStorage.getItem(kaoUserId + "endTime") == null) {

                    } else {
                        localStorage.removeItem(kaoUserId + "endTime")
                        document.getElementById("kao2").innerHTML = '工作签退'
                    }
                }
                var jsonObj = eval('(' + coreData.data003.request + ')');
                //加坐标
                jsonObj.head.userId = kaoUserId
                $("body").append('<div class="loading" id="loadingGif" style="display:block"><img src="img/loading.gif"></div>');
                $("body").append('<div class="loadingMoveDiv" id="loadingGifDiv" style="top: 0;"></div>');
                var setTime = setTimeout(function () {
                    $("#loadingGif").css("display", "none");
                    $("#loadingGif").remove();

                    $("#loadingGifDiv").css("display", "none");
                    $("#loadingGifDiv").remove();
                }, 30000);
                mam.navigator.openSwitch.lbs(successCallback, errorCallBack);
                function successCallback(v) {
                    $("#loadingGif").css("display", "none");
                    $("#loadingGif").remove();
                    $("#loadingGifDiv").css("display", "none");
                    $("#loadingGifDiv").remove();
                    clearTimeout(setTime);
                    jsonObj.data.posy = v.longitude
                    jsonObj.data.posx = v.latitude
                    jsonObj.data.locationStr = v.address
                    var jsonStr = JSON.stringify(jsonObj);
                    coreData.data003.request = jsonStr;
                    getJSON(url, coreData.data003, function (data) {
                        var workId = data.data.dutykey;
                        localStorage.setItem(kaoUserId + "dutykey", workId)
                        var exceId = data.data.dutyexcp;
                        execType = '0'
                        if (exceId != '0') {
                            if (exceId == '1') {
                                mam.navigator.openSwitch.openSwitch(successQiandao, errorQiaodao, 1, "100");
                                jobReason()
                            } else {
                                localStorage.setItem(kaoUserId + 'startTime', data.data.dutytime);
                                document.getElementById("kao1").innerHTML = '工作签到   ✔'
                                mam.navigator.openSwitch.openSwitch(successQiandao, errorQiaodao, 1, "100");
                                otherReason(exceId)
                            }
                        } else {
                            localStorage.setItem(kaoUserId + 'startTime', data.data.dutytime);
                            document.getElementById("kao1").innerHTML = '工作签到   ✔'
                            //$.alertShow({'message':'签到成功'});
                            qikoo.dialog.alert("签到成功")
                            mam.navigator.openSwitch.openSwitch(successQiandao, errorQiaodao, 1, "100");

                        }
                    })
                }

                function errorCallBack() {
                    $("#loadingGif").css("display", "none");
                    $("#loadingGif").remove();
                    $("#loadingGifDiv").css("display", "none");
                    $("#loadingGifDiv").remove();
                    clearTimeout(setTime);
                    jsonObj.data.posy = ""
                    jsonObj.data.posx = ""
                    jsonObj.data.locationStr = ""
                    var jsonStr = JSON.stringify(jsonObj);
                    coreData.data003.request = jsonStr;
                    getJSON(url, coreData.data003, function (data) {
                        var workId = data.data.dutykey;
                        localStorage.setItem(kaoUserId + "dutykey", workId)
                        var exceId = data.data.dutyexcp;
                        execType = '0'
                        if (exceId != '0') {
                            if (exceId == '1') {
                                mam.navigator.openSwitch.openSwitch(successQiandao, errorQiaodao, 1, "100");
                                jobReason()
                            } else {
                                localStorage.setItem(kaoUserId + 'startTime', data.data.dutytime);
                                document.getElementById("kao1").innerHTML = '工作签到   ✔'
                                mam.navigator.openSwitch.openSwitch(successQiandao, errorQiaodao, 1, "100");
                                otherReason(exceId)
                            }
                        } else {
                            localStorage.setItem(kaoUserId + 'startTime', data.data.dutytime);
                            document.getElementById("kao1").innerHTML = '工作签到   ✔'
                            //$.alertShow({'message':'签到成功'});
                            qikoo.dialog.alert("签到成功")
                            mam.navigator.openSwitch.openSwitch(successQiandao, errorQiaodao, 1, "100");

                        }
                    })
                }

                //加坐标


            }, function () {

            });

        });
        function successQiandao(v) {
        }

        function errorQiaodao(v) {
        }

        //签退
        $(".c_tui").on("click", function () {
            var kaoUserId = localStorage.getItem("userId")

            var startTime = localStorage.getItem(kaoUserId + "startTime");
            if (startTime != null) {
                var arrstime = startTime.split(" ");
                var todayTime = nowTime()
                if (todayTime != arrstime[0]) {
                    localStorage.removeItem(kaoUserId + "startTime")
                    document.getElementById("kao1").innerHTML = '工作签到'
                    localStorage.removeItem(kaoUserId + "endTime")
                    document.getElementById("kao2").innerHTML = '工作签退'
                    qikoo.dialog.alert("工作签到时间过期，请重新签到")
                    return
                }
            }


            if (localStorage.getItem(kaoUserId + "startTime") == null ||
                localStorage.getItem(kaoUserId + "startTime") == 'null') {
                qikoo.dialog.alert("请先签到")
                return
            }
            var test1 = localStorage.getItem(kaoUserId + "endTime")
            if (test1 != null) {
                qikoo.dialog.alert('您已经签退过');
                return
            }
            qikoo.dialog.confirm('你确定要签退吗？', function () {
                if (test1 == null || test1 == 'null') {
                    var jsonObj = eval('(' + coreData.data004.request + ')');
                    //加坐标
                    jsonObj.head.userId = kaoUserId
                    jsonObj.data.dutykey = localStorage.getItem(kaoUserId + "dutykey");
                    $("body").append('<div class="loading" id="loadingGif" style="display:block"><img src="img/loading.gif"></div>');
                    $("body").append('<div class="loadingMoveDiv" id="loadingGifDiv" style="top: 0;"></div>');
                    var setTime = setTimeout(function () {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();

                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                    }, 30000);
                    mam.navigator.openSwitch.lbs(successCallback, errorCallBack);
                    function successCallback(v) {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();
                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                        clearTimeout(setTime);
                        jsonObj.data.posy = v.longitude
                        jsonObj.data.posx = v.latitude
                        jsonObj.data.locationStr = v.address
                        var jsonStr = JSON.stringify(jsonObj);
                        coreData.data004.request = jsonStr;
                        getJSON(url, coreData.data004, function (data) {
                            var exceId = data.data.dutyexcp;
                            execType = '1'
                            if (exceId != '0') {
                                if (exceId == '1') {
                                    mam.navigator.openSwitch.openSwitch(successQiantui, errorQiantui, 0, "100");
                                    jobReason()
                                } else {
                                    localStorage.setItem(kaoUserId + 'endTime', data.data.dutytime);
                                    document.getElementById("kao2").innerHTML = '工作签退   ✔'
                                    mam.navigator.openSwitch.openSwitch(successQiantui, errorQiantui, 0, "100");
                                    otherReason(exceId)
                                }
                            } else {
                                localStorage.setItem(kaoUserId + 'endTime', data.data.dutytime);
                                document.getElementById("kao2").innerHTML = '工作签退   ✔'
                                qikoo.dialog.alert("签退成功")
                                mam.navigator.openSwitch.openSwitch(successQiantui, errorQiantui, 0, "100");

                            }
                        })
                    }

                    function errorCallBack() {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();
                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                        clearTimeout(setTime);
                        jsonObj.data.posy = ""
                        jsonObj.data.posx = ""
                        jsonObj.data.locationStr = ""
                        var jsonStr = JSON.stringify(jsonObj);
                        coreData.data004.request = jsonStr;
                        getJSON(url, coreData.data004, function (data) {
                            var exceId = data.data.dutyexcp;
                            execType = '1'
                            if (exceId != '0') {
                                if (exceId == '1') {
                                    mam.navigator.openSwitch.openSwitch(successQiantui, errorQiantui, 0, "100");
                                    jobReason()
                                } else {
                                    localStorage.setItem(kaoUserId + 'endTime', data.data.dutytime);
                                    document.getElementById("kao2").innerHTML = '工作签退   ✔'
                                    mam.navigator.openSwitch.openSwitch(successQiantui, errorQiantui, 0, "100");
                                    otherReason(exceId)
                                }
                            } else {
                                localStorage.setItem(kaoUserId + 'endTime', data.data.dutytime);
                                document.getElementById("kao2").innerHTML = '工作签退   ✔'
                                qikoo.dialog.alert("签退成功")
                                mam.navigator.openSwitch.openSwitch(successQiantui, errorQiantui, 0, "100");

                            }
                        })
                    }

                    //加坐标


                } else if (test1 != 'null') {

                }

            }, function () {

            });


        });
        function successQiantui(v) {
        }

        function errorQiantui(v) {
        }

        function jobReason() {
            var kaoUserId = localStorage.getItem("userId")
            if (execType == '0') {
                qikoo.dialog.confirm('加班异常，是否重新签到？', function () {

                    var jsonObj = eval('(' + coreData.data003.request + ')');
                    jsonObj.data.flag = '1'
                    //加坐标
                    jsonObj.head.userId = kaoUserId
                    $("body").append('<div class="loading" id="loadingGif" style="display:block"><img src="img/loading.gif"></div>');
                    $("body").append('<div class="loadingMoveDiv" id="loadingGifDiv" style="top: 0;"></div>');
                    var setTime = setTimeout(function () {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();

                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                    }, 30000);
                    mam.navigator.openSwitch.lbs(successCallback, errorCallBack);
                    function successCallback(v) {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();
                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                        clearTimeout(setTime);
                        jsonObj.data.posy = v.longitude
                        jsonObj.data.posx = v.latitude
                        jsonObj.data.locationStr = v.address
                        var jsonStr = JSON.stringify(jsonObj);
                        coreData.data003.request = jsonStr;
                        getJSON(url, coreData.data003, function (data) {
                            var workId = data.data.dutykey;
                            localStorage.setItem(kaoUserId + "dutykey", workId)
                            localStorage.setItem(kaoUserId + 'startTime', data.data.dutytime);
                            document.getElementById("kao1").innerHTML = '工作签到   ✔'
                            qikoo.dialog.alert("签到成功")
                        })
                    }

                    function errorCallBack() {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();
                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                        clearTimeout(setTime);
                        jsonObj.data.posy = ""
                        jsonObj.data.posx = ""
                        jsonObj.data.locationStr = ""
                        var jsonStr = JSON.stringify(jsonObj);
                        coreData.data003.request = jsonStr;
                        getJSON(url, coreData.data003, function (data) {
                            var workId = data.data.dutykey;
                            localStorage.setItem(kaoUserId + "dutykey", workId)
                            localStorage.setItem(kaoUserId + 'startTime', data.data.dutytime);
                            document.getElementById("kao1").innerHTML = '工作签到   ✔'
                            qikoo.dialog.alert("签到成功")
                        })
                    }

                }, function () {

                });

            } else {
                qikoo.dialog.confirm('加班异常，是否重新签退？', function () {
                    var jsonObj = eval('(' + coreData.data004.request + ')');
                    jsonObj.data.flag = '1'
                    //加坐标
                    jsonObj.head.userId = kaoUserId
                    jsonObj.data.dutykey = localStorage.getItem(kaoUserId + "dutykey");
                    $("body").append('<div class="loading" id="loadingGif" style="display:block"><img src="img/loading.gif"></div>');
                    $("body").append('<div class="loadingMoveDiv" id="loadingGifDiv" style="top: 0;"></div>');
                    var setTime = setTimeout(function () {
                        $("#loadingGif").css("display", "none");
                        $("#loadingGif").remove();

                        $("#loadingGifDiv").css("display", "none");
                        $("#loadingGifDiv").remove();
                    }, 30000);
                    mam.navigator.openSwitch.lbs(successCallback, errorCallBack);
                    function successCallback(v) {
                        jsonObj.data.posy = v.longitude
                        jsonObj.data.posx = v.latitude
                        jsonObj.data.locationStr = v.address
                        var jsonStr = JSON.stringify(jsonObj);
                        coreData.data004.request = jsonStr;
                        getJSON(url, coreData.data004, function (data) {
                            localStorage.setItem(kaoUserId + 'endTime', data.data.dutytime);
                            document.getElementById("kao2").innerHTML = '工作签退   ✔'
                            qikoo.dialog.alert("签退成功")
                        })
                    }

                    function errorCallBack() {
                        jsonObj.data.posy = ""
                        jsonObj.data.posx = ""
                        jsonObj.data.locationStr = ""
                        var jsonStr = JSON.stringify(jsonObj);
                        coreData.data004.request = jsonStr;
                        getJSON(url, coreData.data004, function (data) {
                            localStorage.setItem(kaoUserId + 'endTime', data.data.dutytime);
                            document.getElementById("kao2").innerHTML = '工作签退   ✔'
                            qikoo.dialog.alert("签退成功")
                        })
                    }
                }, function () {

                });
            }

        }

        function otherReason(exceId) {
            var dialogType = ''
            if (exceId == '2') {
                dialogType = '2'
            }
            if (exceId == '4') {
                dialogType = '4'
            }
            if (exceId == '6') {
                dialogType = '6'
            }
            qikoo.dialog.confirm2(dialogType, function () {
                var reason = document.getElementById("confirmText").value
//			if(reason==""){
////				document.getElementById("confirmText").placeholder='请输入异常原因'
//				return
//			}else{
                qikoo.dialog.hide()
//			}
                var jsonObj = eval('(' + coreData.data006.request + ')');
                jsonObj.head.userId = localStorage.getItem("userId")
                jsonObj.data.dutykey = localStorage.getItem(localStorage.getItem("userId") + "dutykey");
                jsonObj.data.dutytype = execType;
                jsonObj.data.exception = reason;
                var jsonStr = JSON.stringify(jsonObj);
                coreData.data006.request = jsonStr;
                getJSON(url, coreData.data006, function (data) {
                    if (execType == '0') {
                        qikoo.dialog.alert('签到成功');
                    } else {
                        qikoo.dialog.alert('签退成功');
                    }

                })
            }, function () {

            });

        }

        //定位按钮
        $('.indexcell-2 span').eq(2).on('click', function () {
            mylocation();
            var address = window.sessionStorage.getItem("address");
            var xy = window.sessionStorage.getItem('jingweidu');
            if (xy) {
                $('.address').text(address)
                qikoo.dialog.alert("您所在的位置：" + xy)
            } else {
                $('.address').text("定位失败")
                qikoo.dialog.alert("定位失败")
            }
            $('.refesh').css({
                'transition': '2s all ease-in-out',
                'transform': 'rotate(1800deg)'
            })
            setTimeout(function () {
                $('.refesh').css({
                    'transition': 'none',
                    'transform': 'rotate(0deg)'
                })
            }, 2000)
        })

    })
    function login(obj) {
        var obj = new Object();
        obj.id = localStorage.getItem("userId");
        obj.name = localStorage.getItem("userName");


        $('.welcome').text("您好," + obj.name);
//		document.getElementById("loginName").innerHTML = "您好,"+obj.name
//		$('.indexcell-1 span').eq(1).text("您好,"+obj.name)

        kaoqin();


        var jsonObjR = eval('(' + coreData.data017.request + ')');
        jsonObjR.head.userId = obj.id;
        var jsonStrR = JSON.stringify(jsonObjR);
        coreData.data017.request = jsonStrR;
        getJSON(url, coreData.data017, data017);

        function data017(v) {
//	    	alert(v);
            localStorage.setItem(obj.id + "deptArr", JSON.stringify(v))
            if (v.data.cont && v.data.cont.length > 0) {
                var dataObj = v.data.cont;
                var deptCode = dataObj[0].ORG_CODE
                var roleCode = dataObj[0].SPROLE_CODE
                var deptVal = deptCode + "&" + roleCode
                if (localStorage.getItem(localStorage.getItem("userId") + "roleCode") == null) {
                    localStorage.setItem(localStorage.getItem("userId") + "roleCode", deptVal)
                }


                if (localStorage.getItem(localStorage.getItem("userId") + "deptRole") != null) {
                    $('.orgRole').text(localStorage.getItem(localStorage.getItem("userId") + "deptRole"))
                } else {
                    $('.orgRole').text(dataObj[0].ORG_NAME + "---" + dataObj[0].ROLE_NAME)
                }
                deptVal = localStorage.getItem(localStorage.getItem("userId") + "roleCode");

//                if (deptVal == "ZSB&ZGB_BMZR" || deptVal == "ZSB&ZGB_BMZZ" || deptVal == "ZSB&JYB_BMZR"
//                    || deptVal == "ZSB&CWB_BMZR") {
//                    $('.indexList li:eq(0)').hide()
//                    $('.indexList li:eq(1)').hide()
//                    $('.indexList li:eq(2)').hide()
//                }
                showMemu(deptVal);
            } else {
                $('.orgRole').text("没有角色")
                $('.indexList li:eq(0)').hide()
                $('.indexList li:eq(1)').hide()
                $('.indexList li:eq(2)').hide()
            }

            //获取消息列表信息
            var messId = localStorage.getItem(obj.id + "messId")
            if (messId != null) {
                var jsonObj = eval('(' + coreData.data013.request + ')');
                jsonObj.head.userId = obj.id;
                jsonObj.data.retIds = messId;
                var jsonStr = JSON.stringify(jsonObj);
                coreData.data013.request = jsonStr;
                getJSON(url, coreData.data013, data013)
            } else {
                getJSON(url, coreData.data013, data013)
            }
            function data013(v2) {
                var uId = localStorage.getItem("userId")
                if (v2.data.cont) {
                    var dataObj = eval(v2.data.cont)
                    var localarr = localStorage.getItem(uId + "messArr")
                    if (localarr == null) {
                        for (var a in dataObj) {
                            dataObj[a].lookType = '0'
                            dataObj[a].sendType = '0'
                        }

                        localStorage.setItem(uId + "messArr", JSON.stringify(dataObj))
                    } else {
                        for (var a in dataObj) {
                            dataObj[a].lookType = '0'
                            dataObj[a].sendType = '0'
                        }
                        localarr = JSON.stringify(dataObj) + "&" + localarr
                        localStorage.setItem(uId + "messArr", localarr)
                    }
                    var notiIdStr = "";
                    for (var i in dataObj) {
                        var notiId = dataObj[i].ID
                        if (notiIdStr == "") {
                            notiIdStr = notiId
                        } else {
                            notiIdStr = notiIdStr + "," + notiId
                        }
                    }
                    localStorage.setItem(uId + "messId", notiIdStr)
                }

                var localarr = localStorage.getItem(uId + "messArr")
                if (localarr != null) {
                    var arr = new Array();
                    arr = localarr.split("&")
                    var a = 0;
                    for (var i in arr) {
                        var jobj = JSON.parse(arr[i])
                        for (var j in jobj) {
                            if (jobj[j].lookType == '0') {
                                a++
                            }
                        }
                    }
                    if (a != 0) {
//				    		$('.num').css('display','block')
                        document.getElementById("noticeLen").style.display = 'block'
                    }
                }
            }


            //头像图片切换
//	    	if (v.data.URL) {
//	    		window.sessionStorage.setItem("headImg",v.data.URL);
//	    		$('.indexincon-1 img').attr("src",v.data.URL)
//	    	}
        }
    }
    $('.switch').on('click', function () {

        qikoo.dialog.confirm2('3', function () {
            var deptName = document.getElementsByName("deptName")
            for (var i in deptName) {
                if (deptName[i].checked == true) {
                    var deptVal = deptName[i].value;
//                    alert("deptVal" + deptVal);
                    var temp = deptName[i].getAttribute("data-roleName")
                    var xiangmubu = temp.split('&')[0];
                    var juese = temp.split('&')[1];
                    localStorage.setItem(localStorage.getItem("userId") + "roleCode", deptVal)
                    localStorage.setItem(localStorage.getItem("userId") + "deptRole", xiangmubu + "---" + juese)
                    $('.orgRole').text(xiangmubu + "-" + juese)
//                    $('.indexList li').hide();
                    //

//                    if (deptVal == "ZSB&ZGB_BMZR" || deptVal == "ZSB&ZGB_BMZZ" || deptVal == "ZSB&JYB_BMZR"
//                        || deptVal == "ZSB&CWB_BMZR") {
//                        $('.indexList li:eq(0)').hide();
//                        $('.indexList li:eq(1)').hide();
//                        $('.indexList li:eq(2)').hide();
//
//                    }
                    showMemu(deptVal);
                }
            }
            //添加菜单权限
            qikoo.dialog.hide()
        }, function () {

        })
    })
    /**
     * 根据部门和业务组织角色code，显示菜单
     * @param deptVal
     */
    function showMemu(deptVal) {
       /* $('.indexList li').hide();
        //工程一览
        if (
            //兴力公司公司领导
        deptVal == "XLGS&JLGS_GSLD"
        //工程监理部部门主任
        || deptVal == "JLB1&JLB1_BMZR"
        //工程监理部数据管理员
        || deptVal == "JLB1&JLB1_BMZRS"
        //工程监理部项目部主任
        || deptVal == "JLB1&JLB1_XMBZR"
        //工程监理部分管地区负责人
        || deptVal == "JLB1&JLB1_XMBZRS"
        //工程监理部分管地区负责人
        || deptVal == "JLB1&JLB1_XMBZRS"
        //工程监理部总监
        || deptVal == "JLB1&JLB1_PROMANAGER"
        //工程监理部总代
        || deptVal == "JLB1&JLB1_PROMANAGERS"
        //工程监理部监理
        || deptVal == "JLB1&JLB1_ENGINEER"
        //安全技术部
        || deptVal == "AJB&AJB_BMZR"
        ) {
            $('.indexList li:eq(0)').show();
        }

        //风险一览
        if (
            //兴力公司公司领导
        deptVal == "XLGS&JLGS_GSLD"
        //工程监理部部门主任
        || deptVal == "JLB1&JLB1_BMZR"
        //工程监理部数据管理员
        || deptVal == "JLB1&JLB1_BMZRS"
        //工程监理部项目部主任
        || deptVal == "JLB1&JLB1_XMBZR"
        //工程监理部分管地区负责人
        || deptVal == "JLB1&JLB1_XMBZRS"
        //工程监理部分管地区负责人
        || deptVal == "JLB1&JLB1_XMBZRS"
        //工程监理部总监
        || deptVal == "JLB1&JLB1_PROMANAGER"
        //工程监理部总代
        || deptVal == "JLB1&JLB1_PROMANAGERS"
        //工程监理部监理
        || deptVal == "JLB1&JLB1_ENGINEER"
        //安全技术部
        || deptVal == "AJB&AJB_BMZR"
        ) {
            $('.indexList li:eq(1)').show();
        }

        //问题一览
        if (
            //兴力公司公司领导
        deptVal == "XLGS&JLGS_GSLD"
        //工程监理部部门主任
        || deptVal == "JLB1&JLB1_BMZR"
        //工程监理部数据管理员
        || deptVal == "JLB1&JLB1_BMZRS"
        //工程监理部项目部主任
        || deptVal == "JLB1&JLB1_XMBZR"
        //工程监理部分管地区负责人
        || deptVal == "JLB1&JLB1_XMBZRS"
        //工程监理部分管地区负责人
        || deptVal == "JLB1&JLB1_XMBZRS"
        //工程监理部总监
        || deptVal == "JLB1&JLB1_PROMANAGER"
        //工程监理部总代
        || deptVal == "JLB1&JLB1_PROMANAGERS"
        //工程监理部监理
        || deptVal == "JLB1&JLB1_ENGINEER"
        //安全技术部
        || deptVal == "AJB&AJB_BMZR"
        ) {
            $('.indexList li:eq(2)').show();
        }
        $('.indexList li:eq(3)').show();*/
    }

    function backIndex() {
        window.location.href = "index.html";
    }
    function kaoqin() {
        //考勤签到，签退，定时清理
        var dingId = localStorage.getItem("userId")
        var startTime = localStorage.getItem(dingId + "startTime");
        if (startTime != null) {
            document.getElementById("kao1").innerHTML = '工作签到   ✔'
            var arrstime = startTime.split(" ");
            var todayTime = nowTime()
            if (todayTime != arrstime[0]) {
                localStorage.removeItem(dingId + "startTime")
                document.getElementById("kao1").innerHTML = '工作签到'
            }
        } else {
            document.getElementById("kao1").innerHTML = '工作签到'
        }
        var endTime = localStorage.getItem(dingId + "endTime");

        if (endTime != null) {
            document.getElementById("kao2").innerHTML = '工作签退   ✔'
            var arrstime = endTime.split(" ");
            var todayTime = nowTime()
            if (todayTime != arrstime[0]) {
                localStorage.removeItem(dingId + "endTime")
                document.getElementById("kao2").innerHTML = '工作签退'
            }
        } else {
            document.getElementById("kao2").innerHTML = '工作签退'
        }
    }
    //动态设置头像的3个图片位置
    function touxiang() {
        var width1 = $('.touxiang')[0].offsetWidth;
        var width2 = $('.touxiang_bg')[0].offsetWidth;
        var width3 = $('.touxiang_quan')[0].offsetWidth;
        var top = $('.touxiang')[0].offsetTop;

        $('.touxiang_bg').css('top', top - (width2 - width1) / 2);
        $('.touxiang_quan').css('top', top - (width3 - width1) / 2);
    }
    function indexcell3() {
        var indexHight = $('.indexPage')[0].offsetHeight;

        var hight1 = $('.indexcell-1')[0].offsetHeight;
        var hight2 = $('.indexcell-2')[0].offsetHeight;
        var hight4 = $('.indexFooter')[0].offsetHeight;

        var hight3 = indexHight - hight1 - hight2 - hight4 - 6;
        $('.indexcell-3').css("height", hight3 + 'px')
    }
</script>

</html>
<!--<script type="text/javascript">
	$('.indexcell-4').height($('.indexHeader').height()-$('.indexcell-1').height()-$('.indexcell-3').height()-$('.indexFooter').height())
</script>-->