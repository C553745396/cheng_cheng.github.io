<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>厂家详细</title>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	    <meta content="yes" name="apple-mobile-web-app-capable">
	    <meta content="black" name="apple-mobile-web-app-status-bar-style">
	    <meta content="telephone=no" name="format-detection">
	    
		<link href="../css/public.css" rel="stylesheet" type="text/css">
    	<link href="../css/alert/css/qikoo.css" rel="stylesheet" type="text/css">
    	<link href="../style/index1.css" rel="stylesheet" type="text/css">
    	<link href="../css/cjxx/cjxx.css" rel="stylesheet" type="text/css">
    	<link href="../css/mui/mui_css/mui.min.css" rel="stylesheet" type="text/css">
		<link href="../public/style/touchzoom/scale.css" rel="stylesheet" type="text/css">
		<link href="../public/style/slideBar.css" rel="stylesheet" type="text/css">
		<script type="text/javascript" src="../cordova.js"></script>
		<script type="text/javascript" src="../public/js/public.js"></script>
    	<script src="../JM/jquery-1.11.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/RSA/RSA.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/CryptoJS/core.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/CryptoJS/enc-base64.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/CryptoJS/cipher-core.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/CryptoJS/aes.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/CryptoJS/sha256.js" type="text/javascript" charset="utf-8"></script>
		<script src="../JM/jmUtil.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/public/joint.js" type="text/javascript" ></script>
    	<script src="../js/AJAX/prodBuild.js" type="text/javascript" charset="utf-8"></script>
    	<script type="text/javascript" src="../public/js/jQuery.alertShow.js"></script>
    	<script src="../js/mui.min.js" type="text/javascript" ></script>
    	<script src="../public/js/touchzoom/scale.js" type="text/javascript" ></script>
    	
		<style>
			
			#titleDiv{
				height: 2rem;
				border-bottom: 1px solid #FFD524;
				font-size: 16px;
				font-weight: bold;
				padding-top: 5px;
				padding-bottom: 5px
			}
			#linkDiv{
				height: 2rem;
				border-bottom: 1px solid #FFD524;
				font-size: 16px;
				font-weight: bold;
				padding-top: 10px;
				padding-bottom: 5px
			}
	
		</style>
	<script>
		var tID = window.location.search.split('&')[0].split('=')[1];
		var lat1 = window.location.search.split('&')[1].split('=')[1];
		var lon1 = window.location.search.split('&')[2].split('=')[1];
		var roleStr = localStorage.getItem(localStorage.getItem("userId")+"roleCode")
	//$(function(){
			//showTopTool();
			//window.parent.document.addEventListener("deviceready", onDeviceReady, false);
			//onDeviceReady();
	    	function onDeviceReady () {
	    		
	    		showTopTool();
	    		var jsonObj = eval('(' + data.data704.request + ')');
		    	jsonObj.data.id=tID;
		    	 var jsonStr = JSON.stringify(jsonObj);
           		 data.data704.request = jsonStr;
	    		//alert(23235);

            getJSON(url, data.data704, data704);
		    	//getJSON( jsonObj, data704);
	    	}
	    	//设备明细
	    	function data704(v){
//	    		v = eval('(' + v + ')');
	    		if(v.data){
		    		var dataObj = eval(v.data);
		    		$('#cjmc').text(dataObj.supplier_name);
					$('#cjywsx').text(dataObj.english_name);
					$('#dz').text(dataObj.address);
					$('#yb').text(dataObj.zip_code);
		    		$('#bz').text(dataObj.remark);
		    		
		    		initLink();
	    		}
	    	}
	    	
	    	
	    //联系人列表
	    function initLink () {
	    	var jsonObj = eval('(' + data.data710.request + ')');
	    	jsonObj.data.id=tID;
	    	 var jsonStr = JSON.stringify(jsonObj);
            data.data710.request = jsonStr;
	    		//alert(23235);

            getJSON(url, data.data710, data710);
		    //getJSON(jsonObj, data710);
	    }
	    //列表数据
	    function data710(v){
	    	
	    	//v = eval('(' + v + ')');
    		$('.cjlxr_items').children().remove();
	    	if(v.data.cont){  //lw@
		    	var dataObj = v.data.cont;
		    	var length = dataObj.length;
		    	for(var i=0;i<length;i++){
		    		var res = "";
	    			 res += "<li class='mui-table-view-cell' style='width: 98%;'>";
		    		 res +="<div class='mui-slider-handle mui-table'>";
		    		 res += '<div class="cjlxr"><span class="cjlxr_span"><div><span class="xm">'+dataObj[i].CONTACT_NAME+'</span><span class="dh">'+dataObj[i].PHONE_NO+'</span></div></span></div>';
		    		 res +="</div>";
		    		 res +="</li>";
		    		 $(res).appendTo('.cjlxr_items');
		    	}
	    	}
	    }
	    
	    //监造人员
	    $('#jzryBtn').on('click', function() {
			window.location.href = 'jzryShow.html?tID='+tID;
		});
		
		 //厂家位置
	    $('#cjwzBtn').on('click', function() {
			if(lat1 == 0 || lon1 ==0){
				qikoo.dialog.alert("无坐标");
			}else{
				window.location.href = '../gis/locgis.html?lng='+lon1+'&lat='+lat1+'&type=3';
			}
		});
		
	/********************************采集开始*****************************************************/
	
	
	
	var isClickRefresh = false;

	//调用地图成功
	function onLocationSuccess(position) {
		var lon = position.coords.longitude.toString();
		var lat = position.coords.latitude.toString();
		var address = position.coords.addrStr;
		localStorage.setItem("lon_cj", lon);
		localStorage.setItem("lat_cj", lat);
		localStorage.setItem("address_cj", address);
		localStorage.setItem('jingweidu_cj', lon + '/' + lat);
		
		if(lon) {
			var msgHit = address+"("+lon + '/' + lat+")";
			var msg = '<div><div style="text-align: left;">您当前位置为：</div><div style="padding-left: 10px;text-align: left;">'+msgHit+'</div><div><font style="font-weight: bold;">确定更新厂家位置？</div></div>';
			qikoo.dialog.confirm(msg, function() {
				var jsonObj = eval('(' + data.data707.request + ')');
	    		jsonObj.data.id=tID;
	    		jsonObj.data.lat=lat;
	    		jsonObj.data.lon=lon;
	    		 var jsonStr = JSON.stringify(jsonObj);
            data.data707.request = jsonStr;
	    		//alert(23235);

            getJSON(url, data.data707, data707);
	    		//getJSON(jsonObj, data707);
			}, function() {
	
	        });
		} else {
			if(isClickRefresh) {
				qikoo.dialog.alert("定位失败");
			};
		}

		isClickRefresh = false;
		$('.refesh').css({
			'transition': '2s all ease-in-out',
			'transform': 'rotate(1800deg)'
		})
		setTimeout(function() {
			$('.refesh').css({
				'transition': 'none',
				'transform': 'rotate(0deg)'
			})
		}, 2000)
	}
	
	function data707(v){
		//v = eval('(' + v + ')');
		var result = v.head.resp;
    	if(result=='000000'){
    		qikoo.dialog.alert("采集成功");
    	}else{
    		qikoo.dialog.alert("采集失败");
    	}
	}

	function onLocationError(error) {
		qikoo.dialog.alert("没有获取到位置");
	}
	
	
	//采集坐标
    $('#cjzbBtn').on('click', function() {
		isClickRefresh = true;
		//navigator.geolocation
		navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError);
	});
	//初始化当前位置
	//window.parent.navigator.geolocation.getCurrentPosition(onLocationSuccess, onLocationError);
	/**********************************采集结束****************************************************/
	    
	//});	
		
	function showTopTool() {
		var indexHight = $('body')[0].offsetHeight;
		var hight1 = $('#titleDiv')[0].offsetHeight;
		var hight2 = $('#cjInfo')[0].offsetHeight;
		var hight3 = $('#linkDiv')[0].offsetHeight;
		var hight4 = $('.cjxxControl')[0].offsetHeight;
		var hight5 = indexHight -hight1-hight2-hight3-hight4 -10 ;
		$('.cjlxrShow').css("height", hight5 + 'px')
		
	}
	</script>
		
		
	</head>
	<body >
		<div class="sbxxEditor indexPage">
		    <section>
		    	<div class="content" id="titleDiv" >厂家信息</div>
		    </section>
			<section id="cjInfo">
				<div class="content">
					<span class="contentTitle title14">厂家名称:</span>
					<span id="cjmc" data-proId="" class="cont title14"></span>
				</div>
				<div class="content">
					<span class="contentTitle title14">厂家英文缩写:</span>
					<span id="cjywsx" data-val="" class="cont title14"></span>
				</div>
				<div class="content">
					<span class="contentTitle title14">地址:</span>
					<span id="dz" data-val="" class="cont title14"></span>
				</div>
				<div class="content">
					<span class="contentTitle title14">邮编:</span>
					<span id="yb" class="cont title14"></span>
				</div>
				<div class="content2">
					<span class="contentTitle title14">备注:</span>
					<textarea id="bz" disabled="disabled" style="line-height: 1.6rem;"></textarea>
				</div>
			</section>
			<section>
		    	<div class="content" id="linkDiv" >厂家联系人</div>
		    </section>
		    <section class="cjlxrShow oneName">
		    		<div class="cjlxr_items" id="scroll" style=" height: 100%; width: 100%;">
		    		</div>
		    		
		    </section>
	    	<div class="kong" style="height: 0px;"></div>
    	</div>
		<div class="cjxxControl" >
				
				<div class="jzryBtn" id="jzryBtn">
					<p class="jzryImg"></p>
					<p>监造人员</p>
					<p class="border"></p>
				</div>
				<div class="cjwzBtn"  id="cjwzBtn">
					<p class="cjwzImg"></p>
					<p>厂家位置</p>
					<p class="border"></p>
				</div>
				<div class="cjzbBtn" id="cjzbBtn">
					<p class="cjzbImg"></p>
					<p>坐标采集</p>
					<p class="border"><p>
				</div>
		</div>
	</body>
	<script>
		function sectionheight(){
	    	var indexHight = $('body')[0].offsetHeight;
			hight3 = indexHight -50;
			$('body').css("height",hight3+'px')
    	}
	</script>
</html>
